"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2020 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl,globalTranslate, Extensions, Form  */
// Проверка нет ли ошибки занятого другой учеткой номера
$.fn.form.settings.rules.existRule = function (value, parameter) {
  return $("#".concat(parameter)).hasClass('hidden');
};

var conference = {
  $number: $('#extension'),
  $formObj: $('#conference-room-form'),
  defaultExtension: '',
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cr_ValidateNameEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'number',
        prompt: globalTranslate.cr_ValidateExtensionNumber
      }, {
        type: 'minLength[2]',
        prompt: globalTranslate.cr_ValidateExtensionLen
      }, {
        type: 'empty',
        prompt: globalTranslate.cr_ValidateExtensionEmpty
      }, {
        type: 'existRule[extension-error]',
        prompt: globalTranslate.cr_ValidateExtensionDouble
      }]
    },
    pinCode: {
      identifier: 'pinCode',
      rules: [{
        type: 'number',
        prompt: globalTranslate.cr_ValidatePinNumber
      }]
    }
  },
  initialize: function initialize() {
    // Динамическая проверка свободен ли внутренний номер
    conference.$number.on('change', function () {
      var newNumber = conference.$formObj.form('get value', 'extension');
      Extensions.checkAvailability(conference.defaultNumber, newNumber);
    });
    conference.initializeForm();
    conference.defaultExtension = conference.$formObj.form('get value', 'extension');
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = conference.$formObj.form('get values');
    return result;
  },
  cbAfterSendForm: function cbAfterSendForm() {},
  initializeForm: function initializeForm() {
    Form.$formObj = conference.$formObj;
    Form.url = "".concat(globalRootUrl, "conference-rooms/save");
    Form.validateRules = conference.validateRules;
    Form.cbBeforeSendForm = conference.cbBeforeSendForm;
    Form.cbAfterSendForm = conference.cbAfterSendForm;
    Form.initialize();
  }
};
$(document).ready(function () {
  conference.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db25mZXJlbmNlUm9vbXMvY29uZmVyZW5jZS1yb29tLW1vZGlmeS5qcyJdLCJuYW1lcyI6WyIkIiwiZm4iLCJmb3JtIiwic2V0dGluZ3MiLCJydWxlcyIsImV4aXN0UnVsZSIsInZhbHVlIiwicGFyYW1ldGVyIiwiaGFzQ2xhc3MiLCJjb25mZXJlbmNlIiwiJG51bWJlciIsIiRmb3JtT2JqIiwiZGVmYXVsdEV4dGVuc2lvbiIsInZhbGlkYXRlUnVsZXMiLCJuYW1lIiwiaWRlbnRpZmllciIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJjcl9WYWxpZGF0ZU5hbWVFbXB0eSIsImV4dGVuc2lvbiIsImNyX1ZhbGlkYXRlRXh0ZW5zaW9uTnVtYmVyIiwiY3JfVmFsaWRhdGVFeHRlbnNpb25MZW4iLCJjcl9WYWxpZGF0ZUV4dGVuc2lvbkVtcHR5IiwiY3JfVmFsaWRhdGVFeHRlbnNpb25Eb3VibGUiLCJwaW5Db2RlIiwiY3JfVmFsaWRhdGVQaW5OdW1iZXIiLCJpbml0aWFsaXplIiwib24iLCJuZXdOdW1iZXIiLCJFeHRlbnNpb25zIiwiY2hlY2tBdmFpbGFiaWxpdHkiLCJkZWZhdWx0TnVtYmVyIiwiaW5pdGlhbGl6ZUZvcm0iLCJjYkJlZm9yZVNlbmRGb3JtIiwicmVzdWx0IiwiZGF0YSIsImNiQWZ0ZXJTZW5kRm9ybSIsIkZvcm0iLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUE7QUFDQUEsQ0FBQyxDQUFDQyxFQUFGLENBQUtDLElBQUwsQ0FBVUMsUUFBVixDQUFtQkMsS0FBbkIsQ0FBeUJDLFNBQXpCLEdBQXFDLFVBQUNDLEtBQUQsRUFBUUMsU0FBUjtBQUFBLFNBQXNCUCxDQUFDLFlBQUtPLFNBQUwsRUFBRCxDQUFtQkMsUUFBbkIsQ0FBNEIsUUFBNUIsQ0FBdEI7QUFBQSxDQUFyQzs7QUFFQSxJQUFNQyxVQUFVLEdBQUc7QUFDbEJDLEVBQUFBLE9BQU8sRUFBRVYsQ0FBQyxDQUFDLFlBQUQsQ0FEUTtBQUVsQlcsRUFBQUEsUUFBUSxFQUFFWCxDQUFDLENBQUMsdUJBQUQsQ0FGTztBQUdsQlksRUFBQUEsZ0JBQWdCLEVBQUUsRUFIQTtBQUlsQkMsRUFBQUEsYUFBYSxFQUFFO0FBQ2RDLElBQUFBLElBQUksRUFBRTtBQUNMQyxNQUFBQSxVQUFVLEVBQUUsTUFEUDtBQUVMWCxNQUFBQSxLQUFLLEVBQUUsQ0FDTjtBQUNDWSxRQUFBQSxJQUFJLEVBQUUsT0FEUDtBQUVDQyxRQUFBQSxNQUFNLEVBQUVDLGVBQWUsQ0FBQ0M7QUFGekIsT0FETTtBQUZGLEtBRFE7QUFVZEMsSUFBQUEsU0FBUyxFQUFFO0FBQ1ZMLE1BQUFBLFVBQVUsRUFBRSxXQURGO0FBRVZYLE1BQUFBLEtBQUssRUFBRSxDQUNOO0FBQ0NZLFFBQUFBLElBQUksRUFBRSxRQURQO0FBRUNDLFFBQUFBLE1BQU0sRUFBRUMsZUFBZSxDQUFDRztBQUZ6QixPQURNLEVBS047QUFDQ0wsUUFBQUEsSUFBSSxFQUFFLGNBRFA7QUFFQ0MsUUFBQUEsTUFBTSxFQUFFQyxlQUFlLENBQUNJO0FBRnpCLE9BTE0sRUFTTjtBQUNDTixRQUFBQSxJQUFJLEVBQUUsT0FEUDtBQUVDQyxRQUFBQSxNQUFNLEVBQUVDLGVBQWUsQ0FBQ0s7QUFGekIsT0FUTSxFQWFOO0FBQ0NQLFFBQUFBLElBQUksRUFBRSw0QkFEUDtBQUVDQyxRQUFBQSxNQUFNLEVBQUVDLGVBQWUsQ0FBQ007QUFGekIsT0FiTTtBQUZHLEtBVkc7QUErQmRDLElBQUFBLE9BQU8sRUFBRTtBQUNSVixNQUFBQSxVQUFVLEVBQUUsU0FESjtBQUVSWCxNQUFBQSxLQUFLLEVBQUUsQ0FDTjtBQUNDWSxRQUFBQSxJQUFJLEVBQUUsUUFEUDtBQUVDQyxRQUFBQSxNQUFNLEVBQUVDLGVBQWUsQ0FBQ1E7QUFGekIsT0FETTtBQUZDO0FBL0JLLEdBSkc7QUE2Q2xCQyxFQUFBQSxVQTdDa0Isd0JBNkNMO0FBQ1o7QUFDQWxCLElBQUFBLFVBQVUsQ0FBQ0MsT0FBWCxDQUFtQmtCLEVBQW5CLENBQXNCLFFBQXRCLEVBQWdDLFlBQU07QUFDckMsVUFBTUMsU0FBUyxHQUFHcEIsVUFBVSxDQUFDRSxRQUFYLENBQW9CVCxJQUFwQixDQUF5QixXQUF6QixFQUFzQyxXQUF0QyxDQUFsQjtBQUNBNEIsTUFBQUEsVUFBVSxDQUFDQyxpQkFBWCxDQUE2QnRCLFVBQVUsQ0FBQ3VCLGFBQXhDLEVBQXVESCxTQUF2RDtBQUNBLEtBSEQ7QUFLQXBCLElBQUFBLFVBQVUsQ0FBQ3dCLGNBQVg7QUFDQXhCLElBQUFBLFVBQVUsQ0FBQ0csZ0JBQVgsR0FBOEJILFVBQVUsQ0FBQ0UsUUFBWCxDQUFvQlQsSUFBcEIsQ0FBeUIsV0FBekIsRUFBc0MsV0FBdEMsQ0FBOUI7QUFDQSxHQXREaUI7QUF1RGxCZ0MsRUFBQUEsZ0JBdkRrQiw0QkF1REQvQixRQXZEQyxFQXVEUztBQUMxQixRQUFNZ0MsTUFBTSxHQUFHaEMsUUFBZjtBQUNBZ0MsSUFBQUEsTUFBTSxDQUFDQyxJQUFQLEdBQWMzQixVQUFVLENBQUNFLFFBQVgsQ0FBb0JULElBQXBCLENBQXlCLFlBQXpCLENBQWQ7QUFDQSxXQUFPaUMsTUFBUDtBQUNBLEdBM0RpQjtBQTREbEJFLEVBQUFBLGVBNURrQiw2QkE0REEsQ0FFakIsQ0E5RGlCO0FBK0RsQkosRUFBQUEsY0EvRGtCLDRCQStERDtBQUNoQkssSUFBQUEsSUFBSSxDQUFDM0IsUUFBTCxHQUFnQkYsVUFBVSxDQUFDRSxRQUEzQjtBQUNBMkIsSUFBQUEsSUFBSSxDQUFDQyxHQUFMLGFBQWNDLGFBQWQ7QUFDQUYsSUFBQUEsSUFBSSxDQUFDekIsYUFBTCxHQUFxQkosVUFBVSxDQUFDSSxhQUFoQztBQUNBeUIsSUFBQUEsSUFBSSxDQUFDSixnQkFBTCxHQUF3QnpCLFVBQVUsQ0FBQ3lCLGdCQUFuQztBQUNBSSxJQUFBQSxJQUFJLENBQUNELGVBQUwsR0FBdUI1QixVQUFVLENBQUM0QixlQUFsQztBQUNBQyxJQUFBQSxJQUFJLENBQUNYLFVBQUw7QUFDQTtBQXRFaUIsQ0FBbkI7QUF5RUEzQixDQUFDLENBQUN5QyxRQUFELENBQUQsQ0FBWUMsS0FBWixDQUFrQixZQUFNO0FBQ3ZCakMsRUFBQUEsVUFBVSxDQUFDa0IsVUFBWDtBQUNBLENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IChDKSAyMDE3LTIwMjAgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsZ2xvYmFsVHJhbnNsYXRlLCBFeHRlbnNpb25zLCBGb3JtICAqL1xuXG4vLyDQn9GA0L7QstC10YDQutCwINC90LXRgiDQu9C4INC+0YjQuNCx0LrQuCDQt9Cw0L3Rj9GC0L7Qs9C+INC00YDRg9Cz0L7QuSDRg9GH0LXRgtC60L7QuSDQvdC+0LzQtdGA0LBcbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5leGlzdFJ1bGUgPSAodmFsdWUsIHBhcmFtZXRlcikgPT4gJChgIyR7cGFyYW1ldGVyfWApLmhhc0NsYXNzKCdoaWRkZW4nKTtcblxuY29uc3QgY29uZmVyZW5jZSA9IHtcblx0JG51bWJlcjogJCgnI2V4dGVuc2lvbicpLFxuXHQkZm9ybU9iajogJCgnI2NvbmZlcmVuY2Utcm9vbS1mb3JtJyksXG5cdGRlZmF1bHRFeHRlbnNpb246ICcnLFxuXHR2YWxpZGF0ZVJ1bGVzOiB7XG5cdFx0bmFtZToge1xuXHRcdFx0aWRlbnRpZmllcjogJ25hbWUnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3JfVmFsaWRhdGVOYW1lRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0ZXh0ZW5zaW9uOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnZXh0ZW5zaW9uJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnbnVtYmVyJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jcl9WYWxpZGF0ZUV4dGVuc2lvbk51bWJlcixcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdtaW5MZW5ndGhbMl0nLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmNyX1ZhbGlkYXRlRXh0ZW5zaW9uTGVuLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jcl9WYWxpZGF0ZUV4dGVuc2lvbkVtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2V4aXN0UnVsZVtleHRlbnNpb24tZXJyb3JdJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jcl9WYWxpZGF0ZUV4dGVuc2lvbkRvdWJsZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRwaW5Db2RlOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAncGluQ29kZScsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ251bWJlcicsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3JfVmFsaWRhdGVQaW5OdW1iZXIsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0Ly8g0JTQuNC90LDQvNC40YfQtdGB0LrQsNGPINC/0YDQvtCy0LXRgNC60LAg0YHQstC+0LHQvtC00LXQvSDQu9C4INCy0L3Rg9GC0YDQtdC90L3QuNC5INC90L7QvNC10YBcblx0XHRjb25mZXJlbmNlLiRudW1iZXIub24oJ2NoYW5nZScsICgpID0+IHtcblx0XHRcdGNvbnN0IG5ld051bWJlciA9IGNvbmZlcmVuY2UuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2V4dGVuc2lvbicpO1xuXHRcdFx0RXh0ZW5zaW9ucy5jaGVja0F2YWlsYWJpbGl0eShjb25mZXJlbmNlLmRlZmF1bHROdW1iZXIsIG5ld051bWJlcik7XG5cdFx0fSk7XG5cblx0XHRjb25mZXJlbmNlLmluaXRpYWxpemVGb3JtKCk7XG5cdFx0Y29uZmVyZW5jZS5kZWZhdWx0RXh0ZW5zaW9uID0gY29uZmVyZW5jZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZXh0ZW5zaW9uJyk7XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRjb25zdCByZXN1bHQgPSBzZXR0aW5ncztcblx0XHRyZXN1bHQuZGF0YSA9IGNvbmZlcmVuY2UuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdGNiQWZ0ZXJTZW5kRm9ybSgpIHtcblxuXHR9LFxuXHRpbml0aWFsaXplRm9ybSgpIHtcblx0XHRGb3JtLiRmb3JtT2JqID0gY29uZmVyZW5jZS4kZm9ybU9iajtcblx0XHRGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9Y29uZmVyZW5jZS1yb29tcy9zYXZlYDtcblx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBjb25mZXJlbmNlLnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gY29uZmVyZW5jZS5jYkJlZm9yZVNlbmRGb3JtO1xuXHRcdEZvcm0uY2JBZnRlclNlbmRGb3JtID0gY29uZmVyZW5jZS5jYkFmdGVyU2VuZEZvcm07XG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG5cdGNvbmZlcmVuY2UuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==