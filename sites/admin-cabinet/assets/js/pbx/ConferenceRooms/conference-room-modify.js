"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl,globalTranslate, Extensions, Form  */

/**
 * Conference module, providing functionality related to conference room management.
 * @module conference
 */
var conference = {
  // jQuery object referencing the extension field in the conference room form
  $number: $('#extension'),

  /**
   * jQuery object for the form.
   * @type {jQuery}
   */
  $formObj: $('#conference-room-form'),
  // Default value for the extension field in the conference room form
  defaultExtension: '',

  /**
   * Validation rules for the form fields before submission.
   *
   * @type {object}
   */
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cr_ValidateNameEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'number',
        prompt: globalTranslate.cr_ValidateExtensionNumber
      }, {
        type: 'minLength[2]',
        prompt: globalTranslate.cr_ValidateExtensionLen
      }, {
        type: 'empty',
        prompt: globalTranslate.cr_ValidateExtensionEmpty
      }, {
        type: 'existRule[extension-error]',
        prompt: globalTranslate.cr_ValidateExtensionDouble
      }]
    },
    pinCode: {
      identifier: 'pinCode',
      rules: [{
        type: 'number',
        prompt: globalTranslate.cr_ValidatePinNumber
      }]
    }
  },

  /**
   * Initialize the conference room management functionality.
   * This method adds handlers and initializes the form.
   */
  initialize: function initialize() {
    // Add handler to dynamically check if the input number is available
    var timeoutId;
    conference.$number.on('input', function () {
      // Clear the previous timer, if it exists
      if (timeoutId) {
        clearTimeout(timeoutId);
      } // Set a new timer with a delay of 0.5 seconds


      timeoutId = setTimeout(function () {
        // Get the newly entered number
        var newNumber = conference.$formObj.form('get value', 'extension'); // Execute the availability check for the number

        Extensions.checkAvailability(conference.defaultNumber, newNumber);
      }, 500);
    }); // Initialize the conference room form

    conference.initializeForm(); // Get the default extension from the form

    conference.defaultExtension = conference.$formObj.form('get value', 'extension');
  },

  /**
   * Callback function to be called before the form is sent
   * @param {Object} settings - The current settings of the form
   * @returns {Object} - The updated settings of the form
   */
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = conference.$formObj.form('get values');
    return result;
  },

  /**
   * Callback function to be called after the form has been sent.
   * @param {Object} response - The response from the server after the form is sent
   */
  cbAfterSendForm: function cbAfterSendForm(response) {},

  /**
   * Initialize the form with custom settings
   */
  initializeForm: function initializeForm() {
    Form.$formObj = conference.$formObj;
    Form.url = "".concat(globalRootUrl, "conference-rooms/save"); // Form submission URL

    Form.validateRules = conference.validateRules; // Form validation rules

    Form.cbBeforeSendForm = conference.cbBeforeSendForm; // Callback before form is sent

    Form.cbAfterSendForm = conference.cbAfterSendForm; // Callback after form is sent

    Form.initialize();
  }
};
/**
 * Checks if the number is taken by another account
 * @returns {boolean} True if the parameter has the 'hidden' class, false otherwise
 */

$.fn.form.settings.rules.existRule = function (value, parameter) {
  return $("#".concat(parameter)).hasClass('hidden');
}; // Initialize the conference room modify form when the document is ready


$(document).ready(function () {
  conference.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Db25mZXJlbmNlUm9vbXMvY29uZmVyZW5jZS1yb29tLW1vZGlmeS5qcyJdLCJuYW1lcyI6WyJjb25mZXJlbmNlIiwiJG51bWJlciIsIiQiLCIkZm9ybU9iaiIsImRlZmF1bHRFeHRlbnNpb24iLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJjcl9WYWxpZGF0ZU5hbWVFbXB0eSIsImV4dGVuc2lvbiIsImNyX1ZhbGlkYXRlRXh0ZW5zaW9uTnVtYmVyIiwiY3JfVmFsaWRhdGVFeHRlbnNpb25MZW4iLCJjcl9WYWxpZGF0ZUV4dGVuc2lvbkVtcHR5IiwiY3JfVmFsaWRhdGVFeHRlbnNpb25Eb3VibGUiLCJwaW5Db2RlIiwiY3JfVmFsaWRhdGVQaW5OdW1iZXIiLCJpbml0aWFsaXplIiwidGltZW91dElkIiwib24iLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwibmV3TnVtYmVyIiwiZm9ybSIsIkV4dGVuc2lvbnMiLCJjaGVja0F2YWlsYWJpbGl0eSIsImRlZmF1bHROdW1iZXIiLCJpbml0aWFsaXplRm9ybSIsImNiQmVmb3JlU2VuZEZvcm0iLCJzZXR0aW5ncyIsInJlc3VsdCIsImRhdGEiLCJjYkFmdGVyU2VuZEZvcm0iLCJyZXNwb25zZSIsIkZvcm0iLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwiZm4iLCJleGlzdFJ1bGUiLCJ2YWx1ZSIsInBhcmFtZXRlciIsImhhc0NsYXNzIiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBTUEsVUFBVSxHQUFHO0FBQ2Y7QUFDQUMsRUFBQUEsT0FBTyxFQUFFQyxDQUFDLENB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LGNBOUdlLDRCQThHRTtBQUNiTyxJQUFBQSxJQUFJLENBQUNsQyxRQUFMLEdBQWdCSCxVQUFVLENBQUNHLFFBQTNCO0FBQ0FrQyxJQUFBQSxJQUFJLENBQUNDLEdBQUwsYUFBY0MsYUFBZCwyQkFGYSxDQUV1Qzs7QUFDcERGLElBQUFBLElBQUksQ0FBQ2hDLGFBQUwsR0FBcUJMLFVBQVUsQ0FBQ0ssYUFBaEMsQ0FIYSxDQUdrQzs7QUFDL0NnQyxJQUFBQSxJQUFJLENBQUNOLGdCQUFMLEdBQXdCL0IsVUFBVSxDQUFDK0IsZ0JBQW5DLENBSmEsQ0FJd0M7O0FBQ3JETSxJQUFBQSxJQUFJLENBQUNGLGVBQUwsR0FBdUJuQyxVQUFVLENBQUNtQyxlQUFsQyxDQUxhLENBS3NDOztBQUNuREUsSUFBQUEsSUFBSSxDQUFDakIsVUFBTDtBQUNIO0FBckhjLENBQW5CO0FBd0hBO0FBQ0E7QUFDQTtBQUNBOztBQUNBbEIsQ0FBQyxDQUFDc0MsRUFBRixDQUFLZCxJQUFMLENBQVVNLFFBQVYsQ0FBbUJ4QixLQUFuQixDQUF5QmlDLFNBQXpCLEdBQXFDLFVBQUNDLEtBQUQsRUFBUUMsU0FBUjtBQUFBLFNBQXNCekMsQ0FBQyxZQUFLeUMsU0FBTCxFQUFELENBQW1CQyxRQUFuQixDQUE0QixRQUE1QixDQUF0QjtBQUFBLENBQXJDLEMsQ0FHQTs7O0FBQ0ExQyxDQUFDLENBQUMyQyxRQUFELENBQUQsQ0FBWUMsS0FBWixDQUFrQixZQUFNO0FBQ3BCOUMsRUFBQUEsVUFBVSxDQUFDb0IsVUFBWDtBQUNILENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IMKpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCxnbG9iYWxUcmFuc2xhdGUsIEV4dGVuc2lvbnMsIEZvcm0gICovXG5cbi8qKlxuICogQ29uZmVyZW5jZSBtb2R1bGUsIHByb3ZpZGluZyBmdW5jdGlvbmFsaXR5IHJlbGF0ZWQgdG8gY29uZmVyZW5jZSByb29tIG1hbmFnZW1lbnQuXG4gKiBAbW9kdWxlIGNvbmZlcmVuY2VcbiAqL1xuY29uc3QgY29uZmVyZW5jZSA9IHtcbiAgICAvLyBqUXVlcnkgb2JqZWN0IHJlZmVyZW5jaW5nIHRoZSBleHRlbnNpb24gZmllbGQgaW4gdGhlIGNvbmZlcmVuY2Ugcm9vbSBmb3JtXG4gICAgJG51bWJlcjogJCgnI2V4dGVuc2lvbicpLFxuXG4gICAgLyoqXG4gICAgICogalF1ZXJ5IG9iamVjdCBmb3IgdGhlIGZvcm0uXG4gICAgICogQHR5cGUge2pRdWVyeX1cbiAgICAgKi9cbiAgICAkZm9ybU9iajogJCgnI2NvbmZlcmVuY2Utcm9vbS1mb3JtJyksXG5cbiAgICAvLyBEZWZhdWx0IHZhbHVlIGZvciB0aGUgZXh0ZW5zaW9uIGZpZWxkIGluIHRoZSBjb25mZXJlbmNlIHJvb20gZm9ybVxuICAgIGRlZmF1bHRFeHRlbnNpb246ICcnLFxuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGlvbiBydWxlcyBmb3IgdGhlIGZvcm0gZmllbGRzIGJlZm9yZSBzdWJtaXNzaW9uLlxuICAgICAqXG4gICAgICogQHR5cGUge29iamVjdH1cbiAgICAgKi9cbiAgICB2YWxpZGF0ZVJ1bGVzOiB7XG4gICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICduYW1lJyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZW1wdHknLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jcl9WYWxpZGF0ZU5hbWVFbXB0eSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgICAgZXh0ZW5zaW9uOiB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiAnZXh0ZW5zaW9uJyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3JfVmFsaWRhdGVFeHRlbnNpb25OdW1iZXIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdtaW5MZW5ndGhbMl0nLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5jcl9WYWxpZGF0ZUV4dGVuc2lvbkxlbixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2VtcHR5JyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3JfVmFsaWRhdGVFeHRlbnNpb25FbXB0eSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2V4aXN0UnVsZVtleHRlbnNpb24tZXJyb3JdJyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3JfVmFsaWRhdGVFeHRlbnNpb25Eb3VibGUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHBpbkNvZGU6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICdwaW5Db2RlJyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuY3JfVmFsaWRhdGVQaW5OdW1iZXIsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBjb25mZXJlbmNlIHJvb20gbWFuYWdlbWVudCBmdW5jdGlvbmFsaXR5LlxuICAgICAqIFRoaXMgbWV0aG9kIGFkZHMgaGFuZGxlcnMgYW5kIGluaXRpYWxpemVzIHRoZSBmb3JtLlxuICAgICAqL1xuICAgIGluaXRpYWxpemUoKSB7XG5cbiAgICAgICAgLy8gQWRkIGhhbmRsZXIgdG8gZHluYW1pY2FsbHkgY2hlY2sgaWYgdGhlIGlucHV0IG51bWJlciBpcyBhdmFpbGFibGVcbiAgICAgICAgbGV0IHRpbWVvdXRJZDtcbiAgICAgICAgY29uZmVyZW5jZS4kbnVtYmVyLm9uKCdpbnB1dCcsICgpID0+IHtcbiAgICAgICAgICAgIC8vIENsZWFyIHRoZSBwcmV2aW91cyB0aW1lciwgaWYgaXQgZXhpc3RzXG4gICAgICAgICAgICBpZiAodGltZW91dElkKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBTZXQgYSBuZXcgdGltZXIgd2l0aCBhIGRlbGF5IG9mIDAuNSBzZWNvbmRzXG4gICAgICAgICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIG5ld2x5IGVudGVyZWQgbnVtYmVyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3TnVtYmVyID0gY29uZmVyZW5jZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZXh0ZW5zaW9uJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBFeGVjdXRlIHRoZSBhdmFpbGFiaWxpdHkgY2hlY2sgZm9yIHRoZSBudW1iZXJcbiAgICAgICAgICAgICAgICBFeHRlbnNpb25zLmNoZWNrQXZhaWxhYmlsaXR5KGNvbmZlcmVuY2UuZGVmYXVsdE51bWJlciwgbmV3TnVtYmVyKTtcbiAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEluaXRpYWxpemUgdGhlIGNvbmZlcmVuY2Ugcm9vbSBmb3JtXG4gICAgICAgIGNvbmZlcmVuY2UuaW5pdGlhbGl6ZUZvcm0oKTtcblxuICAgICAgICAvLyBHZXQgdGhlIGRlZmF1bHQgZXh0ZW5zaW9uIGZyb20gdGhlIGZvcm1cbiAgICAgICAgY29uZmVyZW5jZS5kZWZhdWx0RXh0ZW5zaW9uID0gY29uZmVyZW5jZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnZXh0ZW5zaW9uJyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBiZWZvcmUgdGhlIGZvcm0gaXMgc2VudFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyAtIFRoZSBjdXJyZW50IHNldHRpbmdzIG9mIHRoZSBmb3JtXG4gICAgICogQHJldHVybnMge09iamVjdH0gLSBUaGUgdXBkYXRlZCBzZXR0aW5ncyBvZiB0aGUgZm9ybVxuICAgICAqL1xuICAgIGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gc2V0dGluZ3M7XG4gICAgICAgIHJlc3VsdC5kYXRhID0gY29uZmVyZW5jZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBhZnRlciB0aGUgZm9ybSBoYXMgYmVlbiBzZW50LlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZSAtIFRoZSByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIgYWZ0ZXIgdGhlIGZvcm0gaXMgc2VudFxuICAgICAqL1xuICAgIGNiQWZ0ZXJTZW5kRm9ybShyZXNwb25zZSkge1xuXG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBmb3JtIHdpdGggY3VzdG9tIHNldHRpbmdzXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZUZvcm0oKSB7XG4gICAgICAgIEZvcm0uJGZvcm1PYmogPSBjb25mZXJlbmNlLiRmb3JtT2JqO1xuICAgICAgICBGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9Y29uZmVyZW5jZS1yb29tcy9zYXZlYDsgLy8gRm9ybSBzdWJtaXNzaW9uIFVSTFxuICAgICAgICBGb3JtLnZhbGlkYXRlUnVsZXMgPSBjb25mZXJlbmNlLnZhbGlkYXRlUnVsZXM7IC8vIEZvcm0gdmFsaWRhdGlvbiBydWxlc1xuICAgICAgICBGb3JtLmNiQmVmb3JlU2VuZEZvcm0gPSBjb25mZXJlbmNlLmNiQmVmb3JlU2VuZEZvcm07IC8vIENhbGxiYWNrIGJlZm9yZSBmb3JtIGlzIHNlbnRcbiAgICAgICAgRm9ybS5jYkFmdGVyU2VuZEZvcm0gPSBjb25mZXJlbmNlLmNiQWZ0ZXJTZW5kRm9ybTsgLy8gQ2FsbGJhY2sgYWZ0ZXIgZm9ybSBpcyBzZW50XG4gICAgICAgIEZvcm0uaW5pdGlhbGl6ZSgpO1xuICAgIH0sXG59O1xuXG4vKipcbiAqIENoZWNrcyBpZiB0aGUgbnVtYmVyIGlzIHRha2VuIGJ5IGFub3RoZXIgYWNjb3VudFxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIHBhcmFtZXRlciBoYXMgdGhlICdoaWRkZW4nIGNsYXNzLCBmYWxzZSBvdGhlcndpc2VcbiAqL1xuJC5mbi5mb3JtLnNldHRpbmdzLnJ1bGVzLmV4aXN0UnVsZSA9ICh2YWx1ZSwgcGFyYW1ldGVyKSA9PiAkKGAjJHtwYXJhbWV0ZXJ9YCkuaGFzQ2xhc3MoJ2hpZGRlbicpO1xuXG5cbi8vIEluaXRpYWxpemUgdGhlIGNvbmZlcmVuY2Ugcm9vbSBtb2RpZnkgZm9ybSB3aGVuIHRoZSBkb2N1bWVudCBpcyByZWFkeVxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIGNvbmZlcmVuY2UuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==