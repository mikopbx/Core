"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2020 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, globalTranslate */
var Form = {
  $formObj: '',
  validateRules: {},
  url: '',
  cbBeforeSendForm: '',
  cbAfterSendForm: '',
  $submitButton: $('#submitbutton'),
  $dropdownSubmit: $('#dropdownSubmit'),
  $submitModeInput: $('input[name="submitMode"]'),
  processData: true,
  contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
  keyboardShortcuts: true,
  enableDirrity: true,
  afterSubmitIndexUrl: '',
  afterSubmitModifyUrl: '',
  oldFormValues: [],
  initialize: function initialize() {
    Form.$formObj.form.settings.rules.notRegExp = Form.notRegExpValidateRule;
    Form.$formObj.form.settings.rules.specialCharactersExist = Form.specialCharactersExistValidateRule;
    if (Form.enableDirrity) Form.initializeDirrity();
    Form.$submitButton.on('click', function (e) {
      e.preventDefault();
      if (Form.$submitButton.hasClass('loading')) return;
      if (Form.$submitButton.hasClass('disabled')) return;
      Form.$formObj.form({
        on: 'blur',
        fields: Form.validateRules,
        onSuccess: function onSuccess() {
          Form.submitForm();
        },
        onFailure: function onFailure() {
          Form.$formObj.removeClass('error').addClass('error');
        }
      });
      Form.$formObj.form('validate form');
    });

    if (Form.$dropdownSubmit.length > 0) {
      Form.$dropdownSubmit.dropdown({
        onChange: function onChange(value) {
          var translateKey = "bt_".concat(value);
          Form.$submitModeInput.val(value);
          Form.$submitButton.html("<i class=\"save icon\"></i> ".concat(globalTranslate[translateKey])).click();
        }
      });
    }

    Form.$formObj.on('submit', function (e) {
      e.preventDefault();
    });
  },

  /**
   * Инициализация отслеживания изменений формы
   */
  initializeDirrity: function initializeDirrity() {
    Form.saveInitialValues();
    Form.setEvents();
    Form.$submitButton.addClass('disabled');
    Form.$dropdownSubmit.addClass('disabled');
  },

  /**
   * Сохраняет первоначальные значения для проверки на изменения формы
   */
  saveInitialValues: function saveInitialValues() {
    Form.oldFormValues = Form.$formObj.form('get values');
  },

  /**
   * Запускает обработчики изменения объектов формы
   */
  setEvents: function setEvents() {
    Form.$formObj.find('input, select').change(function () {
      Form.checkValues();
    });
    Form.$formObj.find('input, textarea').on('keyup keydown blur', function () {
      Form.checkValues();
    });
    Form.$formObj.find('.ui.checkbox').on('click', function () {
      Form.checkValues();
    });
  },

  /**
   * Сверяет изменения старых и новых значений формы
   */
  checkValues: function checkValues() {
    var newFormValues = Form.$formObj.form('get values');

    if (JSON.stringify(Form.oldFormValues) === JSON.stringify(newFormValues)) {
      Form.$submitButton.addClass('disabled');
      Form.$dropdownSubmit.addClass('disabled');
    } else {
      Form.$submitButton.removeClass('disabled');
      Form.$dropdownSubmit.removeClass('disabled');
    }
  },

  /**
   * Отправка формы на сервер
   */
  submitForm: function submitForm() {
    $.api({
      url: Form.url,
      on: 'now',
      method: 'POST',
      processData: Form.processData,
      contentType: Form.contentType,
      keyboardShortcuts: Form.keyboardShortcuts,
      beforeSend: function beforeSend(settings) {
        Form.$submitButton.addClass('loading');
        var cbBeforeSendResult = Form.cbBeforeSendForm(settings);

        if (cbBeforeSendResult === false) {
          Form.$submitButton.transition('shake').removeClass('loading');
        } else {
          $.each(cbBeforeSendResult.data, function (index, value) {
            if (index.indexOf('ecret') > -1 || index.indexOf('assword') > -1) return;
            if (typeof value === 'string') cbBeforeSendResult.data[index] = value.trim();
          });
        }

        return cbBeforeSendResult;
      },
      onSuccess: function onSuccess(response) {
        $('.ui.message.ajax').remove();
        $.each(response.message, function (index, value) {
          if (index === 'error') {
            Form.$submitButton.transition('shake').removeClass('loading');
            Form.$formObj.after("<div class=\"ui ".concat(index, " message ajax\">").concat(value, "</div>"));
          }
        });
        var event = document.createEvent('Event');
        event.initEvent('ConfigDataChanged', false, true);
        window.dispatchEvent(event);
        Form.cbAfterSendForm(response);

        if (response.success && response.reload.length > 0 && Form.$submitModeInput.val() === 'SaveSettings') {
          window.location = globalRootUrl + response.reload;
        } else if (response.success && Form.$submitModeInput.val() === 'SaveSettingsAndAddNew') {
          if (Form.afterSubmitModifyUrl.length > 1) {
            window.location = Form.afterSubmitModifyUrl;
          } else {
            var emptyUrl = window.location.href.split('modify');
            var action = 'modify';
            var prefixData = emptyUrl[1].split('/');

            if (prefixData.length > 0) {
              action = action + prefixData[0];
            }

            if (emptyUrl.length > 1) {
              window.location = "".concat(emptyUrl[0]).concat(action, "/");
            }
          }
        } else if (response.success && Form.$submitModeInput.val() === 'SaveSettingsAndExit') {
          if (Form.afterSubmitIndexUrl.length > 1) {
            window.location = Form.afterSubmitIndexUrl;
          } else {
            var _emptyUrl = window.location.href.split('modify');

            if (_emptyUrl.length > 1) {
              window.location = "".concat(_emptyUrl[0], "index/");
            }
          }
        } else if (response.success && response.reload.length > 0) {
          window.location = globalRootUrl + response.reload;
        } else if (response.success && Form.enableDirrity) {
          Form.initializeDirrity();
        }

        Form.$submitButton.removeClass('loading');
      },
      onFailure: function onFailure(response) {
        Form.$formObj.after(response);
        Form.$submitButton.transition('shake').removeClass('loading');
      }
    });
  },

  /**
   * Возвращщает ИСТИНА, если значение НЕ соответствует Regex.
   * @param value
   * @param regex
   * @returns {boolean}
   */
  notRegExpValidateRule: function notRegExpValidateRule(value, regex) {
    return value.match(regex) !== null;
  },

  /**
   * Возвращщает ИСТИНА, если значение содержит спецсимволы.
   * @param value
   * @returns {boolean}
   */
  specialCharactersExistValidateRule: function specialCharactersExistValidateRule(value) {
    return value.match(/[()$^;#"><,.%№@!+=_]/) === null;
  }
}; // export default Form;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYWluL2Zvcm0uanMiXSwibmFtZXMiOlsiRm9ybSIsIiRmb3JtT2JqIiwidmFsaWRhdGVSdWxlcyIsInVybCIsImNiQmVmb3JlU2VuZEZvcm0iLCJjYkFmdGVyU2VuZEZvcm0iLCIkc3VibWl0QnV0dG9uIiwiJCIsIiRkcm9wZG93blN1Ym1pdCIsIiRzdWJtaXRNb2RlSW5wdXQiLCJwcm9jZXNzRGF0YSIsImNvbnRlbnRUeXBlIiwia2V5Ym9hcmRTaG9ydGN1dHMiLCJlbmFibGVEaXJyaXR5IiwiYWZ0ZXJTdWJtaXRJbmRleFVybCIsImFmdGVyU3VibWl0TW9kaWZ5VXJsIiwib2xkRm9ybVZhbHVlcyIsImluaXRpYWxpemUiLCJmb3JtIiwic2V0dGluZ3MiLCJydWxlcyIsIm5vdFJlZ0V4cCIsIm5vdFJlZ0V4cFZhbGlkYXRlUnVsZSIsInNwZWNpYWxDaGFyYWN0ZXJzRXhpc3QiLCJzcGVjaWFsQ2hhcmFjdGVyc0V4aXN0VmFsaWRhdGVSdWxlIiwiaW5pdGlhbGl6ZURpcnJpdHkiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImhhc0NsYXNzIiwiZmllbGRzIiwib25TdWNjZXNzIiwic3VibWl0Rm9ybSIsIm9uRmFpbHVyZSIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJsZW5ndGgiLCJkcm9wZG93biIsIm9uQ2hhbmdlIiwidmFsdWUiLCJ0cmFuc2xhdGVLZXkiLCJ2YWwiLCJodG1sIiwiZ2xvYmFsVHJhbnNsYXRlIiwiY2xpY2siLCJzYXZlSW5pdGlhbFZhbHVlcyIsInNldEV2ZW50cyIsImZpbmQiLCJjaGFuZ2UiLCJjaGVja1ZhbHVlcyIsIm5ld0Zvcm1WYWx1ZXMiLCJKU09OIiwic3RyaW5naWZ5IiwiYXBpIiwibWV0aG9kIiwiYmVmb3JlU2VuZCIsImNiQmVmb3JlU2VuZFJlc3VsdCIsInRyYW5zaXRpb24iLCJlYWNoIiwiZGF0YSIsImluZGV4IiwiaW5kZXhPZiIsInRyaW0iLCJyZXNwb25zZSIsInJlbW92ZSIsIm1lc3NhZ2UiLCJhZnRlciIsImV2ZW50IiwiZG9jdW1lbnQiLCJjcmVhdGVFdmVudCIsImluaXRFdmVudCIsIndpbmRvdyIsImRpc3BhdGNoRXZlbnQiLCJzdWNjZXNzIiwicmVsb2FkIiwibG9jYXRpb24iLCJnbG9iYWxSb290VXJsIiwiZW1wdHlVcmwiLCJocmVmIiwic3BsaXQiLCJhY3Rpb24iLCJwcmVmaXhEYXRhIiwicmVnZXgiLCJtYXRjaCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUEsSUFBTUEsSUFBSSxHQUFHO0FBQ1pDLEVBQUFBLFFBQVEsRUFBRSxFQURFO0FBRVpDLEVBQUFBLGFBQWEsRUFBRSxFQUZIO0FBR1pDLEVBQUFBLEdBQUcsRUFBRSxFQUhPO0FBSVpDLEVBQUFBLGdCQUFnQixFQUFFLEVBSk47QUFLWkMsRUFBQUEsZUFBZSxFQUFFLEVBTEw7QUFNWkMsRUFBQUEsYUFBYSxFQUFFQyxDQUFDLENBQUMsZUFBRCxDQU5KO0FBT1pDLEVBQUFBLGVBQWUsRUFBRUQsQ0FBQyxDQUFDLGlCQUFELENBUE47QUFRWkUsRUFBQUEsZ0JBQWdCLEVBQUVGLENBQUMsQ0FBQywwQkFBRCxDQVJQO0FBU1pHLEVBQUFBLFdBQVcsRUFBRSxJQVREO0FBVVpDLEVBQUFBLFdBQVcsRUFBRSxrREFWRDtBQVdaQyxFQUFBQSxpQkFBaUIsRUFBRSxJQVhQO0FBWVpDLEVBQUFBLGFBQWEsRUFBRSxJQVpIO0FBYVpDLEVBQUFBLG1CQUFtQixFQUFFLEVBYlQ7QUFjWkMsRUFBQUEsb0JBQW9CLEVBQUUsRUFkVjtBQWVaQyxFQUFBQSxhQUFhLEVBQUUsRUFmSDtBQWdCWkMsRUFBQUEsVUFoQlksd0JBZ0JDO0FBQ1pqQixJQUFBQSxJQUFJLENBQUNDLFFBQUwsQ0FBY2lCLElBQWQsQ0FBbUJDLFFBQW5CLENBQTRCQyxLQUE1QixDQUFrQ0MsU0FBbEMsR0FBa0RyQixJ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Q21DLFVBQUFBLE1BQU0sQ0FBQ0ksUUFBUCxHQUFrQkMsYUFBYSxHQUFHYixRQUFRLENBQUNXLE1BQTNDO0FBQ0EsU0FITSxNQUdBLElBQUlYLFFBQVEsQ0FBQ1UsT0FBVCxJQUFvQnpFLElBQUksQ0FBQ2EsYUFBN0IsRUFBNEM7QUFDbERiLFVBQUFBLElBQUksQ0FBQ3lCLGlCQUFMO0FBQ0E7O0FBQ0R6QixRQUFBQSxJQUFJLENBQUNNLGFBQUwsQ0FBbUI0QixXQUFuQixDQUErQixTQUEvQjtBQUNBLE9BcEVJO0FBcUVMRCxNQUFBQSxTQXJFSyxxQkFxRUs4QixRQXJFTCxFQXFFZTtBQUNuQi9ELFFBQUFBLElBQUksQ0FBQ0MsUUFBTCxDQUFjaUUsS0FBZCxDQUFvQkgsUUFBcEI7QUFDQS9ELFFBQUFBLElBQUksQ0FBQ00sYUFBTCxDQUNFbUQsVUFERixDQUNhLE9BRGIsRUFFRXZCLFdBRkYsQ0FFYyxTQUZkO0FBR0E7QUExRUksS0FBTjtBQTZFQSxHQWhMVzs7QUFrTFo7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0NaLEVBQUFBLHFCQXhMWSxpQ0F3TFVpQixLQXhMVixFQXdMaUIyQyxLQXhMakIsRUF3THVCO0FBQ2xDLFdBQU8zQyxLQUFLLENBQUM0QyxLQUFOLENBQVlELEtBQVosTUFBdUIsSUFBOUI7QUFDQSxHQTFMVzs7QUE0TFo7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNDMUQsRUFBQUEsa0NBak1ZLDhDQWlNdUJlLEtBak12QixFQWlNNkI7QUFDeEMsV0FBT0EsS0FBSyxDQUFDNEMsS0FBTixDQUFZLHNCQUFaLE1BQXdDLElBQS9DO0FBQ0E7QUFuTVcsQ0FBYixDLENBc01BIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCAoQykgMjAxNy0yMDIwIEFsZXhleSBQb3J0bm92IGFuZCBOaWtvbGF5IEJla2V0b3ZcbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uXG4gKiBJZiBub3QsIHNlZSA8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICovXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLCBnbG9iYWxUcmFuc2xhdGUgKi9cblxuY29uc3QgRm9ybSA9IHtcblx0JGZvcm1PYmo6ICcnLFxuXHR2YWxpZGF0ZVJ1bGVzOiB7fSxcblx0dXJsOiAnJyxcblx0Y2JCZWZvcmVTZW5kRm9ybTogJycsXG5cdGNiQWZ0ZXJTZW5kRm9ybTogJycsXG5cdCRzdWJtaXRCdXR0b246ICQoJyNzdWJtaXRidXR0b24nKSxcblx0JGRyb3Bkb3duU3VibWl0OiAkKCcjZHJvcGRvd25TdWJtaXQnKSxcblx0JHN1Ym1pdE1vZGVJbnB1dDogJCgnaW5wdXRbbmFtZT1cInN1Ym1pdE1vZGVcIl0nKSxcblx0cHJvY2Vzc0RhdGE6IHRydWUsXG5cdGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04Jyxcblx0a2V5Ym9hcmRTaG9ydGN1dHM6IHRydWUsXG5cdGVuYWJsZURpcnJpdHk6IHRydWUsXG5cdGFmdGVyU3VibWl0SW5kZXhVcmw6ICcnLFxuXHRhZnRlclN1Ym1pdE1vZGlmeVVybDogJycsXG5cdG9sZEZvcm1WYWx1ZXM6IFtdLFxuXHRpbml0aWFsaXplKCkge1xuXHRcdEZvcm0uJGZvcm1PYmouZm9ybS5zZXR0aW5ncy5ydWxlcy5ub3RSZWdFeHAgXHRcdFx0ID0gRm9ybS5ub3RSZWdFeHBWYWxpZGF0ZVJ1bGU7XG5cdFx0Rm9ybS4kZm9ybU9iai5mb3JtLnNldHRpbmdzLnJ1bGVzLnNwZWNpYWxDaGFyYWN0ZXJzRXhpc3QgPSBGb3JtLnNwZWNpYWxDaGFyYWN0ZXJzRXhpc3RWYWxpZGF0ZVJ1bGU7XG5cdFx0aWYgKEZvcm0uZW5hYmxlRGlycml0eSkgRm9ybS5pbml0aWFsaXplRGlycml0eSgpO1xuXG5cdFx0Rm9ybS4kc3VibWl0QnV0dG9uLm9uKCdjbGljaycsIChlKSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRpZiAoRm9ybS4kc3VibWl0QnV0dG9uLmhhc0NsYXNzKCdsb2FkaW5nJykpIHJldHVybjtcblx0XHRcdGlmIChGb3JtLiRzdWJtaXRCdXR0b24uaGFzQ2xhc3MoJ2Rpc2FibGVkJykpIHJldHVybjtcblx0XHRcdEZvcm0uJGZvcm1PYmpcblx0XHRcdFx0LmZvcm0oe1xuXHRcdFx0XHRcdG9uOiAnYmx1cicsXG5cdFx0XHRcdFx0ZmllbGRzOiBGb3JtLnZhbGlkYXRlUnVsZXMsXG5cdFx0XHRcdFx0b25TdWNjZXNzKCkge1xuXHRcdFx0XHRcdFx0Rm9ybS5zdWJtaXRGb3JtKCk7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRvbkZhaWx1cmUoKSB7XG5cdFx0XHRcdFx0XHRGb3JtLiRmb3JtT2JqLnJlbW92ZUNsYXNzKCdlcnJvcicpLmFkZENsYXNzKCdlcnJvcicpO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdH0pO1xuXHRcdFx0Rm9ybS4kZm9ybU9iai5mb3JtKCd2YWxpZGF0ZSBmb3JtJyk7XG5cdFx0fSk7XG5cdFx0aWYgKEZvcm0uJGRyb3Bkb3duU3VibWl0Lmxlbmd0aCA+IDApIHtcblx0XHRcdEZvcm0uJGRyb3Bkb3duU3VibWl0LmRyb3Bkb3duKHtcblx0XHRcdFx0b25DaGFuZ2U6ICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdGNvbnN0IHRyYW5zbGF0ZUtleSA9IGBidF8ke3ZhbHVlfWA7XG5cdFx0XHRcdFx0Rm9ybS4kc3VibWl0TW9kZUlucHV0LnZhbCh2YWx1ZSk7XG5cdFx0XHRcdFx0Rm9ybS4kc3VibWl0QnV0dG9uXG5cdFx0XHRcdFx0XHQuaHRtbChgPGkgY2xhc3M9XCJzYXZlIGljb25cIj48L2k+ICR7Z2xvYmFsVHJhbnNsYXRlW3RyYW5zbGF0ZUtleV19YClcblx0XHRcdFx0XHRcdC5jbGljaygpO1xuXHRcdFx0XHR9LFxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdEZvcm0uJGZvcm1PYmoub24oJ3N1Ym1pdCcsIChlKSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fSk7XG5cdH0sXG5cdC8qKlxuXHQgKiDQmNC90LjRhtC40LDQu9C40LfQsNGG0LjRjyDQvtGC0YHQu9C10LbQuNCy0LDQvdC40Y8g0LjQt9C80LXQvdC10L3QuNC5INGE0L7RgNC80Ytcblx0ICovXG5cdGluaXRpYWxpemVEaXJyaXR5KCkge1xuXHRcdEZvcm0uc2F2ZUluaXRpYWxWYWx1ZXMoKTtcblx0XHRGb3JtLnNldEV2ZW50cygpO1xuXHRcdEZvcm0uJHN1Ym1pdEJ1dHRvbi5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRGb3JtLiRkcm9wZG93blN1Ym1pdC5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0fSxcblx0LyoqXG5cdCAqINCh0L7RhdGA0LDQvdGP0LXRgiDQv9C10YDQstC+0L3QsNGH0LDQu9GM0L3Ri9C1INC30L3QsNGH0LXQvdC40Y8g0LTQu9GPINC/0YDQvtCy0LXRgNC60Lgg0L3QsCDQuNC30LzQtdC90LXQvdC40Y8g0YTQvtGA0LzRi1xuXHQgKi9cblx0c2F2ZUluaXRpYWxWYWx1ZXMoKSB7XG5cdFx0Rm9ybS5vbGRGb3JtVmFsdWVzID0gRm9ybS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG5cdH0sXG5cdC8qKlxuXHQgKiDQl9Cw0L/Rg9GB0LrQsNC10YIg0L7QsdGA0LDQsdC+0YLRh9C40LrQuCDQuNC30LzQtdC90LXQvdC40Y8g0L7QsdGK0LXQutGC0L7QsiDRhNC+0YDQvNGLXG5cdCAqL1xuXHRzZXRFdmVudHMoKSB7XG5cdFx0Rm9ybS4kZm9ybU9iai5maW5kKCdpbnB1dCwgc2VsZWN0JykuY2hhbmdlKCgpID0+IHtcblx0XHRcdEZvcm0uY2hlY2tWYWx1ZXMoKTtcblx0XHR9KTtcblx0XHRGb3JtLiRmb3JtT2JqLmZpbmQoJ2lucHV0LCB0ZXh0YXJlYScpLm9uKCdrZXl1cCBrZXlkb3duIGJsdXInLCAoKSA9PiB7XG5cdFx0XHRGb3JtLmNoZWNrVmFsdWVzKCk7XG5cdFx0fSk7XG5cdFx0Rm9ybS4kZm9ybU9iai5maW5kKCcudWkuY2hlY2tib3gnKS5vbignY2xpY2snLCAoKSA9PiB7XG5cdFx0XHRGb3JtLmNoZWNrVmFsdWVzKCk7XG5cdFx0fSk7XG5cdH0sXG5cdC8qKlxuXHQgKiDQodCy0LXRgNGP0LXRgiDQuNC30LzQtdC90LXQvdC40Y8g0YHRgtCw0YDRi9GFINC4INC90L7QstGL0YUg0LfQvdCw0YfQtdC90LjQuSDRhNC+0YDQvNGLXG5cdCAqL1xuXHRjaGVja1ZhbHVlcygpIHtcblx0XHRjb25zdCBuZXdGb3JtVmFsdWVzID0gRm9ybS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG5cdFx0aWYgKEpTT04uc3RyaW5naWZ5KEZvcm0ub2xkRm9ybVZhbHVlcykgPT09IEpTT04uc3RyaW5naWZ5KG5ld0Zvcm1WYWx1ZXMpKSB7XG5cdFx0XHRGb3JtLiRzdWJtaXRCdXR0b24uYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRGb3JtLiRkcm9wZG93blN1Ym1pdC5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Rm9ybS4kc3VibWl0QnV0dG9uLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0Rm9ybS4kZHJvcGRvd25TdWJtaXQucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0fVxuXHR9LFxuXHQvKipcblx0ICog0J7RgtC/0YDQsNCy0LrQsCDRhNC+0YDQvNGLINC90LAg0YHQtdGA0LLQtdGAXG5cdCAqL1xuXHRzdWJtaXRGb3JtKCkge1xuXHRcdCQuYXBpKHtcblx0XHRcdHVybDogRm9ybS51cmwsXG5cdFx0XHRvbjogJ25vdycsXG5cdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdHByb2Nlc3NEYXRhOiBGb3JtLnByb2Nlc3NEYXRhLFxuXHRcdFx0Y29udGVudFR5cGU6IEZvcm0uY29udGVudFR5cGUsXG5cdFx0XHRrZXlib2FyZFNob3J0Y3V0czogRm9ybS5rZXlib2FyZFNob3J0Y3V0cyxcblx0XHRcdGJlZm9yZVNlbmQoc2V0dGluZ3MpIHtcblx0XHRcdFx0Rm9ybS4kc3VibWl0QnV0dG9uLmFkZENsYXNzKCdsb2FkaW5nJyk7XG5cdFx0XHRcdGNvbnN0IGNiQmVmb3JlU2VuZFJlc3VsdCA9IEZvcm0uY2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncyk7XG5cdFx0XHRcdGlmIChjYkJlZm9yZVNlbmRSZXN1bHQgPT09IGZhbHNlKSB7XG5cdFx0XHRcdFx0Rm9ybS4kc3VibWl0QnV0dG9uXG5cdFx0XHRcdFx0XHQudHJhbnNpdGlvbignc2hha2UnKVxuXHRcdFx0XHRcdFx0LnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0JC5lYWNoKGNiQmVmb3JlU2VuZFJlc3VsdC5kYXRhLCAoaW5kZXgsIHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAoaW5kZXguaW5kZXhPZignZWNyZXQnKSA+IC0xIHx8IGluZGV4LmluZGV4T2YoJ2Fzc3dvcmQnKSA+IC0xKSByZXR1cm47XG5cdFx0XHRcdFx0XHRpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgY2JCZWZvcmVTZW5kUmVzdWx0LmRhdGFbaW5kZXhdID0gdmFsdWUudHJpbSgpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBjYkJlZm9yZVNlbmRSZXN1bHQ7XG5cdFx0XHR9LFxuXHRcdFx0b25TdWNjZXNzKHJlc3BvbnNlKSB7XG5cdFx0XHRcdCQoJy51aS5tZXNzYWdlLmFqYXgnKS5yZW1vdmUoKTtcblx0XHRcdFx0JC5lYWNoKHJlc3BvbnNlLm1lc3NhZ2UsIChpbmRleCwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRpZiAoaW5kZXggPT09ICdlcnJvcicpIHtcblx0XHRcdFx0XHRcdEZvcm0uJHN1Ym1pdEJ1dHRvbi50cmFuc2l0aW9uKCdzaGFrZScpLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG5cdFx0XHRcdFx0XHRGb3JtLiRmb3JtT2JqLmFmdGVyKGA8ZGl2IGNsYXNzPVwidWkgJHtpbmRleH0gbWVzc2FnZSBhamF4XCI+JHt2YWx1ZX08L2Rpdj5gKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRjb25zdCBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudCcpO1xuXHRcdFx0XHRldmVudC5pbml0RXZlbnQoJ0NvbmZpZ0RhdGFDaGFuZ2VkJywgZmFsc2UsIHRydWUpO1xuXHRcdFx0XHR3aW5kb3cuZGlzcGF0Y2hFdmVudChldmVudCk7XG5cdFx0XHRcdEZvcm0uY2JBZnRlclNlbmRGb3JtKHJlc3BvbnNlKTtcblx0XHRcdFx0aWYgKHJlc3BvbnNlLnN1Y2Nlc3Ncblx0XHRcdFx0XHQmJiByZXNwb25zZS5yZWxvYWQubGVuZ3RoID4gMFxuXHRcdFx0XHRcdCYmIEZvcm0uJHN1Ym1pdE1vZGVJbnB1dC52YWwoKSA9PT0gJ1NhdmVTZXR0aW5ncycpIHtcblx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24gPSBnbG9iYWxSb290VXJsICsgcmVzcG9uc2UucmVsb2FkO1xuXHRcdFx0XHR9IGVsc2UgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MgJiYgRm9ybS4kc3VibWl0TW9kZUlucHV0LnZhbCgpID09PSAnU2F2ZVNldHRpbmdzQW5kQWRkTmV3Jykge1xuXHRcdFx0XHRcdGlmIChGb3JtLmFmdGVyU3VibWl0TW9kaWZ5VXJsLmxlbmd0aCA+IDEpe1xuXHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uID0gRm9ybS5hZnRlclN1Ym1pdE1vZGlmeVVybDtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0Y29uc3QgZW1wdHlVcmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnbW9kaWZ5Jyk7XG5cdFx0XHRcdFx0XHRsZXQgYWN0aW9uID0gJ21vZGlmeSc7XG5cdFx0XHRcdFx0XHRsZXQgcHJlZml4RGF0YSA9IGVtcHR5VXJsWzFdLnNwbGl0KCcvJyk7XG5cdFx0XHRcdFx0XHRpZihwcmVmaXhEYXRhLmxlbmd0aCA+IDApe1xuXHRcdFx0XHRcdFx0XHRhY3Rpb24gPSBhY3Rpb24gKyBwcmVmaXhEYXRhWzBdO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0aWYgKGVtcHR5VXJsLmxlbmd0aCA+IDEpIHtcblx0XHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uID0gYCR7ZW1wdHlVcmxbMF19JHthY3Rpb259L2A7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MgJiYgRm9ybS4kc3VibWl0TW9kZUlucHV0LnZhbCgpID09PSAnU2F2ZVNldHRpbmdzQW5kRXhpdCcpIHtcblx0XHRcdFx0XHRpZiAoRm9ybS5hZnRlclN1Ym1pdEluZGV4VXJsLmxlbmd0aCA+IDEpe1xuXHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uID0gRm9ybS5hZnRlclN1Ym1pdEluZGV4VXJsO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjb25zdCBlbXB0eVVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCdtb2RpZnknKTtcblx0XHRcdFx0XHRcdGlmIChlbXB0eVVybC5sZW5ndGggPiAxKSB7XG5cdFx0XHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbiA9IGAke2VtcHR5VXJsWzBdfWluZGV4L2A7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYgKHJlc3BvbnNlLnN1Y2Nlc3Ncblx0XHRcdFx0XHRcdCYmIHJlc3BvbnNlLnJlbG9hZC5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uID0gZ2xvYmFsUm9vdFVybCArIHJlc3BvbnNlLnJlbG9hZDtcblx0XHRcdFx0fSBlbHNlIGlmIChyZXNwb25zZS5zdWNjZXNzICYmIEZvcm0uZW5hYmxlRGlycml0eSkge1xuXHRcdFx0XHRcdEZvcm0uaW5pdGlhbGl6ZURpcnJpdHkoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRGb3JtLiRzdWJtaXRCdXR0b24ucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcblx0XHRcdH0sXG5cdFx0XHRvbkZhaWx1cmUocmVzcG9uc2UpIHtcblx0XHRcdFx0Rm9ybS4kZm9ybU9iai5hZnRlcihyZXNwb25zZSk7XG5cdFx0XHRcdEZvcm0uJHN1Ym1pdEJ1dHRvblxuXHRcdFx0XHRcdC50cmFuc2l0aW9uKCdzaGFrZScpXG5cdFx0XHRcdFx0LnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG5cdFx0XHR9LFxuXG5cdFx0fSk7XG5cdH0sXG5cblx0LyoqXG5cdCAqINCS0L7Qt9Cy0YDQsNGJ0YnQsNC10YIg0JjQodCi0JjQndCQLCDQtdGB0LvQuCDQt9C90LDRh9C10L3QuNC1INCd0JUg0YHQvtC+0YLQstC10YLRgdGC0LLRg9C10YIgUmVnZXguXG5cdCAqIEBwYXJhbSB2YWx1ZVxuXHQgKiBAcGFyYW0gcmVnZXhcblx0ICogQHJldHVybnMge2Jvb2xlYW59XG5cdCAqL1xuXHRub3RSZWdFeHBWYWxpZGF0ZVJ1bGUodmFsdWUsIHJlZ2V4KXtcblx0XHRyZXR1cm4gdmFsdWUubWF0Y2gocmVnZXgpICE9PSBudWxsO1xuXHR9LFxuXG5cdC8qKlxuXHQgKiDQktC+0LfQstGA0LDRidGJ0LDQtdGCINCY0KHQotCY0J3QkCwg0LXRgdC70Lgg0LfQvdCw0YfQtdC90LjQtSDRgdC+0LTQtdGA0LbQuNGCINGB0L/QtdGG0YHQuNC80LLQvtC70YsuXG5cdCAqIEBwYXJhbSB2YWx1ZVxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cblx0ICovXG5cdHNwZWNpYWxDaGFyYWN0ZXJzRXhpc3RWYWxpZGF0ZVJ1bGUodmFsdWUpe1xuXHRcdHJldHVybiB2YWx1ZS5tYXRjaCgvWygpJF47I1wiPjwsLiXihJZAISs9X10vKSA9PT0gbnVsbDtcblx0fVxufTtcblxuLy8gZXhwb3J0IGRlZmF1bHQgRm9ybTtcbiJdfQ==