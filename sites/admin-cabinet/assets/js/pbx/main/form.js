"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2020 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, globalTranslate */
var Form = {
  $formObj: '',
  validateRules: {},
  url: '',
  cbBeforeSendForm: '',
  cbAfterSendForm: '',
  $submitButton: $('#submitbutton'),
  $dropdownSubmit: $('#dropdownSubmit'),
  $submitModeInput: $('input[name="submitMode"]'),
  processData: true,
  contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
  keyboardShortcuts: true,
  enableDirrity: true,
  afterSubmitIndexUrl: '',
  afterSubmitModifyUrl: '',
  oldFormValues: [],
  initialize: function initialize() {
    if (Form.enableDirrity) Form.initializeDirrity();
    Form.$submitButton.on('click', function (e) {
      e.preventDefault();
      if (Form.$submitButton.hasClass('loading')) return;
      if (Form.$submitButton.hasClass('disabled')) return;
      Form.$formObj.form({
        on: 'blur',
        fields: Form.validateRules,
        onSuccess: function onSuccess() {
          Form.submitForm();
        },
        onFailure: function onFailure() {
          Form.$formObj.removeClass('error').addClass('error');
        }
      });
      Form.$formObj.form('validate form');
    });

    if (Form.$dropdownSubmit.length > 0) {
      Form.$dropdownSubmit.dropdown({
        onChange: function onChange(value) {
          var translateKey = "bt_".concat(value);
          Form.$submitModeInput.val(value);
          Form.$submitButton.html("<i class=\"save icon\"></i> ".concat(globalTranslate[translateKey])).click();
        }
      });
    }

    Form.$formObj.on('submit', function (e) {
      e.preventDefault();
    });
  },

  /**
   * Инициализация отслеживания изменений формы
   */
  initializeDirrity: function initializeDirrity() {
    Form.saveInitialValues();
    Form.setEvents();
    Form.$submitButton.addClass('disabled');
    Form.$dropdownSubmit.addClass('disabled');
  },

  /**
   * Сохраняет первоначальные значения для проверки на изменения формы
   */
  saveInitialValues: function saveInitialValues() {
    Form.oldFormValues = Form.$formObj.form('get values');
  },

  /**
   * Запускает обработчики изменения объектов формы
   */
  setEvents: function setEvents() {
    Form.$formObj.find('input, select').change(function () {
      Form.checkValues();
    });
    Form.$formObj.find('input, textarea').on('keyup keydown blur', function () {
      Form.checkValues();
    });
    Form.$formObj.find('.ui.checkbox').on('click', function () {
      Form.checkValues();
    });
  },

  /**
   * Сверяет изменения старых и новых значений формы
   */
  checkValues: function checkValues() {
    var newFormValues = Form.$formObj.form('get values');

    if (JSON.stringify(Form.oldFormValues) === JSON.stringify(newFormValues)) {
      Form.$submitButton.addClass('disabled');
      Form.$dropdownSubmit.addClass('disabled');
    } else {
      Form.$submitButton.removeClass('disabled');
      Form.$dropdownSubmit.removeClass('disabled');
    }
  },

  /**
   * Отправка формы на сервер
   */
  submitForm: function submitForm() {
    $.api({
      url: Form.url,
      on: 'now',
      method: 'POST',
      processData: Form.processData,
      contentType: Form.contentType,
      keyboardShortcuts: Form.keyboardShortcuts,
      beforeSend: function beforeSend(settings) {
        Form.$submitButton.addClass('loading');
        var cbBeforeSendResult = Form.cbBeforeSendForm(settings);

        if (cbBeforeSendResult === false) {
          Form.$submitButton.transition('shake').removeClass('loading');
        } else {
          $.each(cbBeforeSendResult.data, function (index, value) {
            if (index.indexOf('ecret') > -1 || index.indexOf('assword') > -1) return;
            if (typeof value === 'string') cbBeforeSendResult.data[index] = value.trim();
          });
        }

        return cbBeforeSendResult;
      },
      onSuccess: function onSuccess(response) {
        $('.ui.message.ajax').remove();
        $.each(response.message, function (index, value) {
          if (index === 'error') {
            Form.$submitButton.transition('shake').removeClass('loading');
            Form.$formObj.after("<div class=\"ui ".concat(index, " message ajax\">").concat(value, "</div>"));
          }
        });
        var event = document.createEvent('Event');
        event.initEvent('ConfigDataChanged', false, true);
        window.dispatchEvent(event);
        Form.cbAfterSendForm(response);

        if (response.success && response.reload.length > 0 && Form.$submitModeInput.val() === 'SaveSettings') {
          window.location = globalRootUrl + response.reload;
        } else if (response.success && Form.$submitModeInput.val() === 'SaveSettingsAndAddNew') {
          if (Form.afterSubmitModifyUrl.length > 1) {
            window.location = Form.afterSubmitModifyUrl;
          } else {
            var emptyUrl = window.location.href.split('modify');
            var action = 'modify';
            var prefixData = emptyUrl[1].split('/');

            if (prefixData.length > 0) {
              action = action + prefixData[0];
            }

            if (emptyUrl.length > 1) {
              window.location = "".concat(emptyUrl[0]).concat(action, "/");
            }
          }
        } else if (response.success && Form.$submitModeInput.val() === 'SaveSettingsAndExit') {
          if (Form.afterSubmitIndexUrl.length > 1) {
            window.location = Form.afterSubmitIndexUrl;
          } else {
            var _emptyUrl = window.location.href.split('modify');

            if (_emptyUrl.length > 1) {
              window.location = "".concat(_emptyUrl[0], "index/");
            }
          }
        } else if (response.success && response.reload.length > 0) {
          window.location = globalRootUrl + response.reload;
        } else if (Form.enableDirrity) {
          Form.initializeDirrity();
        }

        Form.$submitButton.removeClass('loading');
      },
      onFailure: function onFailure(response) {
        Form.$formObj.after(response);
        Form.$submitButton.transition('shake').removeClass('loading');
      }
    });
  }
}; // export default Form;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYWluL2Zvcm0uanMiXSwibmFtZXMiOlsiRm9ybSIsIiRmb3JtT2JqIiwidmFsaWRhdGVSdWxlcyIsInVybCIsImNiQmVmb3JlU2VuZEZvcm0iLCJjYkFmdGVyU2VuZEZvcm0iLCIkc3VibWl0QnV0dG9uIiwiJCIsIiRkcm9wZG93blN1Ym1pdCIsIiRzdWJtaXRNb2RlSW5wdXQiLCJwcm9jZXNzRGF0YSIsImNvbnRlbnRUeXBlIiwia2V5Ym9hcmRTaG9ydGN1dHMiLCJlbmFibGVEaXJyaXR5IiwiYWZ0ZXJTdWJtaXRJbmRleFVybCIsImFmdGVyU3VibWl0TW9kaWZ5VXJsIiwib2xkRm9ybVZhbHVlcyIsImluaXRpYWxpemUiLCJpbml0aWFsaXplRGlycml0eSIsIm9uIiwiZSIsInByZXZlbnREZWZhdWx0IiwiaGFzQ2xhc3MiLCJmb3JtIiwiZmllbGRzIiwib25TdWNjZXNzIiwic3VibWl0Rm9ybSIsIm9uRmFpbHVyZSIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJsZW5ndGgiLCJkcm9wZG93biIsIm9uQ2hhbmdlIiwidmFsdWUiLCJ0cmFuc2xhdGVLZXkiLCJ2YWwiLCJodG1sIiwiZ2xvYmFsVHJhbnNsYXRlIiwiY2xpY2siLCJzYXZlSW5pdGlhbFZhbHVlcyIsInNldEV2ZW50cyIsImZpbmQiLCJjaGFuZ2UiLCJjaGVja1ZhbHVlcyIsIm5ld0Zvcm1WYWx1ZXMiLCJKU09OIiwic3RyaW5naWZ5IiwiYXBpIiwibWV0aG9kIiwiYmVmb3JlU2VuZCIsInNldHRpbmdzIiwiY2JCZWZvcmVTZW5kUmVzdWx0IiwidHJhbnNpdGlvbiIsImVhY2giLCJkYXRhIiwiaW5kZXgiLCJpbmRleE9mIiwidHJpbSIsInJlc3BvbnNlIiwicmVtb3ZlIiwibWVzc2FnZSIsImFmdGVyIiwiZXZlbnQiLCJkb2N1bWVudCIsImNyZWF0ZUV2ZW50IiwiaW5pdEV2ZW50Iiwid2luZG93IiwiZGlzcGF0Y2hFdmVudCIsInN1Y2Nlc3MiLCJyZWxvYWQiLCJsb2NhdGlvbiIsImdsb2JhbFJvb3RVcmwiLCJlbXB0eVVybCIsImhyZWYiLCJzcGxpdCIsImFjdGlvbiIsInByZWZpeERhdGEiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBLElBQU1BLElBQUksR0FBRztBQUNaQyxFQUFBQSxRQUFRLEVBQUUsRUFERTtBQUVaQyxFQUFBQSxhQUFhLEVBQUUsRUFGSDtBQUdaQyxFQUFBQSxHQUFHLEVBQUUsRUFITztBQUlaQyxFQUFBQSxnQkFBZ0IsRUFBRSxFQUpOO0FBS1pDLEVBQUFBLGVBQWUsRUFBRSxFQUxMO0FBTVpDLEVBQUFBLGFBQWEsRUFBRUMsQ0FBQyxDQUFDLGVBQUQsQ0FOSjtBQU9aQyxFQUFBQSxlQUFlLEVBQUVELENBQUMsQ0FBQyxpQkFBRCxDQVBOO0FBUVpFLEVBQUFBLGdCQUFnQixFQUFFRixDQUFDLENBQUMsMEJBQUQsQ0FSUDtBQVNaRyxFQUFBQSxXQUFXLEVBQUUsSUFURDtBQVVaQyxFQUFBQSxXQUFXLEVBQUUsa0RBVkQ7QUFXWkMsRUFBQUEsaUJBQWlCLEVBQUUsSUFYUDtBQVlaQyxFQUFBQSxhQUFhLEVBQUUsSUFaSDtBQWFaQyxFQUFBQSxtQkFBbUIsRUFBRSxFQWJUO0FBY1pDLEVBQUFBLG9CQUFvQixFQUFFLEVBZFY7QUFlWkMsRUFBQUEsYUFBYSxFQUFFLEVBZkg7QUFnQlpDLEVBQUFBLFVBaEJZLHdCQWdCQztBQUNaLFFBQUlqQixJQUFJLENBQUNhLGFBQVQsRUFBd0JiLElBQUksQ0FBQ2tCLGlCQUFMO0FBRXhCbEIsSUFBQUEsSUFBSSxDQUFDTSxhQUFMLENBQW1CYSxFQUFuQixDQUFzQixPQUF0QixFQUErQixVQUFDQyxDQUFELEVBQU87QUFDckNBLE1BQUFBLENBQUMsQ0FBQ0MsY0FBRjtBQUNBLFVBQUlyQixJQUFJLENBQUNNLGFBQUwsQ0FBbUJnQixRQUFuQixDQUE0QixTQUE1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QURGLENBQ2EsT0FEYixFQUVFeEIsV0FGRixDQUVjLFNBRmQ7QUFHQTtBQTFFSSxLQUFOO0FBNkVBO0FBOUtXLENBQWIsQyxDQWlMQSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgKEMpIDIwMTctMjAyMCBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgZ2xvYmFsVHJhbnNsYXRlICovXG5cbmNvbnN0IEZvcm0gPSB7XG5cdCRmb3JtT2JqOiAnJyxcblx0dmFsaWRhdGVSdWxlczoge30sXG5cdHVybDogJycsXG5cdGNiQmVmb3JlU2VuZEZvcm06ICcnLFxuXHRjYkFmdGVyU2VuZEZvcm06ICcnLFxuXHQkc3VibWl0QnV0dG9uOiAkKCcjc3VibWl0YnV0dG9uJyksXG5cdCRkcm9wZG93blN1Ym1pdDogJCgnI2Ryb3Bkb3duU3VibWl0JyksXG5cdCRzdWJtaXRNb2RlSW5wdXQ6ICQoJ2lucHV0W25hbWU9XCJzdWJtaXRNb2RlXCJdJyksXG5cdHByb2Nlc3NEYXRhOiB0cnVlLFxuXHRjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCcsXG5cdGtleWJvYXJkU2hvcnRjdXRzOiB0cnVlLFxuXHRlbmFibGVEaXJyaXR5OiB0cnVlLFxuXHRhZnRlclN1Ym1pdEluZGV4VXJsOiAnJyxcblx0YWZ0ZXJTdWJtaXRNb2RpZnlVcmw6ICcnLFxuXHRvbGRGb3JtVmFsdWVzOiBbXSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHRpZiAoRm9ybS5lbmFibGVEaXJyaXR5KSBGb3JtLmluaXRpYWxpemVEaXJyaXR5KCk7XG5cblx0XHRGb3JtLiRzdWJtaXRCdXR0b24ub24oJ2NsaWNrJywgKGUpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGlmIChGb3JtLiRzdWJtaXRCdXR0b24uaGFzQ2xhc3MoJ2xvYWRpbmcnKSkgcmV0dXJuO1xuXHRcdFx0aWYgKEZvcm0uJHN1Ym1pdEJ1dHRvbi5oYXNDbGFzcygnZGlzYWJsZWQnKSkgcmV0dXJuO1xuXHRcdFx0Rm9ybS4kZm9ybU9ialxuXHRcdFx0XHQuZm9ybSh7XG5cdFx0XHRcdFx0b246ICdibHVyJyxcblx0XHRcdFx0XHRmaWVsZHM6IEZvcm0udmFsaWRhdGVSdWxlcyxcblx0XHRcdFx0XHRvblN1Y2Nlc3MoKSB7XG5cdFx0XHRcdFx0XHRGb3JtLnN1Ym1pdEZvcm0oKTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdG9uRmFpbHVyZSgpIHtcblx0XHRcdFx0XHRcdEZvcm0uJGZvcm1PYmoucmVtb3ZlQ2xhc3MoJ2Vycm9yJykuYWRkQ2xhc3MoJ2Vycm9yJyk7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0fSk7XG5cdFx0XHRGb3JtLiRmb3JtT2JqLmZvcm0oJ3ZhbGlkYXRlIGZvcm0nKTtcblx0XHR9KTtcblx0XHRpZiAoRm9ybS4kZHJvcGRvd25TdWJtaXQubGVuZ3RoID4gMCkge1xuXHRcdFx0Rm9ybS4kZHJvcGRvd25TdWJtaXQuZHJvcGRvd24oe1xuXHRcdFx0XHRvbkNoYW5nZTogKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0Y29uc3QgdHJhbnNsYXRlS2V5ID0gYGJ0XyR7dmFsdWV9YDtcblx0XHRcdFx0XHRGb3JtLiRzdWJtaXRNb2RlSW5wdXQudmFsKHZhbHVlKTtcblx0XHRcdFx0XHRGb3JtLiRzdWJtaXRCdXR0b25cblx0XHRcdFx0XHRcdC5odG1sKGA8aSBjbGFzcz1cInNhdmUgaWNvblwiPjwvaT4gJHtnbG9iYWxUcmFuc2xhdGVbdHJhbnNsYXRlS2V5XX1gKVxuXHRcdFx0XHRcdFx0LmNsaWNrKCk7XG5cdFx0XHRcdH0sXG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0Rm9ybS4kZm9ybU9iai5vbignc3VibWl0JywgKGUpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHR9KTtcblx0fSxcblx0LyoqXG5cdCAqINCY0L3QuNGG0LjQsNC70LjQt9Cw0YbQuNGPINC+0YLRgdC70LXQttC40LLQsNC90LjRjyDQuNC30LzQtdC90LXQvdC40Lkg0YTQvtGA0LzRi1xuXHQgKi9cblx0aW5pdGlhbGl6ZURpcnJpdHkoKSB7XG5cdFx0Rm9ybS5zYXZlSW5pdGlhbFZhbHVlcygpO1xuXHRcdEZvcm0uc2V0RXZlbnRzKCk7XG5cdFx0Rm9ybS4kc3VibWl0QnV0dG9uLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdEZvcm0uJGRyb3Bkb3duU3VibWl0LmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHR9LFxuXHQvKipcblx0ICog0KHQvtGF0YDQsNC90Y/QtdGCINC/0LXRgNCy0L7QvdCw0YfQsNC70YzQvdGL0LUg0LfQvdCw0YfQtdC90LjRjyDQtNC70Y8g0L/RgNC+0LLQtdGA0LrQuCDQvdCwINC40LfQvNC10L3QtdC90LjRjyDRhNC+0YDQvNGLXG5cdCAqL1xuXHRzYXZlSW5pdGlhbFZhbHVlcygpIHtcblx0XHRGb3JtLm9sZEZvcm1WYWx1ZXMgPSBGb3JtLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblx0fSxcblx0LyoqXG5cdCAqINCX0LDQv9GD0YHQutCw0LXRgiDQvtCx0YDQsNCx0L7RgtGH0LjQutC4INC40LfQvNC10L3QtdC90LjRjyDQvtCx0YrQtdC60YLQvtCyINGE0L7RgNC80Ytcblx0ICovXG5cdHNldEV2ZW50cygpIHtcblx0XHRGb3JtLiRmb3JtT2JqLmZpbmQoJ2lucHV0LCBzZWxlY3QnKS5jaGFuZ2UoKCkgPT4ge1xuXHRcdFx0Rm9ybS5jaGVja1ZhbHVlcygpO1xuXHRcdH0pO1xuXHRcdEZvcm0uJGZvcm1PYmouZmluZCgnaW5wdXQsIHRleHRhcmVhJykub24oJ2tleXVwIGtleWRvd24gYmx1cicsICgpID0+IHtcblx0XHRcdEZvcm0uY2hlY2tWYWx1ZXMoKTtcblx0XHR9KTtcblx0XHRGb3JtLiRmb3JtT2JqLmZpbmQoJy51aS5jaGVja2JveCcpLm9uKCdjbGljaycsICgpID0+IHtcblx0XHRcdEZvcm0uY2hlY2tWYWx1ZXMoKTtcblx0XHR9KTtcblx0fSxcblx0LyoqXG5cdCAqINCh0LLQtdGA0Y/QtdGCINC40LfQvNC10L3QtdC90LjRjyDRgdGC0LDRgNGL0YUg0Lgg0L3QvtCy0YvRhSDQt9C90LDRh9C10L3QuNC5INGE0L7RgNC80Ytcblx0ICovXG5cdGNoZWNrVmFsdWVzKCkge1xuXHRcdGNvbnN0IG5ld0Zvcm1WYWx1ZXMgPSBGb3JtLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblx0XHRpZiAoSlNPTi5zdHJpbmdpZnkoRm9ybS5vbGRGb3JtVmFsdWVzKSA9PT0gSlNPTi5zdHJpbmdpZnkobmV3Rm9ybVZhbHVlcykpIHtcblx0XHRcdEZvcm0uJHN1Ym1pdEJ1dHRvbi5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdEZvcm0uJGRyb3Bkb3duU3VibWl0LmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRGb3JtLiRzdWJtaXRCdXR0b24ucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRGb3JtLiRkcm9wZG93blN1Ym1pdC5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHR9XG5cdH0sXG5cdC8qKlxuXHQgKiDQntGC0L/RgNCw0LLQutCwINGE0L7RgNC80Ysg0L3QsCDRgdC10YDQstC10YBcblx0ICovXG5cdHN1Ym1pdEZvcm0oKSB7XG5cdFx0JC5hcGkoe1xuXHRcdFx0dXJsOiBGb3JtLnVybCxcblx0XHRcdG9uOiAnbm93Jyxcblx0XHRcdG1ldGhvZDogJ1BPU1QnLFxuXHRcdFx0cHJvY2Vzc0RhdGE6IEZvcm0ucHJvY2Vzc0RhdGEsXG5cdFx0XHRjb250ZW50VHlwZTogRm9ybS5jb250ZW50VHlwZSxcblx0XHRcdGtleWJvYXJkU2hvcnRjdXRzOiBGb3JtLmtleWJvYXJkU2hvcnRjdXRzLFxuXHRcdFx0YmVmb3JlU2VuZChzZXR0aW5ncykge1xuXHRcdFx0XHRGb3JtLiRzdWJtaXRCdXR0b24uYWRkQ2xhc3MoJ2xvYWRpbmcnKTtcblx0XHRcdFx0Y29uc3QgY2JCZWZvcmVTZW5kUmVzdWx0ID0gRm9ybS5jYkJlZm9yZVNlbmRGb3JtKHNldHRpbmdzKTtcblx0XHRcdFx0aWYgKGNiQmVmb3JlU2VuZFJlc3VsdCA9PT0gZmFsc2UpIHtcblx0XHRcdFx0XHRGb3JtLiRzdWJtaXRCdXR0b25cblx0XHRcdFx0XHRcdC50cmFuc2l0aW9uKCdzaGFrZScpXG5cdFx0XHRcdFx0XHQucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkLmVhY2goY2JCZWZvcmVTZW5kUmVzdWx0LmRhdGEsIChpbmRleCwgdmFsdWUpID0+IHtcblx0XHRcdFx0XHRcdGlmIChpbmRleC5pbmRleE9mKCdlY3JldCcpID4gLTEgfHwgaW5kZXguaW5kZXhPZignYXNzd29yZCcpID4gLTEpIHJldHVybjtcblx0XHRcdFx0XHRcdGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSBjYkJlZm9yZVNlbmRSZXN1bHQuZGF0YVtpbmRleF0gPSB2YWx1ZS50cmltKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIGNiQmVmb3JlU2VuZFJlc3VsdDtcblx0XHRcdH0sXG5cdFx0XHRvblN1Y2Nlc3MocmVzcG9uc2UpIHtcblx0XHRcdFx0JCgnLnVpLm1lc3NhZ2UuYWpheCcpLnJlbW92ZSgpO1xuXHRcdFx0XHQkLmVhY2gocmVzcG9uc2UubWVzc2FnZSwgKGluZGV4LCB2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdGlmIChpbmRleCA9PT0gJ2Vycm9yJykge1xuXHRcdFx0XHRcdFx0Rm9ybS4kc3VibWl0QnV0dG9uLnRyYW5zaXRpb24oJ3NoYWtlJykucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcblx0XHRcdFx0XHRcdEZvcm0uJGZvcm1PYmouYWZ0ZXIoYDxkaXYgY2xhc3M9XCJ1aSAke2luZGV4fSBtZXNzYWdlIGFqYXhcIj4ke3ZhbHVlfTwvZGl2PmApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHRcdGNvbnN0IGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50Jyk7XG5cdFx0XHRcdGV2ZW50LmluaXRFdmVudCgnQ29uZmlnRGF0YUNoYW5nZWQnLCBmYWxzZSwgdHJ1ZSk7XG5cdFx0XHRcdHdpbmRvdy5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcblx0XHRcdFx0Rm9ybS5jYkFmdGVyU2VuZEZvcm0ocmVzcG9uc2UpO1xuXHRcdFx0XHRpZiAocmVzcG9uc2Uuc3VjY2Vzc1xuXHRcdFx0XHRcdCYmIHJlc3BvbnNlLnJlbG9hZC5sZW5ndGggPiAwXG5cdFx0XHRcdFx0JiYgRm9ybS4kc3VibWl0TW9kZUlucHV0LnZhbCgpID09PSAnU2F2ZVNldHRpbmdzJykge1xuXHRcdFx0XHRcdHdpbmRvdy5sb2NhdGlvbiA9IGdsb2JhbFJvb3RVcmwgKyByZXNwb25zZS5yZWxvYWQ7XG5cdFx0XHRcdH0gZWxzZSBpZiAocmVzcG9uc2Uuc3VjY2VzcyAmJiBGb3JtLiRzdWJtaXRNb2RlSW5wdXQudmFsKCkgPT09ICdTYXZlU2V0dGluZ3NBbmRBZGROZXcnKSB7XG5cdFx0XHRcdFx0aWYgKEZvcm0uYWZ0ZXJTdWJtaXRNb2RpZnlVcmwubGVuZ3RoID4gMSl7XG5cdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24gPSBGb3JtLmFmdGVyU3VibWl0TW9kaWZ5VXJsO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRjb25zdCBlbXB0eVVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCdtb2RpZnknKTtcblx0XHRcdFx0XHRcdGxldCBhY3Rpb24gPSAnbW9kaWZ5Jztcblx0XHRcdFx0XHRcdGxldCBwcmVmaXhEYXRhID0gZW1wdHlVcmxbMV0uc3BsaXQoJy8nKTtcblx0XHRcdFx0XHRcdGlmKHByZWZpeERhdGEubGVuZ3RoID4gMCl7XG5cdFx0XHRcdFx0XHRcdGFjdGlvbiA9IGFjdGlvbiArIHByZWZpeERhdGFbMF07XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRpZiAoZW1wdHlVcmwubGVuZ3RoID4gMSkge1xuXHRcdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24gPSBgJHtlbXB0eVVybFswXX0ke2FjdGlvbn0vYDtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSBpZiAocmVzcG9uc2Uuc3VjY2VzcyAmJiBGb3JtLiRzdWJtaXRNb2RlSW5wdXQudmFsKCkgPT09ICdTYXZlU2V0dGluZ3NBbmRFeGl0Jykge1xuXHRcdFx0XHRcdGlmIChGb3JtLmFmdGVyU3VibWl0SW5kZXhVcmwubGVuZ3RoID4gMSl7XG5cdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24gPSBGb3JtLmFmdGVyU3VibWl0SW5kZXhVcmw7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGNvbnN0IGVtcHR5VXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJ21vZGlmeScpO1xuXHRcdFx0XHRcdFx0aWYgKGVtcHR5VXJsLmxlbmd0aCA+IDEpIHtcblx0XHRcdFx0XHRcdFx0d2luZG93LmxvY2F0aW9uID0gYCR7ZW1wdHlVcmxbMF19aW5kZXgvYDtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gZWxzZSBpZiAocmVzcG9uc2Uuc3VjY2Vzc1xuXHRcdFx0XHRcdFx0JiYgcmVzcG9uc2UucmVsb2FkLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24gPSBnbG9iYWxSb290VXJsICsgcmVzcG9uc2UucmVsb2FkO1xuXHRcdFx0XHR9IGVsc2UgaWYgKEZvcm0uZW5hYmxlRGlycml0eSkge1xuXHRcdFx0XHRcdEZvcm0uaW5pdGlhbGl6ZURpcnJpdHkoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRGb3JtLiRzdWJtaXRCdXR0b24ucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcblx0XHRcdH0sXG5cdFx0XHRvbkZhaWx1cmUocmVzcG9uc2UpIHtcblx0XHRcdFx0Rm9ybS4kZm9ybU9iai5hZnRlcihyZXNwb25zZSk7XG5cdFx0XHRcdEZvcm0uJHN1Ym1pdEJ1dHRvblxuXHRcdFx0XHRcdC50cmFuc2l0aW9uKCdzaGFrZScpXG5cdFx0XHRcdFx0LnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG5cdFx0XHR9LFxuXG5cdFx0fSk7XG5cdH0sXG59O1xuXG4vLyBleHBvcnQgZGVmYXVsdCBGb3JtO1xuIl19