"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global Sentry, globalPBXVersion, globalPBXLicense,
globalLastSentryEventId, globalTranslate, localStorage */

/**
 * Shows the Sentry report dialog for error reporting.
 * @param {string} hash - Hash value for identifying the error.
 * @param {string} sentryEventId - Sentry event ID for the error.
 */
function globalShowSentryReportDialog(hash, sentryEventId) {
  var itIsKnownError = localStorage.getItem("sentry_lastError".concat(hash));

  if (itIsKnownError === null) {
    if (typeof {
      globalTranslate: globalTranslate
    } !== "undefined" && Object.keys(globalTranslate).length > 0) {
      Sentry.showReportDialog({
        eventId: sentryEventId,
        title: globalTranslate.sntry_Title,
        subtitle: globalTranslate.sntry_Subtitle,
        subtitle2: globalTranslate.sntry_Subtitle2,
        labelComments: globalTranslate.sntry_LabelComments,
        labelClose: globalTranslate.sntry_LabelClose,
        labelSubmit: globalTranslate.sntry_LabelSubmit,
        errorGeneric: globalTranslate.sntry_ErrorGeneric,
        errorFormEntry: globalTranslate.sntry_ErrorFormEntry,
        successMessage: globalTranslate.sntry_SuccessMessage
      });
    } else {
      Sentry.showReportDialog({
        eventId: sentryEventId
      });
    }

    localStorage.setItem("sentry_lastError".concat(hash), 'theFormHasAlreadySent');
  }
}

Sentry.onLoad(function () {
  Sentry.init({
    dsn: 'https://07be0eff8a5c463fbac3e90ae5c7d039@sentry.miko.ru/1',
    release: "mikopbx@".concat(globalPBXVersion),
    beforeSend: function beforeSend(event, hint) {
      // Check if it is an exception, and if so, show the report dialog
      if (event.exception) {
        var error = hint.originalException;

        if (error && error.message && error.message.length > 0) {
          var s = error.message;
          var hash = 0;
          var i;
          var chr;

          for (i = 0; i < s.length; i++) {
            chr = s.charCodeAt(i);
            hash = (hash << 5) - hash + chr;
            hash |= 0; // Convert to 32bit integer
          }

          globalShowSentryReportDialog(hash, hint.eventId);
        }
      }

      return event;
    }
  });
  Sentry.configureScope(function (scope) {
    scope.setUser({
      id: globalPBXLicense
    });
    scope.setTag('library', 'web-interface');
  });

  if (globalLastSentryEventId) {
    globalShowSentryReportDialog(globalLastSentryEventId);
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYWluL3NlbnRyeS1lcnJvci1sb2dnZXIuanMiXSwibmFtZXMiOlsiZ2xvYmFsU2hvd1NlbnRyeVJlcG9ydERpYWxvZyIsImhhc2giLCJzZW50cnlFdmVudElkIiwiaXRJc0tub3duRXJyb3IiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiZ2xvYmFsVHJhbnNsYXRlIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsIlNlbnRyeSIsInNob3dSZXBvcnREaWFsb2ciLCJldmVudElkIiwidGl0bGUiLCJzbnRyeV9UaXRsZSIsInN1YnRpdGxlIiwic250cnlfU3VidGl0bGUiLCJzdWJ0aXRsZTIiLCJzbnRyeV9TdWJ0aXRsZTIiLCJsYWJlbENvbW1lbnRzIiwic250cnlfTGFiZWxDb21tZW50cyIsImxhYmVsQ2xvc2UiLCJzbnRyeV9MYWJlbENsb3NlIiwibGFiZWxTdWJtaXQiLCJzbnRyeV9MYWJlbFN1Ym1pdCIsImVycm9yR2VuZXJpYyIsInNudHJ5X0Vycm9yR2VuZXJpYyIsImVycm9yRm9ybUVudHJ5Iiwic250cnlfRXJyb3JGb3JtRW50cnkiLCJzdWNjZXNzTWVzc2FnZSIsInNudHJ5X1N1Y2Nlc3NNZXNzYWdlIiwic2V0SXRlbSIsIm9uTG9hZCIsImluaXQiLCJkc24iLCJyZWxlYXNlIiwiZ2xvYmFsUEJYVmVyc2lvbiIsImJlZm9yZVNlbmQiLCJldmVudCIsImhpbnQiLCJleGNlcHRpb24iLCJlcnJvciIsIm9yaWdpbmFsRXhjZXB0aW9uIiwibWVzc2FnZSIsInMiLCJpIiwiY2hyIiwiY2hhckNvZGVBdCIsImNvbmZpZ3VyZVNjb3BlIiwic2NvcGUiLCJzZXRVc2VyIiwiaWQiLCJnbG9iYWxQQlhMaWNlbnNlIiwic2V0VGFnIiwiZ2xvYmFsTGFzdFNlbnRyeUV2ZW50SWQiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUssQ0FBQ0MsT0FBTixDQUFjO0FBQUNDLE1BQUFBLEVBQUUsRUFBRUM7QUFBTCxLQUFkO0FBQ0FILElBQUFBLEtBQUssQ0FBQ0ksTUFBTixDQUFhLFNBQWIsRUFBd0IsZUFBeEI7QUFDSCxHQUhEOztBQUtBLE1BQUlDLHVCQUFKLEVBQTZCO0FBQ3pCdEQsSUFBQUEsNEJBQTRCLENBQUNzRCx1QkFBRCxDQUE1QjtBQUNIO0FBQ0osQ0FsQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IMKpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG5cbi8qIGdsb2JhbCBTZW50cnksIGdsb2JhbFBCWFZlcnNpb24sIGdsb2JhbFBCWExpY2Vuc2UsXG5nbG9iYWxMYXN0U2VudHJ5RXZlbnRJZCwgZ2xvYmFsVHJhbnNsYXRlLCBsb2NhbFN0b3JhZ2UgKi9cblxuLyoqXG4gKiBTaG93cyB0aGUgU2VudHJ5IHJlcG9ydCBkaWFsb2cgZm9yIGVycm9yIHJlcG9ydGluZy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBoYXNoIC0gSGFzaCB2YWx1ZSBmb3IgaWRlbnRpZnlpbmcgdGhlIGVycm9yLlxuICogQHBhcmFtIHtzdHJpbmd9IHNlbnRyeUV2ZW50SWQgLSBTZW50cnkgZXZlbnQgSUQgZm9yIHRoZSBlcnJvci5cbiAqL1xuZnVuY3Rpb24gZ2xvYmFsU2hvd1NlbnRyeVJlcG9ydERpYWxvZyhoYXNoLCBzZW50cnlFdmVudElkKSB7XG4gICAgY29uc3QgaXRJc0tub3duRXJyb3IgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgc2VudHJ5X2xhc3RFcnJvciR7aGFzaH1gKTtcbiAgICBpZiAoaXRJc0tub3duRXJyb3IgPT09IG51bGwpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB7Z2xvYmFsVHJhbnNsYXRlfSAhPT0gXCJ1bmRlZmluZWRcIlxuICAgICAgICAgICAgJiYgT2JqZWN0LmtleXMoZ2xvYmFsVHJhbnNsYXRlKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBTZW50cnkuc2hvd1JlcG9ydERpYWxvZyh7XG4gICAgICAgICAgICAgICAgZXZlbnRJZDogc2VudHJ5RXZlbnRJZCxcbiAgICAgICAgICAgICAgICB0aXRsZTogZ2xvYmFsVHJhbnNsYXRlLnNudHJ5X1RpdGxlLFxuICAgICAgICAgICAgICAgIHN1YnRpdGxlOiBnbG9iYWxUcmFuc2xhdGUuc250cnlfU3VidGl0bGUsXG4gICAgICAgICAgICAgICAgc3VidGl0bGUyOiBnbG9iYWxUcmFuc2xhdGUuc250cnlfU3VidGl0bGUyLFxuICAgICAgICAgICAgICAgIGxhYmVsQ29tbWVudHM6IGdsb2JhbFRyYW5zbGF0ZS5zbnRyeV9MYWJlbENvbW1lbnRzLFxuICAgICAgICAgICAgICAgIGxhYmVsQ2xvc2U6IGdsb2JhbFRyYW5zbGF0ZS5zbnRyeV9MYWJlbENsb3NlLFxuICAgICAgICAgICAgICAgIGxhYmVsU3VibWl0OiBnbG9iYWxUcmFuc2xhdGUuc250cnlfTGFiZWxTdWJtaXQsXG4gICAgICAgICAgICAgICAgZXJyb3JHZW5lcmljOiBnbG9iYWxUcmFuc2xhdGUuc250cnlfRXJyb3JHZW5lcmljLFxuICAgICAgICAgICAgICAgIGVycm9yRm9ybUVudHJ5OiBnbG9iYWxUcmFuc2xhdGUuc250cnlfRXJyb3JGb3JtRW50cnksXG4gICAgICAgICAgICAgICAgc3VjY2Vzc01lc3NhZ2U6IGdsb2JhbFRyYW5zbGF0ZS5zbnRyeV9TdWNjZXNzTWVzc2FnZSxcblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBTZW50cnkuc2hvd1JlcG9ydERpYWxvZyh7ZXZlbnRJZDogc2VudHJ5RXZlbnRJZH0pO1xuICAgICAgICB9XG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGBzZW50cnlfbGFzdEVycm9yJHtoYXNofWAsICd0aGVGb3JtSGFzQWxyZWFkeVNlbnQnKTtcbiAgICB9XG59XG5cblNlbnRyeS5vbkxvYWQoKCkgPT4ge1xuICAgIFNlbnRyeS5pbml0KHtcbiAgICAgICAgZHNuOiAnaHR0cHM6Ly8wN2JlMGVmZjhhNWM0NjNmYmFjM2U5MGFlNWM3ZDAzOUBzZW50cnkubWlrby5ydS8xJyxcbiAgICAgICAgcmVsZWFzZTogYG1pa29wYnhAJHtnbG9iYWxQQlhWZXJzaW9ufWAsXG4gICAgICAgIGJlZm9yZVNlbmQoZXZlbnQsIGhpbnQpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGl0IGlzIGFuIGV4Y2VwdGlvbiwgYW5kIGlmIHNvLCBzaG93IHRoZSByZXBvcnQgZGlhbG9nXG4gICAgICAgICAgICBpZiAoZXZlbnQuZXhjZXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBoaW50Lm9yaWdpbmFsRXhjZXB0aW9uO1xuICAgICAgICAgICAgICAgIGlmIChlcnJvciAmJiBlcnJvci5tZXNzYWdlICYmIGVycm9yLm1lc3NhZ2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gZXJyb3IubWVzc2FnZTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGhhc2ggPSAwO1xuICAgICAgICAgICAgICAgICAgICBsZXQgaTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNocjtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNociA9IHMuY2hhckNvZGVBdChpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc2ggPSAoKGhhc2ggPDwgNSkgLSBoYXNoKSArIGNocjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc2ggfD0gMDsgLy8gQ29udmVydCB0byAzMmJpdCBpbnRlZ2VyXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsU2hvd1NlbnRyeVJlcG9ydERpYWxvZyhoYXNoLCBoaW50LmV2ZW50SWQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGV2ZW50O1xuICAgICAgICB9LFxuICAgIH0pO1xuXG4gICAgU2VudHJ5LmNvbmZpZ3VyZVNjb3BlKChzY29wZSkgPT4ge1xuICAgICAgICBzY29wZS5zZXRVc2VyKHtpZDogZ2xvYmFsUEJYTGljZW5zZX0pO1xuICAgICAgICBzY29wZS5zZXRUYWcoJ2xpYnJhcnknLCAnd2ViLWludGVyZmFjZScpO1xuICAgIH0pO1xuXG4gICAgaWYgKGdsb2JhbExhc3RTZW50cnlFdmVudElkKSB7XG4gICAgICAgIGdsb2JhbFNob3dTZW50cnlSZXBvcnREaWFsb2coZ2xvYmFsTGFzdFNlbnRyeUV2ZW50SWQpO1xuICAgIH1cbn0pO1xuXG4iXX0=