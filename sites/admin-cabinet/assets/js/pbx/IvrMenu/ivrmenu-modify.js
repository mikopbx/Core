"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, ivrActions, globalTranslate, Form, Extensions, SoundFilesSelector */
var ivrMenu = {
  /**
   * jQuery object for the form.
   * @type {jQuery}
   */
  $formObj: $('#ivr-menu-form'),
  $dropDowns: $('#ivr-menu-form .ui.dropdown'),
  $number: $('#extension'),
  $errorMessages: $('#form-error-messages'),
  $rowTemplate: $('#row-template'),
  defaultExtension: '',
  actionsRowsCount: 0,

  /**
   * Validation rules for the form fields before submission.
   *
   * @type {object}
   */
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateNameIsEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateExtensionIsEmpty
      }, {
        type: 'existRule',
        prompt: globalTranslate.iv_ValidateExtensionIsDouble
      }]
    },
    timeout_extension: {
      identifier: 'timeout_extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateTimeoutExtensionIsEmpty
      }]
    },
    audio_message_id: {
      identifier: 'audio_message_id',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateAudioFileIsEmpty
      }]
    },
    timeout: {
      identifier: 'timeout',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateTimeoutOutOfRange
      }]
    },
    number_of_repeat: {
      identifier: 'number_of_repeat',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateRepeatNumberOutOfRange
      }]
    }
  },
  initialize: function initialize() {
    // Initialize dropdowns
    ivrMenu.$dropDowns.dropdown(); // Dynamic check to see if the selected number is available

    ivrMenu.$number.on('change', function () {
      var newNumber = ivrMenu.$formObj.form('get value', 'extension');
      Extensions.checkAvailability(ivrMenu.defaultNumber, newNumber);
    }); // Add event listener for adding a new IVR action row

    $('#add-new-ivr-action').on('click', function (el) {
      ivrMenu.addNewActionRow();
      ivrMenu.rebuildActionExtensionsDropdown(); // Trigger change event to acknowledge the modification

      Form.dataChanged();
      el.preventDefault();
    }); // Initialize audio message dropdowns

    $('#ivr-menu-form .audio-message-select').dropdown(SoundFilesSelector.getDropdownSettingsWithEmpty()); // Initialize the form

    ivrMenu.initializeForm(); // Build IVR menu actions

    ivrMenu.buildIvrMenuActions(); // Get the default extension value

    ivrMenu.defaultExtension = ivrMenu.$formObj.form('get value', 'extension');
  },

  /**
   * Create ivr menu items on the form
   */
  buildIvrMenuActions: function buildIvrMenuActions() {
    var objActions = JSON.parse(ivrActions);
    objActions.forEach(function (element) {
      ivrMenu.addNewActionRow(element);
    });
    if (objActions.length === 0) ivrMenu.addNewActionRow();
    ivrMenu.rebuildActionExtensionsDropdown();
  },

  /**
   * Adds new form validation rules for a newly added action row.
   * @param {string} newRowId - The ID of the newly added action row.
   */
  addNewFormRules: function addNewFormRules(newRowId) {
    // Create the identifier for the digits field of the new row
    var $digitsClass = "digits-".concat(newRowId); // Define the validation rules for the digits field

    ivrMenu.validateRules[$digitsClass] = {
      identifier: $digitsClass,
      rules: [{
        type: 'regExp[/^[0-9]{1,7}$/]',
        prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
      }, {
        type: 'checkDoublesDigits',
        prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
      }]
    }; // Create the identifier for the extension field of the new row

    var $extensionClass = "extension-".concat(newRowId); // Define the validation rules for the extension field

    ivrMenu.validateRules[$extensionClass] = {
      identifier: $extensionClass,
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateExtensionIsNotCorrect
      }]
    };
  },

  /**
   * Adds a new action row to the IVR menu form.
   * @param {Object} paramObj - Optional parameter object with initial values for the action row.
   *                            If not provided, default values will be used.
   */
  addNewActionRow: function addNewActionRow(paramObj) {
    // Default parameter values
    var param = {
      id: '',
      extension: '',
      extensionRepresent: '',
      digits: ''
    }; // Override default values with the provided parameter object

    if (paramObj !== undefined) {
      param = paramObj;
    } // Increment the actionsRowsCount


    ivrMenu.actionsRowsCount += 1; // Clone the row template and modify its attributes and content

    var $actionTemplate = ivrMenu.$rowTemplate.clone();
    $actionTemplate.removeClass('hidden').attr('id', "row-".concat(ivrMenu.actionsRowsCount)).attr('data-value', ivrMenu.actionsRowsCount).attr('style', ''); // Set the attributes and values for digits input field

    $actionTemplate.find('input[name="digits-id"]').attr('id', "digits-".concat(ivrMenu.actionsRowsCount)).attr('name', "digits-".concat(ivrMenu.actionsRowsCount)).attr('value', param.digits); // Set the attributes and values for extension input field

    $actionTemplate.find('input[name="extension-id"]').attr('id', "extension-".concat(ivrMenu.actionsRowsCount)).attr('name', "extension-".concat(ivrMenu.actionsRowsCount)).attr('value', param.extension); // Set the data-value attribute for the delete-action-row element

    $actionTemplate.find('div.delete-action-row').attr('data-value', ivrMenu.actionsRowsCount); // Update the extensionRepresent content based on the provided value or default text

    if (param.extensionRepresent.length > 0) {
      $actionTemplate.find('div.default.text').removeClass('default').html(param.extensionRepresent);
    } else {
      $actionTemplate.find('div.default.text').html(globalTranslate.ex_SelectNumber);
    } // Append the action template to the actions-place element


    $('#actions-place').append($actionTemplate); // Add new form rules for the newly added action row

    ivrMenu.addNewFormRules(ivrMenu.actionsRowsCount);
  },

  /**
   * Rebuilds the action extensions dropdown by initializing the dropdown settings for routing
   * and attaching the cbOnExtensionSelect callback function to handle the extension selection event.
   */
  rebuildActionExtensionsDropdown: function rebuildActionExtensionsDropdown() {
    // Initialize the dropdown settings for routing with cbOnExtensionSelect callback function
    $('#ivr-menu-form .forwarding-select').dropdown(Extensions.getDropdownSettingsForRouting(ivrMenu.cbOnExtensionSelect)); // Attach a click event handler to the delete-action-row elements

    $('.delete-action-row').on('click', function (e) {
      e.preventDefault(); // Get the 'data-value' attribute of the clicked element

      var id = $(this).attr('data-value'); // Remove the corresponding rules from validateRules object

      delete ivrMenu.validateRules["digits-".concat(id)];
      delete ivrMenu.validateRules["extension-".concat(id)]; // Remove the row with the corresponding id

      $("#row-".concat(id)).remove(); // Trigger change event to acknowledge the modification

      Form.dataChanged();
    });
  },

  /**
   * Callback function to be called before the form is sent
   * @param {Object} settings - The current settings of the form
   * @returns {Object} - The updated settings of the form
   */
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    // Copy the settings object to a new variable to avoid modifying the original
    var result = settings; // Get the form values from $formObj of ivrMenu

    result.data = ivrMenu.$formObj.form('get values'); // Initialize an array to store actions

    var arrActions = []; // Iterate over each action row

    $('.action-row').each(function (index, obj) {
      var rowId = $(obj).attr('data-value'); // If rowId is greater than 0, get the 'digits' and 'extension' values from the form and push them into the arrActions array

      if (rowId > 0) {
        arrActions.push({
          digits: ivrMenu.$formObj.form('get value', "digits-".concat(rowId)),
          extension: ivrMenu.$formObj.form('get value', "extension-".concat(rowId))
        });
      }
    }); // If there are no action rows, set the result to false, display an error message and add error class to the form

    if (arrActions.length === 0) {
      result = false;
      ivrMenu.$errorMessages.html(globalTranslate.iv_ValidateNoIVRExtensions);
      ivrMenu.$formObj.addClass('error');
    } else {
      // Convert the arrActions array into a JSON string and assign it to 'actions' key in the result data object
      result.data.actions = JSON.stringify(arrActions);
    } // Return the modified settings object or false


    return result;
  },

  /**
   * Callback function that triggers when a number is selected from the dropdown menu.
   * It generates a random number and triggers a change event.
   */
  cbOnExtensionSelect: function cbOnExtensionSelect() {
    // Trigger change event to acknowledge the modification
    Form.dataChanged();
  },

  /**
   * Callback function to be called after the form has been sent.
   * @param {Object} response - The response from the server after the form is sent
   */
  cbAfterSendForm: function cbAfterSendForm(response) {},

  /**
   * Initialize the form with custom settings
   */
  initializeForm: function initializeForm() {
    Form.$formObj = ivrMenu.$formObj;
    Form.url = "".concat(globalRootUrl, "ivr-menu/save"); // Form submission URL

    Form.validateRules = ivrMenu.validateRules; // Form validation rules

    Form.cbBeforeSendForm = ivrMenu.cbBeforeSendForm; // Callback before form is sent

    Form.cbAfterSendForm = ivrMenu.cbAfterSendForm; // Callback after form is sent

    Form.initialize();
  }
};
/**
 * Custom form rule to check if an element with id 'extension-error' has the class 'hidden'.
 */

$.fn.form.settings.rules.existRule = function () {
  return $('#extension-error').hasClass('hidden');
};
/**
 * Custom form rule to check for duplicate digits values.
 * @param {string} value - The value to check for duplicates.
 * @returns {boolean} - True if there are no duplicates, false otherwise.
 */


$.fn.form.settings.rules.checkDoublesDigits = function (value) {
  var count = 0;
  $("input[id^='digits']").each(function (index, obj) {
    if (ivrMenu.$formObj.form('get value', "".concat(obj.id)) === value) count += 1;
  });
  return count === 1;
};
/**
 *  Initialize IVR menu modify form on document ready
 */


$(document).ready(function () {
  ivrMenu.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9JdnJNZW51L2l2cm1lbnUtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbIml2ck1lbnUiLCIkZm9ybU9iaiIsIiQiLCIkZHJvcERvd25zIiwiJG51bWJlciIsIiRlcnJvck1lc3NhZ2VzIiwiJHJvd1RlbXBsYXRlIiwiZGVmYXVsdEV4dGVuc2lvbiIsImFjdGlvbnNSb3dzQ291bnQiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJpdl9WYWxpZGF0ZU5hbWVJc0VtcHR5IiwiZXh0ZW5zaW9uIiwiaXZfVmFsaWRhdGVFeHRlbnNpb25Jc0VtcHR5IiwiaXZfVmFsaWRhdGVFeHRlbnNpb25Jc0RvdWJsZSIsInRpbWVvdXRfZXh0ZW5zaW9uIiwiaXZfVmFsaWRhdGVUaW1lb3V0RXh0ZW5zaW9uSXNFbXB0eSIsImF1ZGlvX21lc3NhZ2VfaWQiLCJpdl9WYWxpZGF0ZUF1ZGlvRmlsZUlzRW1wdHkiLCJ0aW1lb3V0IiwiaXZfVmFsaWRhdGVUaW1lb3V0T3V0T2ZSYW5nZSIsIm51bWJlcl9vZl9yZXBlYXQiLCJpdl9WYWxpZGF0ZVJlcGVhdE51bWJlck91dE9mUmFuZ2UiLCJpbml0aWFsaXplIiwiZHJvcGRvd24iLCJvbiIsIm5ld051bWJlciIsImZvcm0iLCJFeHRlbnNpb25zIiwiY2hlY2tBdmFpbGFiaWxpdHkiLCJkZWZhdWx0TnVtYmVyIiwiZWwiLCJhZGROZXdBY3Rpb25Sb3ciLCJyZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duIiwiRm9ybSIsImRhdGFDaGFuZ2VkIiwicHJldmVudERlZmF1bHQiLCJTb3VuZEZpbGVzU2VsZWN0b3IiLCJnZXREcm9wZG93blNldHRpbmdzV2l0aEVtcHR5IiwiaW5pdGlhbGl6ZUZvcm0iLCJidWlsZEl2ck1lbnVBY3Rpb25zIiwib2JqQWN0aW9ucyIsIkpTT04iLCJwYXJzZSIsIml2ckFjdGlvbnMiLCJmb3JFYWNoIiwiZWxlbWVudCIsImxlbmd0aCIsImFkZE5ld0Zvcm1SdWxlcyIsIm5ld1Jvd0lkIiwiJGRpZ2l0c0NsYXNzIiwiaXZfVmFsaWRhdGVEaWdpdHNJc05vdENvcnJlY3QiLCIkZXh0ZW5zaW9uQ2xhc3MiLCJpdl9WYWxpZGF0ZUV4dGVuc2lvbklzTm90Q29ycmVjdCIsInBhcmFtT2JqIiwicGFyYW0iLCJpZCIsImV4dGVuc2lvblJlcHJlc2VudCIsImRpZ2l0cyIsInVuZGVmaW5lZCIsIiRhY3Rpb25UZW1wbGF0ZSIsImNsb25lIiwicmVtb3ZlQ2xhc3MiLCJhdHRyIiwiZmluZCIsImh0bWwiLCJleF9TZWxlY3ROdW1iZXIiLCJhcHBlbmQiLCJnZXREcm9wZG93blNldHRpbmdzRm9yUm91dGluZyIsImNiT25FeHRlbnNpb25TZWxlY3QiLCJlIiwicmVtb3ZlIiwiY2JCZWZvcmVTZW5kRm9ybSIsInNldHRpbmdzIiwicmVzdWx0IiwiZGF0YSIsImFyckFjdGlvbnMiLCJlYWNoIiwiaW5kZXgiLCJvYmoiLCJyb3dJZCIsInB1c2giLCJpdl9WYWxpZGF0ZU5vSVZSRXh0ZW5zaW9ucyIsImFkZENsYXNzIiwiYWN0aW9ucyIsInN0cmluZ2lmeSIsImNiQWZ0ZXJTZW5kRm9ybSIsInJlc3BvbnNlIiwidXJsIiwiZ2xvYmFsUm9vdFVybCIsImZuIiwiZXhpc3RSdWxlIiwiaGFzQ2xhc3MiLCJjaGVja0RvdWJsZXNEaWdpdHMiLCJ2YWx1ZSIsImNvdW50IiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBR0EsSUFBTUEsT0FBTyxHQUFHO0FBQ1o7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsUUFBUSxFQUFFQyxDQUFDLENBQUMsZ0JBQUQsQ0FMQztBQU9aQyxFQUFBQSxVQUFVLEVBQUVELENBQUMsQ0FBQyw2QkFBRCxDQVBEO0FB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QUFDLENBQUMscUJBQUQsQ0FBRCxDQUF5QmdGLElBQXpCLENBQThCLFVBQUNDLEtBQUQsRUFBUUMsR0FBUixFQUFnQjtBQUMxQyxRQUFJcEYsT0FBTyxDQUFDQyxRQUFSLENBQWlCK0IsSUFBakIsQ0FBc0IsV0FBdEIsWUFBc0NvRCxHQUFHLENBQUN2QixFQUExQyxPQUFvRHNDLEtBQXhELEVBQStEQyxLQUFLLElBQUksQ0FBVDtBQUNsRSxHQUZEO0FBSUEsU0FBUUEsS0FBSyxLQUFLLENBQWxCO0FBQ0gsQ0FQRDtBQVNBO0FBQ0E7QUFDQTs7O0FBQ0FsRyxDQUFDLENBQUNtRyxRQUFELENBQUQsQ0FBWUMsS0FBWixDQUFrQixZQUFNO0FBQ3BCdEcsRUFBQUEsT0FBTyxDQUFDNEIsVUFBUjtBQUNILENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IMKpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgaXZyQWN0aW9ucywgZ2xvYmFsVHJhbnNsYXRlLCBGb3JtLCBFeHRlbnNpb25zLCBTb3VuZEZpbGVzU2VsZWN0b3IgKi9cblxuXG5jb25zdCBpdnJNZW51ID0ge1xuICAgIC8qKlxuICAgICAqIGpRdWVyeSBvYmplY3QgZm9yIHRoZSBmb3JtLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGZvcm1PYmo6ICQoJyNpdnItbWVudS1mb3JtJyksXG5cbiAgICAkZHJvcERvd25zOiAkKCcjaXZyLW1lbnUtZm9ybSAudWkuZHJvcGRvd24nKSxcbiAgICAkbnVtYmVyOiAkKCcjZXh0ZW5zaW9uJyksXG5cbiAgICAkZXJyb3JNZXNzYWdlczogJCgnI2Zvcm0tZXJyb3ItbWVzc2FnZXMnKSxcbiAgICAkcm93VGVtcGxhdGU6ICQoJyNyb3ctdGVtcGxhdGUnKSxcbiAgICBkZWZhdWx0RXh0ZW5zaW9uOiAnJyxcbiAgICBhY3Rpb25zUm93c0NvdW50OiAwLFxuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGlvbiBydWxlcyBmb3IgdGhlIGZvcm0gZmllbGRzIGJlZm9yZSBzdWJtaXNzaW9uLlxuICAgICAqXG4gICAgICogQHR5cGUge29iamVjdH1cbiAgICAgKi9cbiAgICB2YWxpZGF0ZVJ1bGVzOiB7XG4gICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICduYW1lJyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZW1wdHknLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZU5hbWVJc0VtcHR5LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBleHRlbnNpb246IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICdleHRlbnNpb24nLFxuICAgICAgICAgICAgcnVsZXM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlbXB0eScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNFbXB0eSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2V4aXN0UnVsZScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNEb3VibGUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHRpbWVvdXRfZXh0ZW5zaW9uOiB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiAndGltZW91dF9leHRlbnNpb24nLFxuICAgICAgICAgICAgcnVsZXM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdlbXB0eScsXG4gICAgICAgICAgICAgICAgICAgIHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlVGltZW91dEV4dGVuc2lvbklzRW1wdHksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIGF1ZGlvX21lc3NhZ2VfaWQ6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICdhdWRpb19tZXNzYWdlX2lkJyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZW1wdHknLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZUF1ZGlvRmlsZUlzRW1wdHksXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICAgIHRpbWVvdXQ6IHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6ICd0aW1lb3V0JyxcbiAgICAgICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaW50ZWdlclswLi45OV0nLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZVRpbWVvdXRPdXRPZlJhbmdlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBudW1iZXJfb2ZfcmVwZWF0OiB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiAnbnVtYmVyX29mX3JlcGVhdCcsXG4gICAgICAgICAgICBydWxlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2ludGVnZXJbMC4uOTldJyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVSZXBlYXROdW1iZXJPdXRPZlJhbmdlLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgIH0sXG5cbiAgICBpbml0aWFsaXplKCkge1xuICAgICAgICAvLyBJbml0aWFsaXplIGRyb3Bkb3duc1xuICAgICAgICBpdnJNZW51LiRkcm9wRG93bnMuZHJvcGRvd24oKTtcblxuICAgICAgICAvLyBEeW5hbWljIGNoZWNrIHRvIHNlZSBpZiB0aGUgc2VsZWN0ZWQgbnVtYmVyIGlzIGF2YWlsYWJsZVxuICAgICAgICBpdnJNZW51LiRudW1iZXIub24oJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5ld051bWJlciA9IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2V4dGVuc2lvbicpO1xuICAgICAgICAgICAgRXh0ZW5zaW9ucy5jaGVja0F2YWlsYWJpbGl0eShpdnJNZW51LmRlZmF1bHROdW1iZXIsIG5ld051bWJlcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lciBmb3IgYWRkaW5nIGEgbmV3IElWUiBhY3Rpb24gcm93XG4gICAgICAgICQoJyNhZGQtbmV3LWl2ci1hY3Rpb24nKS5vbignY2xpY2snLCAoZWwpID0+IHtcbiAgICAgICAgICAgIGl2ck1lbnUuYWRkTmV3QWN0aW9uUm93KCk7XG4gICAgICAgICAgICBpdnJNZW51LnJlYnVpbGRBY3Rpb25FeHRlbnNpb25zRHJvcGRvd24oKTtcblxuICAgICAgICAgICAgLy8gVHJpZ2dlciBjaGFuZ2UgZXZlbnQgdG8gYWNrbm93bGVkZ2UgdGhlIG1vZGlmaWNhdGlvblxuICAgICAgICAgICAgRm9ybS5kYXRhQ2hhbmdlZCgpO1xuXG4gICAgICAgICAgICBlbC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KVxuXG4gICAgICAgIC8vIEluaXRpYWxpemUgYXVkaW8gbWVzc2FnZSBkcm9wZG93bnNcbiAgICAgICAgJCgnI2l2ci1tZW51LWZvcm0gLmF1ZGlvLW1lc3NhZ2Utc2VsZWN0JykuZHJvcGRvd24oU291bmRGaWxlc1NlbGVjdG9yLmdldERyb3Bkb3duU2V0dGluZ3NXaXRoRW1wdHkoKSk7XG5cbiAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgZm9ybVxuICAgICAgICBpdnJNZW51LmluaXRpYWxpemVGb3JtKCk7XG5cbiAgICAgICAgLy8gQnVpbGQgSVZSIG1lbnUgYWN0aW9uc1xuICAgICAgICBpdnJNZW51LmJ1aWxkSXZyTWVudUFjdGlvbnMoKTtcblxuICAgICAgICAvLyBHZXQgdGhlIGRlZmF1bHQgZXh0ZW5zaW9uIHZhbHVlXG4gICAgICAgIGl2ck1lbnUuZGVmYXVsdEV4dGVuc2lvbiA9IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2V4dGVuc2lvbicpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGl2ciBtZW51IGl0ZW1zIG9uIHRoZSBmb3JtXG4gICAgICovXG4gICAgYnVpbGRJdnJNZW51QWN0aW9ucygpIHtcbiAgICAgICAgY29uc3Qgb2JqQWN0aW9ucyA9IEpTT04ucGFyc2UoaXZyQWN0aW9ucyk7XG4gICAgICAgIG9iakFjdGlvbnMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgaXZyTWVudS5hZGROZXdBY3Rpb25Sb3coZWxlbWVudCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAob2JqQWN0aW9ucy5sZW5ndGggPT09IDApIGl2ck1lbnUuYWRkTmV3QWN0aW9uUm93KCk7XG5cbiAgICAgICAgaXZyTWVudS5yZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEFkZHMgbmV3IGZvcm0gdmFsaWRhdGlvbiBydWxlcyBmb3IgYSBuZXdseSBhZGRlZCBhY3Rpb24gcm93LlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuZXdSb3dJZCAtIFRoZSBJRCBvZiB0aGUgbmV3bHkgYWRkZWQgYWN0aW9uIHJvdy5cbiAgICAgKi9cbiAgICBhZGROZXdGb3JtUnVsZXMobmV3Um93SWQpIHtcblxuICAgICAgICAvLyBDcmVhdGUgdGhlIGlkZW50aWZpZXIgZm9yIHRoZSBkaWdpdHMgZmllbGQgb2YgdGhlIG5ldyByb3dcbiAgICAgICAgY29uc3QgJGRpZ2l0c0NsYXNzID0gYGRpZ2l0cy0ke25ld1Jvd0lkfWA7XG5cbiAgICAgICAgLy8gRGVmaW5lIHRoZSB2YWxpZGF0aW9uIHJ1bGVzIGZvciB0aGUgZGlnaXRzIGZpZWxkXG4gICAgICAgIGl2ck1lbnUudmFsaWRhdGVSdWxlc1skZGlnaXRzQ2xhc3NdID0ge1xuICAgICAgICAgICAgaWRlbnRpZmllcjogJGRpZ2l0c0NsYXNzLFxuICAgICAgICAgICAgcnVsZXM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdyZWdFeHBbL15bMC05XXsxLDd9JC9dJyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVEaWdpdHNJc05vdENvcnJlY3QsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaGVja0RvdWJsZXNEaWdpdHMnLFxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZURpZ2l0c0lzTm90Q29ycmVjdCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcblxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIENyZWF0ZSB0aGUgaWRlbnRpZmllciBmb3IgdGhlIGV4dGVuc2lvbiBmaWVsZCBvZiB0aGUgbmV3IHJvd1xuICAgICAgICBjb25zdCAkZXh0ZW5zaW9uQ2xhc3MgPSBgZXh0ZW5zaW9uLSR7bmV3Um93SWR9YDtcblxuICAgICAgICAvLyBEZWZpbmUgdGhlIHZhbGlkYXRpb24gcnVsZXMgZm9yIHRoZSBleHRlbnNpb24gZmllbGRcbiAgICAgICAgaXZyTWVudS52YWxpZGF0ZVJ1bGVzWyRleHRlbnNpb25DbGFzc10gPSB7XG4gICAgICAgICAgICBpZGVudGlmaWVyOiAkZXh0ZW5zaW9uQ2xhc3MsXG4gICAgICAgICAgICBydWxlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2VtcHR5JyxcbiAgICAgICAgICAgICAgICAgICAgcHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVFeHRlbnNpb25Jc05vdENvcnJlY3QsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG5cbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQWRkcyBhIG5ldyBhY3Rpb24gcm93IHRvIHRoZSBJVlIgbWVudSBmb3JtLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbU9iaiAtIE9wdGlvbmFsIHBhcmFtZXRlciBvYmplY3Qgd2l0aCBpbml0aWFsIHZhbHVlcyBmb3IgdGhlIGFjdGlvbiByb3cuXG4gICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgbm90IHByb3ZpZGVkLCBkZWZhdWx0IHZhbHVlcyB3aWxsIGJlIHVzZWQuXG4gICAgICovXG4gICAgYWRkTmV3QWN0aW9uUm93KHBhcmFtT2JqKSB7XG4gICAgICAgIC8vIERlZmF1bHQgcGFyYW1ldGVyIHZhbHVlc1xuICAgICAgICBsZXQgcGFyYW0gPSB7XG4gICAgICAgICAgICBpZDogJycsXG4gICAgICAgICAgICBleHRlbnNpb246ICcnLFxuICAgICAgICAgICAgZXh0ZW5zaW9uUmVwcmVzZW50OiAnJyxcbiAgICAgICAgICAgIGRpZ2l0czogJycsXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gT3ZlcnJpZGUgZGVmYXVsdCB2YWx1ZXMgd2l0aCB0aGUgcHJvdmlkZWQgcGFyYW1ldGVyIG9iamVjdFxuICAgICAgICBpZiAocGFyYW1PYmogIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcGFyYW0gPSBwYXJhbU9iajtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEluY3JlbWVudCB0aGUgYWN0aW9uc1Jvd3NDb3VudFxuICAgICAgICBpdnJNZW51LmFjdGlvbnNSb3dzQ291bnQgKz0gMTtcblxuICAgICAgICAvLyBDbG9uZSB0aGUgcm93IHRlbXBsYXRlIGFuZCBtb2RpZnkgaXRzIGF0dHJpYnV0ZXMgYW5kIGNvbnRlbnRcbiAgICAgICAgY29uc3QgJGFjdGlvblRlbXBsYXRlID0gaXZyTWVudS4kcm93VGVtcGxhdGUuY2xvbmUoKTtcbiAgICAgICAgJGFjdGlvblRlbXBsYXRlXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpXG4gICAgICAgICAgICAuYXR0cignaWQnLCBgcm93LSR7aXZyTWVudS5hY3Rpb25zUm93c0NvdW50fWApXG4gICAgICAgICAgICAuYXR0cignZGF0YS12YWx1ZScsIGl2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudClcbiAgICAgICAgICAgIC5hdHRyKCdzdHlsZScsICcnKTtcblxuICAgICAgICAvLyBTZXQgdGhlIGF0dHJpYnV0ZXMgYW5kIHZhbHVlcyBmb3IgZGlnaXRzIGlucHV0IGZpZWxkXG4gICAgICAgICRhY3Rpb25UZW1wbGF0ZS5maW5kKCdpbnB1dFtuYW1lPVwiZGlnaXRzLWlkXCJdJylcbiAgICAgICAgICAgIC5hdHRyKCdpZCcsIGBkaWdpdHMtJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcbiAgICAgICAgICAgIC5hdHRyKCduYW1lJywgYGRpZ2l0cy0ke2l2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudH1gKVxuICAgICAgICAgICAgLmF0dHIoJ3ZhbHVlJywgcGFyYW0uZGlnaXRzKTtcblxuICAgICAgICAvLyBTZXQgdGhlIGF0dHJpYnV0ZXMgYW5kIHZhbHVlcyBmb3IgZXh0ZW5zaW9uIGlucHV0IGZpZWxkXG4gICAgICAgICRhY3Rpb25UZW1wbGF0ZS5maW5kKCdpbnB1dFtuYW1lPVwiZXh0ZW5zaW9uLWlkXCJdJylcbiAgICAgICAgICAgIC5hdHRyKCdpZCcsIGBleHRlbnNpb24tJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcbiAgICAgICAgICAgIC5hdHRyKCduYW1lJywgYGV4dGVuc2lvbi0ke2l2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudH1gKVxuICAgICAgICAgICAgLmF0dHIoJ3ZhbHVlJywgcGFyYW0uZXh0ZW5zaW9uKTtcblxuICAgICAgICAvLyBTZXQgdGhlIGRhdGEtdmFsdWUgYXR0cmlidXRlIGZvciB0aGUgZGVsZXRlLWFjdGlvbi1yb3cgZWxlbWVudFxuICAgICAgICAkYWN0aW9uVGVtcGxhdGUuZmluZCgnZGl2LmRlbGV0ZS1hY3Rpb24tcm93JylcbiAgICAgICAgICAgIC5hdHRyKCdkYXRhLXZhbHVlJywgaXZyTWVudS5hY3Rpb25zUm93c0NvdW50KTtcblxuICAgICAgICAvLyBVcGRhdGUgdGhlIGV4dGVuc2lvblJlcHJlc2VudCBjb250ZW50IGJhc2VkIG9uIHRoZSBwcm92aWRlZCB2YWx1ZSBvciBkZWZhdWx0IHRleHRcbiAgICAgICAgaWYgKHBhcmFtLmV4dGVuc2lvblJlcHJlc2VudC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAkYWN0aW9uVGVtcGxhdGUuZmluZCgnZGl2LmRlZmF1bHQudGV4dCcpLnJlbW92ZUNsYXNzKCdkZWZhdWx0JykuaHRtbChwYXJhbS5leHRlbnNpb25SZXByZXNlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJGFjdGlvblRlbXBsYXRlLmZpbmQoJ2Rpdi5kZWZhdWx0LnRleHQnKS5odG1sKGdsb2JhbFRyYW5zbGF0ZS5leF9TZWxlY3ROdW1iZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQXBwZW5kIHRoZSBhY3Rpb24gdGVtcGxhdGUgdG8gdGhlIGFjdGlvbnMtcGxhY2UgZWxlbWVudFxuICAgICAgICAkKCcjYWN0aW9ucy1wbGFjZScpLmFwcGVuZCgkYWN0aW9uVGVtcGxhdGUpO1xuXG4gICAgICAgIC8vIEFkZCBuZXcgZm9ybSBydWxlcyBmb3IgdGhlIG5ld2x5IGFkZGVkIGFjdGlvbiByb3dcbiAgICAgICAgaXZyTWVudS5hZGROZXdGb3JtUnVsZXMoaXZyTWVudS5hY3Rpb25zUm93c0NvdW50KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVidWlsZHMgdGhlIGFjdGlvbiBleHRlbnNpb25zIGRyb3Bkb3duIGJ5IGluaXRpYWxpemluZyB0aGUgZHJvcGRvd24gc2V0dGluZ3MgZm9yIHJvdXRpbmdcbiAgICAgKiBhbmQgYXR0YWNoaW5nIHRoZSBjYk9uRXh0ZW5zaW9uU2VsZWN0IGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGhhbmRsZSB0aGUgZXh0ZW5zaW9uIHNlbGVjdGlvbiBldmVudC5cbiAgICAgKi9cbiAgICByZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duKCkge1xuICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBkcm9wZG93biBzZXR0aW5ncyBmb3Igcm91dGluZyB3aXRoIGNiT25FeHRlbnNpb25TZWxlY3QgY2FsbGJhY2sgZnVuY3Rpb25cbiAgICAgICAgJCgnI2l2ci1tZW51LWZvcm0gLmZvcndhcmRpbmctc2VsZWN0JykuZHJvcGRvd24oRXh0ZW5zaW9ucy5nZXREcm9wZG93blNldHRpbmdzRm9yUm91dGluZyhpdnJNZW51LmNiT25FeHRlbnNpb25TZWxlY3QpKTtcblxuICAgICAgICAvLyBBdHRhY2ggYSBjbGljayBldmVudCBoYW5kbGVyIHRvIHRoZSBkZWxldGUtYWN0aW9uLXJvdyBlbGVtZW50c1xuICAgICAgICAkKCcuZGVsZXRlLWFjdGlvbi1yb3cnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAvLyBHZXQgdGhlICdkYXRhLXZhbHVlJyBhdHRyaWJ1dGUgb2YgdGhlIGNsaWNrZWQgZWxlbWVudFxuICAgICAgICAgICAgY29uc3QgaWQgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtdmFsdWUnKTtcblxuICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjb3JyZXNwb25kaW5nIHJ1bGVzIGZyb20gdmFsaWRhdGVSdWxlcyBvYmplY3RcbiAgICAgICAgICAgIGRlbGV0ZSBpdnJNZW51LnZhbGlkYXRlUnVsZXNbYGRpZ2l0cy0ke2lkfWBdO1xuICAgICAgICAgICAgZGVsZXRlIGl2ck1lbnUudmFsaWRhdGVSdWxlc1tgZXh0ZW5zaW9uLSR7aWR9YF07XG5cbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgcm93IHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgaWRcbiAgICAgICAgICAgICQoYCNyb3ctJHtpZH1gKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgLy8gVHJpZ2dlciBjaGFuZ2UgZXZlbnQgdG8gYWNrbm93bGVkZ2UgdGhlIG1vZGlmaWNhdGlvblxuICAgICAgICAgICAgRm9ybS5kYXRhQ2hhbmdlZCgpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGJlZm9yZSB0aGUgZm9ybSBpcyBzZW50XG4gICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIC0gVGhlIGN1cnJlbnQgc2V0dGluZ3Mgb2YgdGhlIGZvcm1cbiAgICAgKiBAcmV0dXJucyB7T2JqZWN0fSAtIFRoZSB1cGRhdGVkIHNldHRpbmdzIG9mIHRoZSBmb3JtXG4gICAgICovXG4gICAgY2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncykge1xuICAgICAgICAvLyBDb3B5IHRoZSBzZXR0aW5ncyBvYmplY3QgdG8gYSBuZXcgdmFyaWFibGUgdG8gYXZvaWQgbW9kaWZ5aW5nIHRoZSBvcmlnaW5hbFxuICAgICAgICBsZXQgcmVzdWx0ID0gc2V0dGluZ3M7XG5cbiAgICAgICAgLy8gR2V0IHRoZSBmb3JtIHZhbHVlcyBmcm9tICRmb3JtT2JqIG9mIGl2ck1lbnVcbiAgICAgICAgcmVzdWx0LmRhdGEgPSBpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblxuICAgICAgICAvLyBJbml0aWFsaXplIGFuIGFycmF5IHRvIHN0b3JlIGFjdGlvbnNcbiAgICAgICAgY29uc3QgYXJyQWN0aW9ucyA9IFtdO1xuXG4gICAgICAgIC8vIEl0ZXJhdGUgb3ZlciBlYWNoIGFjdGlvbiByb3dcbiAgICAgICAgJCgnLmFjdGlvbi1yb3cnKS5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByb3dJZCA9ICQob2JqKS5hdHRyKCdkYXRhLXZhbHVlJyk7XG5cbiAgICAgICAgICAgIC8vIElmIHJvd0lkIGlzIGdyZWF0ZXIgdGhhbiAwLCBnZXQgdGhlICdkaWdpdHMnIGFuZCAnZXh0ZW5zaW9uJyB2YWx1ZXMgZnJvbSB0aGUgZm9ybSBhbmQgcHVzaCB0aGVtIGludG8gdGhlIGFyckFjdGlvbnMgYXJyYXlcbiAgICAgICAgICAgIGlmIChyb3dJZCA+IDApIHtcbiAgICAgICAgICAgICAgICBhcnJBY3Rpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBkaWdpdHM6IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgYGRpZ2l0cy0ke3Jvd0lkfWApLFxuICAgICAgICAgICAgICAgICAgICBleHRlbnNpb246IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgYGV4dGVuc2lvbi0ke3Jvd0lkfWApLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBJZiB0aGVyZSBhcmUgbm8gYWN0aW9uIHJvd3MsIHNldCB0aGUgcmVzdWx0IHRvIGZhbHNlLCBkaXNwbGF5IGFuIGVycm9yIG1lc3NhZ2UgYW5kIGFkZCBlcnJvciBjbGFzcyB0byB0aGUgZm9ybVxuICAgICAgICBpZiAoYXJyQWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xuICAgICAgICAgICAgaXZyTWVudS4kZXJyb3JNZXNzYWdlcy5odG1sKGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZU5vSVZSRXh0ZW5zaW9ucyk7XG4gICAgICAgICAgICBpdnJNZW51LiRmb3JtT2JqLmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAvLyBDb252ZXJ0IHRoZSBhcnJBY3Rpb25zIGFycmF5IGludG8gYSBKU09OIHN0cmluZyBhbmQgYXNzaWduIGl0IHRvICdhY3Rpb25zJyBrZXkgaW4gdGhlIHJlc3VsdCBkYXRhIG9iamVjdFxuICAgICAgICAgICAgcmVzdWx0LmRhdGEuYWN0aW9ucyA9IEpTT04uc3RyaW5naWZ5KGFyckFjdGlvbnMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmV0dXJuIHRoZSBtb2RpZmllZCBzZXR0aW5ncyBvYmplY3Qgb3IgZmFsc2VcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgdHJpZ2dlcnMgd2hlbiBhIG51bWJlciBpcyBzZWxlY3RlZCBmcm9tIHRoZSBkcm9wZG93biBtZW51LlxuICAgICAqIEl0IGdlbmVyYXRlcyBhIHJhbmRvbSBudW1iZXIgYW5kIHRyaWdnZXJzIGEgY2hhbmdlIGV2ZW50LlxuICAgICAqL1xuICAgIGNiT25FeHRlbnNpb25TZWxlY3QoKSB7XG4gICAgICAgIC8vIFRyaWdnZXIgY2hhbmdlIGV2ZW50IHRvIGFja25vd2xlZGdlIHRoZSBtb2RpZmljYXRpb25cbiAgICAgICAgRm9ybS5kYXRhQ2hhbmdlZCgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWQgYWZ0ZXIgdGhlIGZvcm0gaGFzIGJlZW4gc2VudC5cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVzcG9uc2UgLSBUaGUgcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyIGFmdGVyIHRoZSBmb3JtIGlzIHNlbnRcbiAgICAgKi9cbiAgICBjYkFmdGVyU2VuZEZvcm0ocmVzcG9uc2UpIHtcblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBmb3JtIHdpdGggY3VzdG9tIHNldHRpbmdzXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZUZvcm0oKSB7XG4gICAgICAgIEZvcm0uJGZvcm1PYmogPSBpdnJNZW51LiRmb3JtT2JqO1xuICAgICAgICBGb3JtLnVybCA9IGAke2dsb2JhbFJvb3RVcmx9aXZyLW1lbnUvc2F2ZWA7IC8vIEZvcm0gc3VibWlzc2lvbiBVUkxcbiAgICAgICAgRm9ybS52YWxpZGF0ZVJ1bGVzID0gaXZyTWVudS52YWxpZGF0ZVJ1bGVzOyAvLyBGb3JtIHZhbGlkYXRpb24gcnVsZXNcbiAgICAgICAgRm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gaXZyTWVudS5jYkJlZm9yZVNlbmRGb3JtOyAvLyBDYWxsYmFjayBiZWZvcmUgZm9ybSBpcyBzZW50XG4gICAgICAgIEZvcm0uY2JBZnRlclNlbmRGb3JtID0gaXZyTWVudS5jYkFmdGVyU2VuZEZvcm07IC8vIENhbGxiYWNrIGFmdGVyIGZvcm0gaXMgc2VudFxuICAgICAgICBGb3JtLmluaXRpYWxpemUoKTtcbiAgICB9LFxufTtcblxuLyoqXG4gKiBDdXN0b20gZm9ybSBydWxlIHRvIGNoZWNrIGlmIGFuIGVsZW1lbnQgd2l0aCBpZCAnZXh0ZW5zaW9uLWVycm9yJyBoYXMgdGhlIGNsYXNzICdoaWRkZW4nLlxuICovXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuZXhpc3RSdWxlID0gKCkgPT4gJCgnI2V4dGVuc2lvbi1lcnJvcicpLmhhc0NsYXNzKCdoaWRkZW4nKTtcblxuXG4vKipcbiAqIEN1c3RvbSBmb3JtIHJ1bGUgdG8gY2hlY2sgZm9yIGR1cGxpY2F0ZSBkaWdpdHMgdmFsdWVzLlxuICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIHZhbHVlIHRvIGNoZWNrIGZvciBkdXBsaWNhdGVzLlxuICogQHJldHVybnMge2Jvb2xlYW59IC0gVHJ1ZSBpZiB0aGVyZSBhcmUgbm8gZHVwbGljYXRlcywgZmFsc2Ugb3RoZXJ3aXNlLlxuICovXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuY2hlY2tEb3VibGVzRGlnaXRzID0gKHZhbHVlKSA9PiB7XG4gICAgbGV0IGNvdW50ID0gMDtcbiAgICAkKFwiaW5wdXRbaWRePSdkaWdpdHMnXVwiKS5lYWNoKChpbmRleCwgb2JqKSA9PiB7XG4gICAgICAgIGlmIChpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsIGAke29iai5pZH1gKSA9PT0gdmFsdWUpIGNvdW50ICs9IDE7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gKGNvdW50ID09PSAxKTtcbn07XG5cbi8qKlxuICogIEluaXRpYWxpemUgSVZSIG1lbnUgbW9kaWZ5IGZvcm0gb24gZG9jdW1lbnQgcmVhZHlcbiAqL1xuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIGl2ck1lbnUuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==