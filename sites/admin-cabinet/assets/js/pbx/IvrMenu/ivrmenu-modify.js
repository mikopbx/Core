"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, ivrActions, globalTranslate, Form, Extensions, SoundFilesSelector */
$.fn.form.settings.rules.existRule = function () {
  return $('#extension-error').hasClass('hidden');
};

var ivrMenu = {
  $formObj: $('#ivr-menu-form'),
  $dropDowns: $('#ivr-menu-form .ui.dropdown'),
  $number: $('#extension'),
  $dirrtyField: $('#dirrty'),
  $errorMessages: $('#form-error-messages'),
  $rowTemplate: $('#row-template'),
  defaultExtension: '',
  actionsRowsCount: 0,
  validateRules: {
    name: {
      identifier: 'name',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateNameIsEmpty
      }]
    },
    extension: {
      identifier: 'extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateExtensionIsEmpty
      }, {
        type: 'existRule',
        prompt: globalTranslate.iv_ValidateExtensionIsDouble
      }]
    },
    timeout_extension: {
      identifier: 'timeout_extension',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateTimeoutExtensionIsEmpty
      }]
    },
    audio_message_id: {
      identifier: 'audio_message_id',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateAudioFileIsEmpty
      }]
    },
    timeout: {
      identifier: 'timeout',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateTimeoutOutOfRange
      }]
    },
    number_of_repeat: {
      identifier: 'number_of_repeat',
      rules: [{
        type: 'integer[0..99]',
        prompt: globalTranslate.iv_ValidateRepeatNumberOutOfRange
      }]
    }
  },
  initialize: function initialize() {
    ivrMenu.$dropDowns.dropdown(); // Динамическая прововерка свободен ли выбранный номер

    ivrMenu.$number.on('change', function () {
      var newNumber = ivrMenu.$formObj.form('get value', 'extension');
      Extensions.checkAvailability(ivrMenu.defaultNumber, newNumber);
    });
    $('#add-new-ivr-action').on('click', function (el) {
      ivrMenu.addNewActionRow();
      ivrMenu.rebuildActionExtensionsDropdown();
      ivrMenu.$dirrtyField.val(Math.random());
      ivrMenu.$dirrtyField.trigger('change');
      el.preventDefault();
    });
    $('#ivr-menu-form .audio-message-select').dropdown(SoundFilesSelector.getDropdownSettingsWithEmpty());
    ivrMenu.initializeForm();
    ivrMenu.buildIvrMenuActions();
    ivrMenu.defaultExtension = ivrMenu.$formObj.form('get value', 'extension');
  },

  /**
   * Create ivr menu items on the form
   */
  buildIvrMenuActions: function buildIvrMenuActions() {
    var objActions = JSON.parse(ivrActions);
    objActions.forEach(function (element) {
      ivrMenu.addNewActionRow(element);
    });
    if (objActions.length === 0) ivrMenu.addNewActionRow();
    ivrMenu.rebuildActionExtensionsDropdown();
  },
  addNewFormRules: function addNewFormRules(newRowId) {
    var $digitsClass = "digits-".concat(newRowId);
    ivrMenu.validateRules[$digitsClass] = {
      identifier: $digitsClass,
      rules: [{
        type: 'regExp[/^[0-9]{1,7}$/]',
        prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
      }, {
        type: 'checkDoublesDigits',
        prompt: globalTranslate.iv_ValidateDigitsIsNotCorrect
      }]
    };
    var $extensionClass = "extension-".concat(newRowId);
    ivrMenu.validateRules[$extensionClass] = {
      identifier: $extensionClass,
      rules: [{
        type: 'empty',
        prompt: globalTranslate.iv_ValidateExtensionIsNotCorrect
      }]
    };
  },
  addNewActionRow: function addNewActionRow(paramObj) {
    var param = {
      id: '',
      extension: '',
      extensionRepresent: '',
      digits: ''
    };

    if (paramObj !== undefined) {
      param = paramObj;
    }

    ivrMenu.actionsRowsCount += 1;
    var $actionTemplate = ivrMenu.$rowTemplate.clone();
    $actionTemplate.removeClass('hidden').attr('id', "row-".concat(ivrMenu.actionsRowsCount)).attr('data-value', ivrMenu.actionsRowsCount).attr('style', '');
    $actionTemplate.find('input[name="digits-id"]').attr('id', "digits-".concat(ivrMenu.actionsRowsCount)).attr('name', "digits-".concat(ivrMenu.actionsRowsCount)).attr('value', param.digits);
    $actionTemplate.find('input[name="extension-id"]').attr('id', "extension-".concat(ivrMenu.actionsRowsCount)).attr('name', "extension-".concat(ivrMenu.actionsRowsCount)).attr('value', param.extension);
    $actionTemplate.find('div.delete-action-row').attr('data-value', ivrMenu.actionsRowsCount);

    if (param.extensionRepresent.length > 0) {
      $actionTemplate.find('div.default.text').removeClass('default').html(param.extensionRepresent);
    } else {
      $actionTemplate.find('div.default.text').html(globalTranslate.ex_SelectNumber);
    }

    $('#actions-place').append($actionTemplate);
    ivrMenu.addNewFormRules(ivrMenu.actionsRowsCount);
  },
  rebuildActionExtensionsDropdown: function rebuildActionExtensionsDropdown() {
    $('#ivr-menu-form .forwarding-select').dropdown(Extensions.getDropdownSettingsForRouting(ivrMenu.cbOnExtensionSelect));
    $('.delete-action-row').on('click', function (e) {
      e.preventDefault();
      var id = $(this).attr('data-value');
      delete ivrMenu.validateRules["digits-".concat(id)];
      delete ivrMenu.validateRules["extension-".concat(id)];
      $("#row-".concat(id)).remove();
      ivrMenu.$dirrtyField.val(Math.random());
      ivrMenu.$dirrtyField.trigger('change');
    });
  },
  cbBeforeSendForm: function cbBeforeSendForm(settings) {
    var result = settings;
    result.data = ivrMenu.$formObj.form('get values');
    var arrActions = [];
    $('.action-row').each(function (index, obj) {
      var rowId = $(obj).attr('data-value');

      if (rowId > 0) {
        arrActions.push({
          digits: ivrMenu.$formObj.form('get value', "digits-".concat(rowId)),
          extension: ivrMenu.$formObj.form('get value', "extension-".concat(rowId))
        });
      }
    });

    if (arrActions.length === 0) {
      result = false;
      ivrMenu.$errorMessages.html(globalTranslate.iv_ValidateNoIVRExtensions);
      ivrMenu.$formObj.addClass('error');
    } else {
      result.data.actions = JSON.stringify(arrActions);
    }

    return result;
  },

  /**
   * Срабатывает при выборе номера из выпадающего списка
   */
  cbOnExtensionSelect: function cbOnExtensionSelect() {
    ivrMenu.$dirrtyField.val(Math.random());
    ivrMenu.$dirrtyField.trigger('change');
  },
  cbAfterSendForm: function cbAfterSendForm() {},
  initializeForm: function initializeForm() {
    Form.$formObj = ivrMenu.$formObj;
    Form.url = "".concat(globalRootUrl, "ivr-menu/save");
    Form.validateRules = ivrMenu.validateRules;
    Form.cbBeforeSendForm = ivrMenu.cbBeforeSendForm;
    Form.cbAfterSendForm = ivrMenu.cbAfterSendForm;
    Form.initialize();
  }
};

$.fn.form.settings.rules.checkDoublesDigits = function (value) {
  var count = 0;
  $("input[id^='digits']").each(function (index, obj) {
    if (ivrMenu.$formObj.form('get value', "".concat(obj.id)) === value) count += 1;
  });
  return count === 1;
};

$(document).ready(function () {
  ivrMenu.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9JdnJNZW51L2l2cm1lbnUtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbIiQiLCJmbiIsImZvcm0iLCJzZXR0aW5ncyIsInJ1bGVzIiwiZXhpc3RSdWxlIiwiaGFzQ2xhc3MiLCJpdnJNZW51IiwiJGZvcm1PYmoiLCIkZHJvcERvd25zIiwiJG51bWJlciIsIiRkaXJydHlGaWVsZCIsIiRlcnJvck1lc3NhZ2VzIiwiJHJvd1RlbXBsYXRlIiwiZGVmYXVsdEV4dGVuc2lvbiIsImFjdGlvbnNSb3dzQ291bnQiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJ0eXBlIiwicHJvbXB0IiwiZ2xvYmFsVHJhbnNsYXRlIiwiaXZfVmFsaWRhdGVOYW1lSXNFbXB0eSIsImV4dGVuc2lvbiIsIml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNFbXB0eSIsIml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNEb3VibGUiLCJ0aW1lb3V0X2V4dGVuc2lvbiIsIml2X1ZhbGlkYXRlVGltZW91dEV4dGVuc2lvbklzRW1wdHkiLCJhdWRpb19tZXNzYWdlX2lkIiwiaXZfVmFsaWRhdGVBdWRpb0ZpbGVJc0VtcHR5IiwidGltZW91dCIsIml2X1ZhbGlkYXRlVGltZW91dE91dE9mUmFuZ2UiLCJudW1iZXJfb2ZfcmVwZWF0IiwiaXZfVmFsaWRhdGVSZXBlYXROdW1iZXJPdXRPZlJhbmdlIiwiaW5pdGlhbGl6ZSIsImRyb3Bkb3duIiwib24iLCJuZXdOdW1iZXIiLCJFeHRlbnNpb25zIiwiY2hlY2tBdmFpbGFiaWxpdHkiLCJkZWZhdWx0TnVtYmVyIiwiZWwiLCJhZGROZXdBY3Rpb25Sb3ciLCJyZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duIiwidmFsIiwiTWF0aCIsInJhbmRvbSIsInRyaWdnZXIiLCJwcmV2ZW50RGVmYXVsdCIsIlNvdW5kRmlsZXNTZWxlY3RvciIsImdldERyb3Bkb3duU2V0dGluZ3NXaXRoRW1wdHkiLCJpbml0aWFsaXplRm9ybSIsImJ1aWxkSXZyTWVudUFjdGlvbnMiLCJvYmpBY3Rpb25zIiwiSlNPTiIsInBhcnNlIiwiaXZyQWN0aW9ucyIsImZvckVhY2giLCJlbGVtZW50IiwibGVuZ3RoIiwiYWRkTmV3Rm9ybVJ1bGVzIiwibmV3Um93SWQiLCIkZGlnaXRzQ2xhc3MiLCJpdl9WYWxpZGF0ZURpZ2l0c0lzTm90Q29ycmVjdCIsIiRleHRlbnNpb25DbGFzcyIsIml2X1ZhbGlkYXRlRXh0ZW5zaW9uSXNOb3RDb3JyZWN0IiwicGFyYW1PYmoiLCJwYXJhbSIsImlkIiwiZXh0ZW5zaW9uUmVwcmVzZW50IiwiZGlnaXRzIiwidW5kZWZpbmVkIiwiJGFjdGlvblRlbXBsYXRlIiwiY2xvbmUiLCJyZW1vdmVDbGFzcyIsImF0dHIiLCJmaW5kIiwiaHRtbCIsImV4X1NlbGVjdE51bWJlciIsImFwcGVuZCIsImdldERyb3Bkb3duU2V0dGluZ3NGb3JSb3V0aW5nIiwiY2JPbkV4dGVuc2lvblNlbGVjdCIsImUiLCJyZW1vdmUiLCJjYkJlZm9yZVNlbmRGb3JtIiwicmVzdWx0IiwiZGF0YSIsImFyckFjdGlvbnMiLCJlYWNoIiwiaW5kZXgiLCJvYmoiLCJyb3dJZCIsInB1c2giLCJpdl9WYWxpZGF0ZU5vSVZSRXh0ZW5zaW9ucyIsImFkZENsYXNzIiwiYWN0aW9ucyIsInN0cmluZ2lmeSIsImNiQWZ0ZXJTZW5kRm9ybSIsIkZvcm0iLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwiY2hlY2tEb3VibGVzRGlnaXRzIiwidmFsdWUiLCJjb3VudCIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBQSxDQUFDLENBQUNDLEVBQUYsQ0FBS0MsSUFBTCxDQUFVQyxRQUFWLENBQW1CQyxLQUFuQixDQUF5QkMsU0FBekIsR0FBcUM7QUFBQSxTQUFNTCxDQUFDLENBQUMsa0JBQUQsQ0FBRCxD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ZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IChDKSAyMDE3LTIwMjMgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsIGl2ckFjdGlvbnMsIGdsb2JhbFRyYW5zbGF0ZSwgRm9ybSwgRXh0ZW5zaW9ucywgU291bmRGaWxlc1NlbGVjdG9yICovXG5cbiQuZm4uZm9ybS5zZXR0aW5ncy5ydWxlcy5leGlzdFJ1bGUgPSAoKSA9PiAkKCcjZXh0ZW5zaW9uLWVycm9yJykuaGFzQ2xhc3MoJ2hpZGRlbicpO1xuXG5jb25zdCBpdnJNZW51ID0ge1xuXHQkZm9ybU9iajogJCgnI2l2ci1tZW51LWZvcm0nKSxcblx0JGRyb3BEb3duczogJCgnI2l2ci1tZW51LWZvcm0gLnVpLmRyb3Bkb3duJyksXG5cdCRudW1iZXI6ICQoJyNleHRlbnNpb24nKSxcblx0JGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cdCRlcnJvck1lc3NhZ2VzOiAkKCcjZm9ybS1lcnJvci1tZXNzYWdlcycpLFxuXHQkcm93VGVtcGxhdGU6ICQoJyNyb3ctdGVtcGxhdGUnKSxcblx0ZGVmYXVsdEV4dGVuc2lvbjogJycsXG5cdGFjdGlvbnNSb3dzQ291bnQ6IDAsXG5cdHZhbGlkYXRlUnVsZXM6IHtcblx0XHRuYW1lOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnbmFtZScsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZU5hbWVJc0VtcHR5LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdGV4dGVuc2lvbjoge1xuXHRcdFx0aWRlbnRpZmllcjogJ2V4dGVuc2lvbicsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZUV4dGVuc2lvbklzRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZXhpc3RSdWxlJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZUV4dGVuc2lvbklzRG91YmxlLFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblx0XHR9LFxuXHRcdHRpbWVvdXRfZXh0ZW5zaW9uOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAndGltZW91dF9leHRlbnNpb24nLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdlbXB0eScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVUaW1lb3V0RXh0ZW5zaW9uSXNFbXB0eSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRhdWRpb19tZXNzYWdlX2lkOiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnYXVkaW9fbWVzc2FnZV9pZCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZUF1ZGlvRmlsZUlzRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdFx0dGltZW91dDoge1xuXHRcdFx0aWRlbnRpZmllcjogJ3RpbWVvdXQnLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdpbnRlZ2VyWzAuLjk5XScsXG5cdFx0XHRcdFx0cHJvbXB0OiBnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVUaW1lb3V0T3V0T2ZSYW5nZSxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cdFx0fSxcblx0XHRudW1iZXJfb2ZfcmVwZWF0OiB7XG5cdFx0XHRpZGVudGlmaWVyOiAnbnVtYmVyX29mX3JlcGVhdCcsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2ludGVnZXJbMC4uOTldJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZVJlcGVhdE51bWJlck91dE9mUmFuZ2UsXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cblx0aW5pdGlhbGl6ZSgpIHtcblx0XHRpdnJNZW51LiRkcm9wRG93bnMuZHJvcGRvd24oKTtcblxuXHRcdC8vINCU0LjQvdCw0LzQuNGH0LXRgdC60LDRjyDQv9GA0L7QstC+0LLQtdGA0LrQsCDRgdCy0L7QsdC+0LTQtdC9INC70Lgg0LLRi9Cx0YDQsNC90L3Ri9C5INC90L7QvNC10YBcblx0XHRpdnJNZW51LiRudW1iZXIub24oJ2NoYW5nZScsICgpID0+IHtcblx0XHRcdGNvbnN0IG5ld051bWJlciA9IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2V4dGVuc2lvbicpO1xuXHRcdFx0RXh0ZW5zaW9ucy5jaGVja0F2YWlsYWJpbGl0eShpdnJNZW51LmRlZmF1bHROdW1iZXIsIG5ld051bWJlcik7XG5cdFx0fSk7XG5cblx0XHQkKCcjYWRkLW5ldy1pdnItYWN0aW9uJykub24oJ2NsaWNrJywgKGVsKSA9PiB7XG5cdFx0XHRpdnJNZW51LmFkZE5ld0FjdGlvblJvdygpO1xuXHRcdFx0aXZyTWVudS5yZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duKCk7XG5cdFx0XHRpdnJNZW51LiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG5cdFx0XHRpdnJNZW51LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdGVsLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fSk7XG5cdFx0JCgnI2l2ci1tZW51LWZvcm0gLmF1ZGlvLW1lc3NhZ2Utc2VsZWN0JykuZHJvcGRvd24oU291bmRGaWxlc1NlbGVjdG9yLmdldERyb3Bkb3duU2V0dGluZ3NXaXRoRW1wdHkoKSk7XG5cblx0XHRpdnJNZW51LmluaXRpYWxpemVGb3JtKCk7XG5cblx0XHRpdnJNZW51LmJ1aWxkSXZyTWVudUFjdGlvbnMoKTtcblxuXHRcdGl2ck1lbnUuZGVmYXVsdEV4dGVuc2lvbiA9IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2V4dGVuc2lvbicpO1xuXHR9LFxuXHQvKipcblx0ICogQ3JlYXRlIGl2ciBtZW51IGl0ZW1zIG9uIHRoZSBmb3JtXG5cdCAqL1xuXHRidWlsZEl2ck1lbnVBY3Rpb25zKCkge1xuXHRcdGNvbnN0IG9iakFjdGlvbnMgPSBKU09OLnBhcnNlKGl2ckFjdGlvbnMpO1xuXHRcdG9iakFjdGlvbnMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuXHRcdFx0aXZyTWVudS5hZGROZXdBY3Rpb25Sb3coZWxlbWVudCk7XG5cdFx0fSk7XG5cdFx0aWYgKG9iakFjdGlvbnMubGVuZ3RoID09PSAwKSBpdnJNZW51LmFkZE5ld0FjdGlvblJvdygpO1xuXG5cdFx0aXZyTWVudS5yZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duKCk7XG5cdH0sXG5cdGFkZE5ld0Zvcm1SdWxlcyhuZXdSb3dJZCkge1xuXHRcdGNvbnN0ICRkaWdpdHNDbGFzcyA9IGBkaWdpdHMtJHtuZXdSb3dJZH1gO1xuXHRcdGl2ck1lbnUudmFsaWRhdGVSdWxlc1skZGlnaXRzQ2xhc3NdID0ge1xuXHRcdFx0aWRlbnRpZmllcjogJGRpZ2l0c0NsYXNzLFxuXHRcdFx0cnVsZXM6IFtcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdyZWdFeHBbL15bMC05XXsxLDd9JC9dJyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZURpZ2l0c0lzTm90Q29ycmVjdCxcblx0XHRcdFx0fSxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHR5cGU6ICdjaGVja0RvdWJsZXNEaWdpdHMnLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLml2X1ZhbGlkYXRlRGlnaXRzSXNOb3RDb3JyZWN0LFxuXHRcdFx0XHR9LFxuXHRcdFx0XSxcblxuXHRcdH07XG5cdFx0Y29uc3QgJGV4dGVuc2lvbkNsYXNzID0gYGV4dGVuc2lvbi0ke25ld1Jvd0lkfWA7XG5cdFx0aXZyTWVudS52YWxpZGF0ZVJ1bGVzWyRleHRlbnNpb25DbGFzc10gPSB7XG5cdFx0XHRpZGVudGlmaWVyOiAkZXh0ZW5zaW9uQ2xhc3MsXG5cdFx0XHRydWxlczogW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0dHlwZTogJ2VtcHR5Jyxcblx0XHRcdFx0XHRwcm9tcHQ6IGdsb2JhbFRyYW5zbGF0ZS5pdl9WYWxpZGF0ZUV4dGVuc2lvbklzTm90Q29ycmVjdCxcblx0XHRcdFx0fSxcblx0XHRcdF0sXG5cblx0XHR9O1xuXHR9LFxuXHRhZGROZXdBY3Rpb25Sb3cocGFyYW1PYmopIHtcblx0XHRsZXQgcGFyYW0gPSB7XG5cdFx0XHRpZDogJycsXG5cdFx0XHRleHRlbnNpb246ICcnLFxuXHRcdFx0ZXh0ZW5zaW9uUmVwcmVzZW50OiAnJyxcblx0XHRcdGRpZ2l0czogJycsXG5cdFx0fTtcblx0XHRpZiAocGFyYW1PYmogIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0cGFyYW0gPSBwYXJhbU9iajtcblx0XHR9XG5cdFx0aXZyTWVudS5hY3Rpb25zUm93c0NvdW50ICs9IDE7XG5cdFx0Y29uc3QgJGFjdGlvblRlbXBsYXRlID0gaXZyTWVudS4kcm93VGVtcGxhdGUuY2xvbmUoKTtcblx0XHQkYWN0aW9uVGVtcGxhdGVcblx0XHRcdC5yZW1vdmVDbGFzcygnaGlkZGVuJylcblx0XHRcdC5hdHRyKCdpZCcsIGByb3ctJHtpdnJNZW51LmFjdGlvbnNSb3dzQ291bnR9YClcblx0XHRcdC5hdHRyKCdkYXRhLXZhbHVlJywgaXZyTWVudS5hY3Rpb25zUm93c0NvdW50KVxuXHRcdFx0LmF0dHIoJ3N0eWxlJywgJycpO1xuXG5cdFx0JGFjdGlvblRlbXBsYXRlLmZpbmQoJ2lucHV0W25hbWU9XCJkaWdpdHMtaWRcIl0nKVxuXHRcdFx0LmF0dHIoJ2lkJywgYGRpZ2l0cy0ke2l2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudH1gKVxuXHRcdFx0LmF0dHIoJ25hbWUnLCBgZGlnaXRzLSR7aXZyTWVudS5hY3Rpb25zUm93c0NvdW50fWApXG5cdFx0XHQuYXR0cigndmFsdWUnLCBwYXJhbS5kaWdpdHMpO1xuXG5cdFx0JGFjdGlvblRlbXBsYXRlLmZpbmQoJ2lucHV0W25hbWU9XCJleHRlbnNpb24taWRcIl0nKVxuXHRcdFx0LmF0dHIoJ2lkJywgYGV4dGVuc2lvbi0ke2l2ck1lbnUuYWN0aW9uc1Jvd3NDb3VudH1gKVxuXHRcdFx0LmF0dHIoJ25hbWUnLCBgZXh0ZW5zaW9uLSR7aXZyTWVudS5hY3Rpb25zUm93c0NvdW50fWApXG5cdFx0XHQuYXR0cigndmFsdWUnLCBwYXJhbS5leHRlbnNpb24pO1xuXHRcdCRhY3Rpb25UZW1wbGF0ZS5maW5kKCdkaXYuZGVsZXRlLWFjdGlvbi1yb3cnKVxuXHRcdFx0LmF0dHIoJ2RhdGEtdmFsdWUnLCBpdnJNZW51LmFjdGlvbnNSb3dzQ291bnQpO1xuXG5cdFx0aWYgKHBhcmFtLmV4dGVuc2lvblJlcHJlc2VudC5sZW5ndGggPiAwKSB7XG5cdFx0XHQkYWN0aW9uVGVtcGxhdGUuZmluZCgnZGl2LmRlZmF1bHQudGV4dCcpLnJlbW92ZUNsYXNzKCdkZWZhdWx0JykuaHRtbChwYXJhbS5leHRlbnNpb25SZXByZXNlbnQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQkYWN0aW9uVGVtcGxhdGUuZmluZCgnZGl2LmRlZmF1bHQudGV4dCcpLmh0bWwoZ2xvYmFsVHJhbnNsYXRlLmV4X1NlbGVjdE51bWJlcik7XG5cdFx0fVxuXG5cdFx0JCgnI2FjdGlvbnMtcGxhY2UnKS5hcHBlbmQoJGFjdGlvblRlbXBsYXRlKTtcblx0XHRpdnJNZW51LmFkZE5ld0Zvcm1SdWxlcyhpdnJNZW51LmFjdGlvbnNSb3dzQ291bnQpO1xuXHR9LFxuXHRyZWJ1aWxkQWN0aW9uRXh0ZW5zaW9uc0Ryb3Bkb3duKCkge1xuXHRcdCQoJyNpdnItbWVudS1mb3JtIC5mb3J3YXJkaW5nLXNlbGVjdCcpLmRyb3Bkb3duKEV4dGVuc2lvbnMuZ2V0RHJvcGRvd25TZXR0aW5nc0ZvclJvdXRpbmcoaXZyTWVudS5jYk9uRXh0ZW5zaW9uU2VsZWN0KSk7XG5cdFx0JCgnLmRlbGV0ZS1hY3Rpb24tcm93Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGNvbnN0IGlkID0gJCh0aGlzKS5hdHRyKCdkYXRhLXZhbHVlJyk7XG5cdFx0XHRkZWxldGUgaXZyTWVudS52YWxpZGF0ZVJ1bGVzW2BkaWdpdHMtJHtpZH1gXTtcblx0XHRcdGRlbGV0ZSBpdnJNZW51LnZhbGlkYXRlUnVsZXNbYGV4dGVuc2lvbi0ke2lkfWBdO1xuXHRcdFx0JChgI3Jvdy0ke2lkfWApLnJlbW92ZSgpO1xuXHRcdFx0aXZyTWVudS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0aXZyTWVudS4kZGlycnR5RmllbGQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0fSk7XG5cdH0sXG5cdGNiQmVmb3JlU2VuZEZvcm0oc2V0dGluZ3MpIHtcblx0XHRsZXQgcmVzdWx0ID0gc2V0dGluZ3M7XG5cblx0XHRyZXN1bHQuZGF0YSA9IGl2ck1lbnUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuXHRcdGNvbnN0IGFyckFjdGlvbnMgPSBbXTtcblxuXHRcdCQoJy5hY3Rpb24tcm93JykuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuXHRcdFx0Y29uc3Qgcm93SWQgPSAkKG9iaikuYXR0cignZGF0YS12YWx1ZScpO1xuXHRcdFx0aWYgKHJvd0lkID4gMCkge1xuXHRcdFx0XHRhcnJBY3Rpb25zLnB1c2goe1xuXHRcdFx0XHRcdGRpZ2l0czogaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCBgZGlnaXRzLSR7cm93SWR9YCksXG5cdFx0XHRcdFx0ZXh0ZW5zaW9uOiBpdnJNZW51LiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsIGBleHRlbnNpb24tJHtyb3dJZH1gKSxcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0aWYgKGFyckFjdGlvbnMubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRyZXN1bHQgPSBmYWxzZTtcblx0XHRcdGl2ck1lbnUuJGVycm9yTWVzc2FnZXMuaHRtbChnbG9iYWxUcmFuc2xhdGUuaXZfVmFsaWRhdGVOb0lWUkV4dGVuc2lvbnMpO1xuXHRcdFx0aXZyTWVudS4kZm9ybU9iai5hZGRDbGFzcygnZXJyb3InKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmVzdWx0LmRhdGEuYWN0aW9ucyA9IEpTT04uc3RyaW5naWZ5KGFyckFjdGlvbnMpO1xuXHRcdH1cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHQvKipcblx0ICog0KHRgNCw0LHQsNGC0YvQstCw0LXRgiDQv9GA0Lgg0LLRi9Cx0L7RgNC1INC90L7QvNC10YDQsCDQuNC3INCy0YvQv9Cw0LTQsNGO0YnQtdCz0L4g0YHQv9C40YHQutCwXG5cdCAqL1xuXHRjYk9uRXh0ZW5zaW9uU2VsZWN0KCkge1xuXHRcdGl2ck1lbnUuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRpdnJNZW51LiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0fSxcblx0Y2JBZnRlclNlbmRGb3JtKCkge1xuXG5cdH0sXG5cdGluaXRpYWxpemVGb3JtKCkge1xuXHRcdEZvcm0uJGZvcm1PYmogPSBpdnJNZW51LiRmb3JtT2JqO1xuXHRcdEZvcm0udXJsID0gYCR7Z2xvYmFsUm9vdFVybH1pdnItbWVudS9zYXZlYDtcblx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBpdnJNZW51LnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gaXZyTWVudS5jYkJlZm9yZVNlbmRGb3JtO1xuXHRcdEZvcm0uY2JBZnRlclNlbmRGb3JtID0gaXZyTWVudS5jYkFmdGVyU2VuZEZvcm07XG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG4kLmZuLmZvcm0uc2V0dGluZ3MucnVsZXMuY2hlY2tEb3VibGVzRGlnaXRzID0gKHZhbHVlKSA9PiB7XG5cdGxldCBjb3VudCA9IDA7XG5cdCQoXCJpbnB1dFtpZF49J2RpZ2l0cyddXCIpLmVhY2goKGluZGV4LCBvYmopID0+IHtcblx0XHRpZiAoaXZyTWVudS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCBgJHtvYmouaWR9YCkgPT09IHZhbHVlKSBjb3VudCArPSAxO1xuXHR9KTtcblxuXHRyZXR1cm4gKGNvdW50ID09PSAxKTtcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0aXZyTWVudS5pbml0aWFsaXplKCk7XG59KTtcblxuIl19