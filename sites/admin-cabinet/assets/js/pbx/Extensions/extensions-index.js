"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2020 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, ClipboardJS, SemanticLocalization, InputMaskPatterns, UserMessage, globalTranslate */
var extensionsIndex = {
  maskList: null,
  $extensionsList: $('#extensions-table'),
  $contentFrame: $('#content-frame'),
  initialize: function initialize() {
    $('.avatar').each(function () {
      if ($(this).attr('src') === '') {
        $(this).attr('src', "".concat(globalRootUrl, "assets/img/unknownPerson.jpg"));
      }
    });
    extensionsIndex.initializeInputmask($('input.mobile-number-input'));
    extensionsIndex.$extensionsList.DataTable({
      lengthChange: false,
      paging: false,
      columns: [{
        orderable: false,
        searchable: false
      }, null, null, null, null, {
        orderable: false,
        searchable: false
      }],
      order: [1, 'asc'],
      language: SemanticLocalization.dataTableLocalisation,
      drawCallback: function drawCallback() {}
    });
    $('#add-new-button').appendTo($('div.eight.column:eq(0)'));
    $('.extension-row td').on('dblclick', function (e) {
      var id = $(e.target).closest('tr').attr('id');
      window.location = "".concat(globalRootUrl, "extensions/modify/").concat(id);
    });
    var clipboard = new ClipboardJS('.clipboard');
    $('.clipboard').popup({
      on: 'manual'
    });
    clipboard.on('success', function (e) {
      $(e.trigger).popup('show');
      setTimeout(function () {
        $(e.trigger).popup('hide');
      }, 1500);
      e.clearSelection();
    });
    clipboard.on('error', function (e) {
      console.error('Action:', e.action);
      console.error('Trigger:', e.trigger);
    });
    $('.extension-row .checkbox').checkbox({
      onChecked: function onChecked() {
        var number = $(this).attr('data-value');
        $.api({
          url: "".concat(globalRootUrl, "extensions/enable/").concat(number),
          on: 'now',
          onSuccess: function onSuccess(response) {
            if (response.success) {
              $("#".concat(number, " .disability")).removeClass('disabled');
            }
          }
        });
      },
      onUnchecked: function onUnchecked() {
        var number = $(this).attr('data-value');
        $.api({
          url: "".concat(globalRootUrl, "extensions/disable/").concat(number),
          on: 'now',
          onSuccess: function onSuccess(response) {
            if (response.success) {
              $("#".concat(number, " .disability")).addClass('disabled');
            }
          }
        });
      }
    });
    $('body').on('click', 'a.delete', function (e) {
      e.preventDefault();
      var extensionId = $(e.target).closest('tr').attr('id');
      extensionsIndex.deleteExtension(extensionId);
    });
  },

  /**
   * Deletes extension with id
   * @param extensionId
   */
  deleteExtension: function deleteExtension(extensionId) {
    $('.message.ajax').remove();
    $.api({
      url: "".concat(globalRootUrl, "extensions/delete/").concat(extensionId),
      on: 'now',
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0;
      },
      onSuccess: function onSuccess(response) {
        if (response.success === true) {
          extensionsIndex.$extensionsList.find("tr[id=".concat(extensionId, "]")).remove();
          Extensions.cbOnDataChanged();
        } else {
          UserMessage.showError(response.message.error, globalTranslate.ex_ImpossibleToDeleteExtension);
        }
      }
    });
  },

  /**
   * Makes formatted numbers visualisation
   */
  initializeInputmask: function initializeInputmask($el) {
    if (extensionsIndex.maskList === null) {
      // Prepares the table for sort
      extensionsIndex.maskList = $.masksSort(InputMaskPatterns, ['#'], /[0-9]|#/, 'mask');
    }

    $el.inputmasks({
      inputmask: {
        definitions: {
          '#': {
            validator: '[0-9]',
            cardinality: 1
          }
        }
      },
      match: /[0-9]/,
      replace: '9',
      list: extensionsIndex.maskList,
      listKey: 'mask'
    });
  }
};
$(document).ready(function () {
  extensionsIndex.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9FeHRlbnNpb25zL2V4dGVuc2lvbnMtaW5kZXguanMiXSwibmFtZXMiOlsiZXh0ZW5zaW9uc0luZGV4IiwibWFza0xpc3QiLCIkZXh0ZW5zaW9uc0xpc3QiLCIkIiwiJGNvbnRlbnRGcmFtZSIsImluaXRpYWxpemUiLCJlYWNoIiwiYXR0ciIsImdsb2JhbFJvb3RVcmwiLCJpbml0aWFsaXplSW5wdXRtYXNrIiwiRGF0YVRhYmxlIiwibGVuZ3RoQ2hhbmdlIiwicGFnaW5nIiwiY29sdW1ucyIsIm9yZGVyYWJsZSIsInNlYXJjaGFibGUiLCJvcmRlciIsImxhbmd1YWdlIiwiU2VtYW50aWNMb2NhbGl6YXRpb24iLCJkYXRhVGFibGVMb2NhbGlzYXRpb24iLCJkcmF3Q2FsbGJhY2siLCJhcHBlbmRUbyIsIm9uIiwiZSIsImlkIiwidGFyZ2V0IiwiY2xvc2VzdCIsIndpbmRvdyIsImxvY2F0aW9uIiwiY2xpcGJvYXJkIiwiQ2xpcGJvYXJkSlMiLCJwb3B1cCIsInRyaWdnZXIiLCJzZXRUaW1lb3V0IiwiY2xlYXJTZWxlY3Rpb24iLCJjb25zb2xlIiwiZXJyb3IiLCJhY3Rpb24iLCJjaGVja2JveCIsIm9uQ2hlY2tlZCIsIm51bWJlciIsImFwaSIsInVybCIsIm9uU3VjY2VzcyIsInJlc3BvbnNlIiwic3VjY2VzcyIsInJlbW92ZUNsYXNzIiwib25VbmNoZWNrZWQiLCJhZGRDbGFzcyIsInByZXZlbnREZWZhdWx0IiwiZXh0ZW5zaW9uSWQiLCJkZWxldGVFeHRlbnNpb24iLCJyZW1vdmUiLCJzdWNjZXNzVGVzdCIsInVuZGVmaW5lZCIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJmaW5kIiwiRXh0ZW5zaW9ucyIsImNiT25EYXRhQ2hhbmdlZCIsIlVzZXJNZXNzYWdlIiwic2hvd0Vycm9yIiwibWVzc2FnZSIsImdsb2JhbFRyYW5zbGF0ZSIsImV4X0ltcG9zc2libGVUb0RlbGV0ZUV4dGVuc2lvbiIsIiRlbCIsIm1hc2tzU29ydCIsIklucHV0TWFza1BhdHRlcm5zIiwiaW5wdXRtYXNrcyIsImlucHV0bWFzayIsImRlZmluaXRpb25zIiwidmFsaWRhdG9yIiwiY2FyZGluYWxpdHkiLCJtYXRjaCIsInJlcGxhY2UiLCJsaXN0IiwibGlzdEtleSIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBLElBQU1BLGVBQWUsR0FBRztBQUN2QkMsRUFBQUEsUUFBUSxFQUFFLElBRGE7QUFFdkJDLEVBQUFBLGVBQWUsRUFBRUMsQ0FBQyxDQUFDLG1CQUFELENBRks7QUFHdkJDLEVBQUFBLGFBQWEsRUFBRUQsQ0FBQyxDQUFDLGdCQUFELENBSE87QUFJdkJFLEVBQUFBLFVBSnVCLHdCQUlWO0FBQ1pGLElBQUFBLENBQUMsQ0FBQyxTQUFELENBQUQsQ0FBYUcsSUFBYixDQUFrQixZQUFZO0FBQzdCLFVBQUlILENBQUMsQ0FBQyxJQUFELENBQUQsQ0FBUUksSUFBUixDQUFhLEtBQWIsTUFBd0IsRUFBNUIsRUFBZ0M7QUFDL0JKLFFBQUFBLENBQUMsQ0FBQyxJQUFELENBQUQsQ0FBUUksSUFBUixDQUFhLEtBQWIsWUFBdUJDLGFBQXZCO0FBQ0E7QUFDRCxLQUpEO0FBS0FSLElBQUFBLGVBQWUsQ0FBQ1MsbUJBQWhCLENBQW9DTixDQUFDLENBQUMsMkJBQUQsQ0FBckM7QUFDQUgsSUFBQUEsZUFBZSxDQUFDRSxlQUFoQixDQUFnQ1EsU0FBaEMsQ0FBMEM7QUFDekNDLE1BQUFBLFlBQVksRUFBRSxLQUQyQjtBQUV6Q0MsTUFBQUEsTUFBTSxFQUFFLEtBRmlDO0FBR3pDQyxNQUFBQSxPQUFPLEVBQUUsQ0FDUjtBQUFDQyxRQUFBQSxTQUFTLEVBQUUsS0FBWjtBQUFtQkMsUUFBQUEsVUFBVSxFQUFFO0FBQS9CLE9BRFEsRUFFUixJQUZRLEVBR1IsSUFIUSxFQUlSLElBSlEsRUFLUixJ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WCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IChDKSAyMDE3LTIwMjAgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsIENsaXBib2FyZEpTLCBTZW1hbnRpY0xvY2FsaXphdGlvbiwgSW5wdXRNYXNrUGF0dGVybnMsIFVzZXJNZXNzYWdlLCBnbG9iYWxUcmFuc2xhdGUgKi9cblxuY29uc3QgZXh0ZW5zaW9uc0luZGV4ID0ge1xuXHRtYXNrTGlzdDogbnVsbCxcblx0JGV4dGVuc2lvbnNMaXN0OiAkKCcjZXh0ZW5zaW9ucy10YWJsZScpLFxuXHQkY29udGVudEZyYW1lOiAkKCcjY29udGVudC1mcmFtZScpLFxuXHRpbml0aWFsaXplKCkge1xuXHRcdCQoJy5hdmF0YXInKS5lYWNoKGZ1bmN0aW9uICgpIHtcblx0XHRcdGlmICgkKHRoaXMpLmF0dHIoJ3NyYycpID09PSAnJykge1xuXHRcdFx0XHQkKHRoaXMpLmF0dHIoJ3NyYycsIGAke2dsb2JhbFJvb3RVcmx9YXNzZXRzL2ltZy91bmtub3duUGVyc29uLmpwZ2ApO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdGV4dGVuc2lvbnNJbmRleC5pbml0aWFsaXplSW5wdXRtYXNrKCQoJ2lucHV0Lm1vYmlsZS1udW1iZXItaW5wdXQnKSk7XG5cdFx0ZXh0ZW5zaW9uc0luZGV4LiRleHRlbnNpb25zTGlzdC5EYXRhVGFibGUoe1xuXHRcdFx0bGVuZ3RoQ2hhbmdlOiBmYWxzZSxcblx0XHRcdHBhZ2luZzogZmFsc2UsXG5cdFx0XHRjb2x1bW5zOiBbXG5cdFx0XHRcdHtvcmRlcmFibGU6IGZhbHNlLCBzZWFyY2hhYmxlOiBmYWxzZX0sXG5cdFx0XHRcdG51bGwsXG5cdFx0XHRcdG51bGwsXG5cdFx0XHRcdG51bGwsXG5cdFx0XHRcdG51bGwsXG5cdFx0XHRcdHsgb3JkZXJhYmxlOiBmYWxzZSwgc2VhcmNoYWJsZTogZmFsc2UgfSxcblx0XHRcdF0sXG5cdFx0XHRvcmRlcjogWzEsICdhc2MnXSxcblx0XHRcdGxhbmd1YWdlOiBTZW1hbnRpY0xvY2FsaXphdGlvbi5kYXRhVGFibGVMb2NhbGlzYXRpb24sXG5cdFx0XHRkcmF3Q2FsbGJhY2soKSB7XG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0JCgnI2FkZC1uZXctYnV0dG9uJykuYXBwZW5kVG8oJCgnZGl2LmVpZ2h0LmNvbHVtbjplcSgwKScpKTtcblxuXHRcdCQoJy5leHRlbnNpb24tcm93IHRkJykub24oJ2RibGNsaWNrJywgKGUpID0+IHtcblx0XHRcdGNvbnN0IGlkID0gJChlLnRhcmdldCkuY2xvc2VzdCgndHInKS5hdHRyKCdpZCcpO1xuXHRcdFx0d2luZG93LmxvY2F0aW9uID0gYCR7Z2xvYmFsUm9vdFVybH1leHRlbnNpb25zL21vZGlmeS8ke2lkfWA7XG5cdFx0fSk7XG5cdFx0Y29uc3QgY2xpcGJvYXJkID0gbmV3IENsaXBib2FyZEpTKCcuY2xpcGJvYXJkJyk7XG5cdFx0JCgnLmNsaXBib2FyZCcpLnBvcHVwKHtcblx0XHRcdG9uOiAnbWFudWFsJyxcblx0XHR9KTtcblx0XHRjbGlwYm9hcmQub24oJ3N1Y2Nlc3MnLCAoZSkgPT4ge1xuXHRcdFx0JChlLnRyaWdnZXIpLnBvcHVwKCdzaG93Jyk7XG5cdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0JChlLnRyaWdnZXIpLnBvcHVwKCdoaWRlJyk7XG5cdFx0XHR9LCAxNTAwKTtcblx0XHRcdGUuY2xlYXJTZWxlY3Rpb24oKTtcblx0XHR9KTtcblxuXHRcdGNsaXBib2FyZC5vbignZXJyb3InLCAoZSkgPT4ge1xuXHRcdFx0Y29uc29sZS5lcnJvcignQWN0aW9uOicsIGUuYWN0aW9uKTtcblx0XHRcdGNvbnNvbGUuZXJyb3IoJ1RyaWdnZXI6JywgZS50cmlnZ2VyKTtcblx0XHR9KTtcblx0XHQkKCcuZXh0ZW5zaW9uLXJvdyAuY2hlY2tib3gnKVxuXHRcdFx0LmNoZWNrYm94KHtcblx0XHRcdFx0b25DaGVja2VkKCkge1xuXHRcdFx0XHRcdGNvbnN0IG51bWJlciA9ICQodGhpcykuYXR0cignZGF0YS12YWx1ZScpO1xuXHRcdFx0XHRcdCQuYXBpKHtcblx0XHRcdFx0XHRcdHVybDogYCR7Z2xvYmFsUm9vdFVybH1leHRlbnNpb25zL2VuYWJsZS8ke251bWJlcn1gLFxuXHRcdFx0XHRcdFx0b246ICdub3cnLFxuXHRcdFx0XHRcdFx0b25TdWNjZXNzKHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG5cdFx0XHRcdFx0XHRcdFx0JChgIyR7bnVtYmVyfSAuZGlzYWJpbGl0eWApLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRvblVuY2hlY2tlZCgpIHtcblx0XHRcdFx0XHRjb25zdCBudW1iZXIgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtdmFsdWUnKTtcblx0XHRcdFx0XHQkLmFwaSh7XG5cdFx0XHRcdFx0XHR1cmw6IGAke2dsb2JhbFJvb3RVcmx9ZXh0ZW5zaW9ucy9kaXNhYmxlLyR7bnVtYmVyfWAsXG5cdFx0XHRcdFx0XHRvbjogJ25vdycsXG5cdFx0XHRcdFx0XHRvblN1Y2Nlc3MocmVzcG9uc2UpIHtcblx0XHRcdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN1Y2Nlc3MpIHtcblx0XHRcdFx0XHRcdFx0XHQkKGAjJHtudW1iZXJ9IC5kaXNhYmlsaXR5YCkuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0sXG5cdFx0XHR9KTtcblxuXHRcdCQoJ2JvZHknKS5vbignY2xpY2snLCAnYS5kZWxldGUnLCAoZSkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0Y29uc3QgZXh0ZW5zaW9uSWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLmF0dHIoJ2lkJyk7XG5cdFx0XHRleHRlbnNpb25zSW5kZXguZGVsZXRlRXh0ZW5zaW9uKGV4dGVuc2lvbklkKTtcblx0XHR9KTtcblx0fSxcblx0LyoqXG5cdCAqIERlbGV0ZXMgZXh0ZW5zaW9uIHdpdGggaWRcblx0ICogQHBhcmFtIGV4dGVuc2lvbklkXG5cdCAqL1xuXHRkZWxldGVFeHRlbnNpb24oZXh0ZW5zaW9uSWQpXG5cdHtcblx0XHQkKCcubWVzc2FnZS5hamF4JykucmVtb3ZlKCk7XG5cdFx0JC5hcGkoe1xuXHRcdFx0dXJsOiBgJHtnbG9iYWxSb290VXJsfWV4dGVuc2lvbnMvZGVsZXRlLyR7ZXh0ZW5zaW9uSWR9YCxcblx0XHRcdG9uOiAnbm93Jyxcblx0XHRcdHN1Y2Nlc3NUZXN0KHJlc3BvbnNlKSB7XG5cdFx0XHRcdC8vIHRlc3Qgd2hldGhlciBhIEpTT04gcmVzcG9uc2UgaXMgdmFsaWRcblx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlICE9PSB1bmRlZmluZWRcblx0XHRcdFx0XHQmJiBPYmplY3Qua2V5cyhyZXNwb25zZSkubGVuZ3RoID4gMDtcblx0XHRcdH0sXG5cdFx0XHRvblN1Y2Nlc3MocmVzcG9uc2UpIHtcblx0XHRcdFx0aWYgKHJlc3BvbnNlLnN1Y2Nlc3MgPT09IHRydWUpIHtcblx0XHRcdFx0XHRleHRlbnNpb25zSW5kZXguJGV4dGVuc2lvbnNMaXN0LmZpbmQoYHRyW2lkPSR7ZXh0ZW5zaW9uSWR9XWApLnJlbW92ZSgpO1xuXHRcdFx0XHRcdEV4dGVuc2lvbnMuY2JPbkRhdGFDaGFuZ2VkKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0VXNlck1lc3NhZ2Uuc2hvd0Vycm9yKHJlc3BvbnNlLm1lc3NhZ2UuZXJyb3IsIGdsb2JhbFRyYW5zbGF0ZS5leF9JbXBvc3NpYmxlVG9EZWxldGVFeHRlbnNpb24gKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHR9KTtcblx0fSxcblx0LyoqXG5cdCAqIE1ha2VzIGZvcm1hdHRlZCBudW1iZXJzIHZpc3VhbGlzYXRpb25cblx0ICovXG5cdGluaXRpYWxpemVJbnB1dG1hc2soJGVsKSB7XG5cdFx0aWYgKGV4dGVuc2lvbnNJbmRleC5tYXNrTGlzdCA9PT0gbnVsbCkge1xuXHRcdFx0Ly8gUHJlcGFyZXMgdGhlIHRhYmxlIGZvciBzb3J0XG4gXHRcdFx0ZXh0ZW5zaW9uc0luZGV4Lm1hc2tMaXN0ID0gJC5tYXNrc1NvcnQoSW5wdXRNYXNrUGF0dGVybnMsIFsnIyddLCAvWzAtOV18Iy8sICdtYXNrJyk7XG5cdFx0fVxuXHRcdCRlbC5pbnB1dG1hc2tzKHtcblx0XHRcdGlucHV0bWFzazoge1xuXHRcdFx0XHRkZWZpbml0aW9uczoge1xuXHRcdFx0XHRcdCcjJzoge1xuXHRcdFx0XHRcdFx0dmFsaWRhdG9yOiAnWzAtOV0nLFxuXHRcdFx0XHRcdFx0Y2FyZGluYWxpdHk6IDEsXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0fSxcblx0XHRcdH0sXG5cdFx0XHRtYXRjaDogL1swLTldLyxcblx0XHRcdHJlcGxhY2U6ICc5Jyxcblx0XHRcdGxpc3Q6IGV4dGVuc2lvbnNJbmRleC5tYXNrTGlzdCxcblx0XHRcdGxpc3RLZXk6ICdtYXNrJyxcblx0XHR9KTtcblx0fSxcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0ZXh0ZW5zaW9uc0luZGV4LmluaXRpYWxpemUoKTtcbn0pO1xuXG4iXX0=