"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2021 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, Form, extension  */
var avatar = {
  $picture: $('#avatar'),
  initialize: function initialize() {
    if (avatar.$picture.attr('src') === '') {
      avatar.$picture.attr('src', "".concat(globalRootUrl, "assets/img/unknownPerson.jpg"));
    }

    $('#upload-new-avatar').on('click', function () {
      $('#file-select').click();
    });
    $('#clear-avatar').on('click', function () {
      avatar.$picture.attr('src', "".concat(globalRootUrl, "assets/img/unknownPerson.jpg"));
      extension.$formObj.form('set value', 'user_avatar', null);
      extension.$sip_secret.trigger('change');
    });
    $('#file-select').on('change', function (e) {
      var image;
      e.preventDefault();
      var dataTransfer = 'dataTransfer' in e ? e.dataTransfer.files : [];
      var images = 'files' in e.target ? e.target.files : dataTransfer;

      if (images && images.length) {
        Array.from(images).forEach(function (curImage) {
          if (_typeof(curImage) !== 'object') return;
          image = new Image();
          image.src = avatar.createObjectURL(curImage);

          image.onload = function (event) {
            var args = {
              src: event.target,
              width: 200,
              height: 200,
              type: 'image/png',
              compress: 90
            };
            var mybase64resized = avatar.resizeCrop(args);
            avatar.$picture.attr('src', mybase64resized);
            extension.$formObj.form('set value', 'user_avatar', mybase64resized);
            extension.$sip_secret.trigger('change');
          };
        });
      }
    });
  },
  resizeCrop: function resizeCrop(_ref) {
    var src = _ref.src,
        width = _ref.width,
        height = _ref.height,
        type = _ref.type,
        compress = _ref.compress;
    var newWidth = width;
    var newHeight = height;
    var crop = newWidth === 0 || newHeight === 0; // not resize

    if (src.width <= newWidth && newHeight === 0) {
      newWidth = src.width;
      newHeight = src.height;
    } // resize


    if (src.width > newWidth && newHeight === 0) {
      newHeight = src.height * (newWidth / src.width);
    } // check scale


    var xscale = newWidth / src.width;
    var yscale = newHeight / src.height;
    var scale = crop ? Math.min(xscale, yscale) : Math.max(xscale, yscale); // create empty canvas

    var canvas = document.createElement('canvas');
    canvas.width = newWidth || Math.round(src.width * scale);
    canvas.height = newHeight || Math.round(src.height * scale);
    canvas.getContext('2d').scale(scale, scale); // crop it top center

    canvas.getContext('2d').drawImage(src, (src.width * scale - canvas.width) * -0.5, (src.height * scale - canvas.height) * -0.5);
    return canvas.toDataURL(type, compress);
  },
  createObjectURL: function createObjectURL(i) {
    var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;
    return URL.createObjectURL(i);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9FeHRlbnNpb25zL2V4dGVuc2lvbi1tb2RpZnktYXZhdGFyLmpzIl0sIm5hbWVzIjpbImF2YXRhciIsIiRwaWN0dXJlIiwiJCIsImluaXRpYWxpemUiLCJhdHRyIiwiZ2xvYmFsUm9vdFVybCIsIm9uIiwiY2xpY2siLCJleHRlbnNpb24iLCIkZm9ybU9iaiIsImZvcm0iLCIkc2lwX3NlY3JldCIsInRyaWdnZXIiLCJlIiwiaW1hZ2UiLCJwcmV2ZW50RGVmYXVsdCIsImRhdGFUcmFuc2ZlciIsImZpbGVzIiwiaW1hZ2VzIiwidGFyZ2V0IiwibGVuZ3RoIiwiQXJyYXkiLCJmcm9tIiwiZm9yRWFjaCIsImN1ckltYWdlIiwiSW1hZ2UiLCJzcmMiLCJjcmVhdGVPYmplY3RVUkwiLCJvbmxvYWQiLCJldmVudCIsImFyZ3MiLCJ3aWR0aCIsImhlaWdodCIsInR5cGUiLCJjb21wcmVzcyIsIm15YmFzZTY0cmVzaXplZCIsInJlc2l6ZUNyb3AiLCJuZXdXaWR0aCIsIm5ld0hlaWdodCIsImNyb3AiLCJ4c2NhbGUiLCJ5c2NhbGUiLCJzY2FsZSIsIk1hdGgiLCJtaW4iLCJtYXgiLCJjYW52YXMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJyb3VuZCIsImdldENvbnRleHQiLCJkcmF3SW1hZ2UiLCJ0b0RhdGFVUkwiLCJpIiwiVVJMIiwid2luZG93Iiwid2Via2l0VVJMIiwibW96VVJMIiwibXNVUkwiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBRUEsSUFBTUEsTUFBTSxHQUFHO0FBQ2RDLEVBQUFBLFFBQVEsRUFBRUMsQ0FBQyxDQUFDLFNBQUQsQ0FERztBQUVkQyxFQUFBQSxVQUZjLHdCQUVEO0FBQ1osUUFBSUgsTUFBTSxDQUFDQyxRQUFQLENBQWdCRyxJQUFoQixDQUFxQixLQUFyQixN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QUosR0FBYVUsS0FBeEIsQ0FBN0I7QUFDQUksSUFBQUEsTUFBTSxDQUFDSSxVQUFQLENBQWtCLElBQWxCLEVBQXdCUixLQUF4QixDQUE4QkEsS0FBOUIsRUFBcUNBLEtBQXJDLEVBckJPLENBc0JQOztBQUNBSSxJQUFBQSxNQUFNLENBQUNJLFVBQVAsQ0FBa0IsSUFBbEIsRUFBd0JDLFNBQXhCLENBQWtDekIsR0FBbEMsRUFBdUMsQ0FBRUEsR0FBRyxDQUFDSyxLQUFKLEdBQVlXLEtBQWIsR0FBc0JJLE1BQU0sQ0FBQ2YsS0FBOUIsSUFBdUMsQ0FBQyxHQUEvRSxFQUFvRixDQUFFTCxHQUFHLENBQUNNLE1BQUosR0FBYVUsS0FBZCxHQUF1QkksTUFBTSxDQUFDZCxNQUEvQixJQUF5QyxDQUFDLEdBQTlIO0FBQ0EsV0FBT2MsTUFBTSxDQUFDTSxTQUFQLENBQWlCbkIsSUFBakIsRUFBdUJDLFFBQXZCLENBQVA7QUFDQSxHQXRFYTtBQXVFZFAsRUFBQUEsZUF2RWMsMkJBdUVFMEIsQ0F2RUYsRUF1RUs7QUFDbEIsUUFBTUMsR0FBRyxHQUFHQyxNQUFNLENBQUNELEdBQVAsSUFBY0MsTUFBTSxDQUFDQyxTQUFyQixJQUFrQ0QsTUFBTSxDQUFDRSxNQUF6QyxJQUFtREYsTUFBTSxDQUFDRyxLQUF0RTtBQUNBLFdBQU9KLEdBQUcsQ0FBQzNCLGVBQUosQ0FBb0IwQixDQUFwQixDQUFQO0FBQ0E7QUExRWEsQ0FBZiIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgKEMpIDIwMTctMjAyMSBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgRm9ybSwgZXh0ZW5zaW9uICAqL1xuXG5jb25zdCBhdmF0YXIgPSB7XG5cdCRwaWN0dXJlOiAkKCcjYXZhdGFyJyksXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0aWYgKGF2YXRhci4kcGljdHVyZS5hdHRyKCdzcmMnKSA9PT0gJycpIHtcblx0XHRcdGF2YXRhci4kcGljdHVyZS5hdHRyKCdzcmMnLCBgJHtnbG9iYWxSb290VXJsfWFzc2V0cy9pbWcvdW5rbm93blBlcnNvbi5qcGdgKTtcblx0XHR9XG5cdFx0JCgnI3VwbG9hZC1uZXctYXZhdGFyJykub24oJ2NsaWNrJywgKCkgPT4ge1xuXHRcdFx0JCgnI2ZpbGUtc2VsZWN0JykuY2xpY2soKTtcblx0XHR9KTtcblxuXHRcdCQoJyNjbGVhci1hdmF0YXInKS5vbignY2xpY2snLCAoKSA9PiB7XG5cdFx0XHRhdmF0YXIuJHBpY3R1cmUuYXR0cignc3JjJywgYCR7Z2xvYmFsUm9vdFVybH1hc3NldHMvaW1nL3Vua25vd25QZXJzb24uanBnYCk7XG5cdFx0XHRleHRlbnNpb24uJGZvcm1PYmouZm9ybSgnc2V0IHZhbHVlJywgJ3VzZXJfYXZhdGFyJywgbnVsbCk7XG5cdFx0XHRleHRlbnNpb24uJHNpcF9zZWNyZXQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0fSk7XG5cblx0XHQkKCcjZmlsZS1zZWxlY3QnKS5vbignY2hhbmdlJywgKGUpID0+IHtcblx0XHRcdGxldCBpbWFnZTtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGNvbnN0IGRhdGFUcmFuc2ZlciA9ICdkYXRhVHJhbnNmZXInIGluIGUgPyBlLmRhdGFUcmFuc2Zlci5maWxlcyA6IFtdO1xuXHRcdFx0Y29uc3QgaW1hZ2VzID0gJ2ZpbGVzJyBpbiBlLnRhcmdldCA/IGUudGFyZ2V0LmZpbGVzIDogZGF0YVRyYW5zZmVyO1xuXHRcdFx0aWYgKGltYWdlcyAmJiBpbWFnZXMubGVuZ3RoKSB7XG5cdFx0XHRcdEFycmF5LmZyb20oaW1hZ2VzKS5mb3JFYWNoKChjdXJJbWFnZSkgPT4ge1xuXHRcdFx0XHRcdGlmICh0eXBlb2YgY3VySW1hZ2UgIT09ICdvYmplY3QnKSByZXR1cm47XG5cdFx0XHRcdFx0aW1hZ2UgPSBuZXcgSW1hZ2UoKTtcblx0XHRcdFx0XHRpbWFnZS5zcmMgPSBhdmF0YXIuY3JlYXRlT2JqZWN0VVJMKGN1ckltYWdlKTtcblx0XHRcdFx0XHRpbWFnZS5vbmxvYWQgPSAoZXZlbnQpID0+IHtcblx0XHRcdFx0XHRcdGNvbnN0IGFyZ3MgPSB7XG5cdFx0XHRcdFx0XHRcdHNyYzogZXZlbnQudGFyZ2V0LFxuXHRcdFx0XHRcdFx0XHR3aWR0aDogMjAwLFxuXHRcdFx0XHRcdFx0XHRoZWlnaHQ6IDIwMCxcblx0XHRcdFx0XHRcdFx0dHlwZTogJ2ltYWdlL3BuZycsXG5cdFx0XHRcdFx0XHRcdGNvbXByZXNzOiA5MCxcblx0XHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0XHRjb25zdCBteWJhc2U2NHJlc2l6ZWQgPSBhdmF0YXIucmVzaXplQ3JvcChhcmdzKTtcblx0XHRcdFx0XHRcdGF2YXRhci4kcGljdHVyZS5hdHRyKCdzcmMnLCBteWJhc2U2NHJlc2l6ZWQpO1xuXHRcdFx0XHRcdFx0ZXh0ZW5zaW9uLiRmb3JtT2JqLmZvcm0oJ3NldCB2YWx1ZScsICd1c2VyX2F2YXRhcicsIG15YmFzZTY0cmVzaXplZCk7XG5cdFx0XHRcdFx0XHRleHRlbnNpb24uJHNpcF9zZWNyZXQudHJpZ2dlcignY2hhbmdlJyk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0sXG5cdHJlc2l6ZUNyb3Aoe1xuXHRcdFx0XHQgICBzcmMsIHdpZHRoLCBoZWlnaHQsIHR5cGUsIGNvbXByZXNzLFxuXHRcdFx0ICAgfSkge1xuXHRcdGxldCBuZXdXaWR0aCA9IHdpZHRoO1xuXHRcdGxldCBuZXdIZWlnaHQgPSBoZWlnaHQ7XG5cdFx0Y29uc3QgY3JvcCA9IG5ld1dpZHRoID09PSAwIHx8IG5ld0hlaWdodCA9PT0gMDtcblx0XHQvLyBub3QgcmVzaXplXG5cdFx0aWYgKHNyYy53aWR0aCA8PSBuZXdXaWR0aCAmJiBuZXdIZWlnaHQgPT09IDApIHtcblx0XHRcdG5ld1dpZHRoID0gc3JjLndpZHRoO1xuXHRcdFx0bmV3SGVpZ2h0ID0gc3JjLmhlaWdodDtcblx0XHR9XG5cdFx0Ly8gcmVzaXplXG5cdFx0aWYgKHNyYy53aWR0aCA+IG5ld1dpZHRoICYmIG5ld0hlaWdodCA9PT0gMCkge1xuXHRcdFx0bmV3SGVpZ2h0ID0gc3JjLmhlaWdodCAqIChuZXdXaWR0aCAvIHNyYy53aWR0aCk7XG5cdFx0fVxuXHRcdC8vIGNoZWNrIHNjYWxlXG5cdFx0Y29uc3QgeHNjYWxlID0gbmV3V2lkdGggLyBzcmMud2lkdGg7XG5cdFx0Y29uc3QgeXNjYWxlID0gbmV3SGVpZ2h0IC8gc3JjLmhlaWdodDtcblx0XHRjb25zdCBzY2FsZSA9IGNyb3AgPyBNYXRoLm1pbih4c2NhbGUsIHlzY2FsZSkgOiBNYXRoLm1heCh4c2NhbGUsIHlzY2FsZSk7XG5cdFx0Ly8gY3JlYXRlIGVtcHR5IGNhbnZhc1xuXHRcdGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuXHRcdGNhbnZhcy53aWR0aCA9IG5ld1dpZHRoIHx8IE1hdGgucm91bmQoc3JjLndpZHRoICogc2NhbGUpO1xuXHRcdGNhbnZhcy5oZWlnaHQgPSBuZXdIZWlnaHQgfHwgTWF0aC5yb3VuZChzcmMuaGVpZ2h0ICogc2NhbGUpO1xuXHRcdGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLnNjYWxlKHNjYWxlLCBzY2FsZSk7XG5cdFx0Ly8gY3JvcCBpdCB0b3AgY2VudGVyXG5cdFx0Y2FudmFzLmdldENvbnRleHQoJzJkJykuZHJhd0ltYWdlKHNyYywgKChzcmMud2lkdGggKiBzY2FsZSkgLSBjYW52YXMud2lkdGgpICogLTAuNSwgKChzcmMuaGVpZ2h0ICogc2NhbGUpIC0gY2FudmFzLmhlaWdodCkgKiAtMC41KTtcblx0XHRyZXR1cm4gY2FudmFzLnRvRGF0YVVSTCh0eXBlLCBjb21wcmVzcyk7XG5cdH0sXG5cdGNyZWF0ZU9iamVjdFVSTChpKSB7XG5cdFx0Y29uc3QgVVJMID0gd2luZG93LlVSTCB8fCB3aW5kb3cud2Via2l0VVJMIHx8IHdpbmRvdy5tb3pVUkwgfHwgd2luZG93Lm1zVVJMO1xuXHRcdHJldHVybiBVUkwuY3JlYXRlT2JqZWN0VVJMKGkpO1xuXHR9LFxuXG59OyJdfQ==