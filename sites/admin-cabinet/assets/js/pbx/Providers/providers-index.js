"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2020 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, PbxApi, DebuggerInfo, SemanticLocalization, sessionStorage */
var providers = {
  $deleteModalForm: $('#delete-modal-form'),
  $providersTable: $('#providers-table'),
  initialize: function initialize() {
    providers.$deleteModalForm.modal();
    $('.provider-row .checkbox').checkbox({
      onChecked: function onChecked() {
        var uniqid = $(this).closest('tr').attr('id');
        $.api({
          url: "".concat(globalRootUrl, "providers/enable/{type}/{uniqid}"),
          on: 'now',
          urlData: {
            type: $(this).closest('tr').attr('data-value'),
            uniqid: uniqid
          },
          onSuccess: function onSuccess(response) {
            if (response.success) {
              $("#".concat(uniqid, " .disability")).removeClass('disabled');
            }
          }
        });
      },
      onUnchecked: function onUnchecked() {
        var uniqid = $(this).closest('tr').attr('id');
        $.api({
          url: "".concat(globalRootUrl, "providers/disable/{type}/{uniqid}"),
          on: 'now',
          urlData: {
            type: $(this).closest('tr').attr('data-value'),
            uniqid: uniqid
          },
          onSuccess: function onSuccess(response) {
            if (response.success) {
              $("#".concat(uniqid, " .disability")).addClass('disabled');
            }
          }
        });
      }
    });
    $('.provider-row td').on('dblclick', function (e) {
      var id = $(e.target).closest('tr').attr('id');
      var type = $(e.target).closest('tr').attr('data-value');
      window.location = "".concat(globalRootUrl, "providers/modify").concat(type, "/").concat(id);
    });
    $('body').on('click', '.provider-row a.delete', function (e) {
      e.preventDefault();
      var linksExist = $(e.target).closest('tr').attr('data-links');

      if (linksExist === 'true') {
        providers.$deleteModalForm.modal({
          closable: false,
          onDeny: function onDeny() {
            return true;
          },
          onApprove: function onApprove() {
            window.location = $(e.target).closest('a').attr('href');
            return true;
          }
        }).modal('show');
      } else {
        window.location = $(e.target).closest('a').attr('href');
      }
    });
    providers.initializeDataTable();
  },

  /**
   * Initialize data tables on table
   */
  initializeDataTable: function initializeDataTable() {
    providers.$providersTable.DataTable({
      lengthChange: false,
      paging: false,
      columns: [{
        "width": "0"
      }, {
        "width": "0"
      }, null, {
        "width": "0"
      }, null, null, {
        orderable: false,
        searchable: false
      }],
      autoWidth: false,
      order: [1, 'asc'],
      language: SemanticLocalization.dataTableLocalisation
    });
    $('.add-new-button').appendTo($('div.eight.column:eq(0)'));
  }
};
var providersStatusLoopWorker = {
  timeOut: 3000,
  timeOutHandle: '',
  providerStatuses: {},
  initialize: function initialize() {
    // Запустим обновление статуса провайдера
    DebuggerInfo.initialize();
    var previousStatuses = sessionStorage.getItem('ProviderStatuses');

    if (previousStatuses !== null) {
      providersStatusLoopWorker.providerStatuses = JSON.parse(previousStatuses);
    }

    providersStatusLoopWorker.restartWorker();
  },
  restartWorker: function restartWorker() {
    window.clearTimeout(providersStatusLoopWorker.timeoutHandle);
    providersStatusLoopWorker.worker();
  },
  worker: function worker() {
    window.clearTimeout(providersStatusLoopWorker.timeoutHandle);
    PbxApi.GetSipProvidersStatuses(providersStatusLoopWorker.cbRefreshProvidersStatus);
    PbxApi.GetIaxProvidersStatuses(providersStatusLoopWorker.cbRefreshProvidersStatus);
  },

  /**
   * Накопление информации о статусах провайдеров
   */
  cbRefreshProvidersStatus: function cbRefreshProvidersStatus(response) {
    providersStatusLoopWorker.timeoutHandle = window.setTimeout(providersStatusLoopWorker.worker, providersStatusLoopWorker.timeOut);
    if (response.length === 0 || response === false) return;
    $.each(response, function (key, value) {
      if (value.state !== undefined) {
        providersStatusLoopWorker.providerStatuses[value.id] = value.state.toUpperCase();
      }
    });
    sessionStorage.setItem('ProviderStatuses', JSON.stringify(providersStatusLoopWorker.providerStatuses));
    providersStatusLoopWorker.refreshVisualisation();
  },

  /**
   * Обновление информации в таблице провайдеров
   */
  refreshVisualisation: function refreshVisualisation() {
    var htmlTable = '<table class="ui very compact table">';
    $.each(providersStatusLoopWorker.providerStatuses, function (key, value) {
      htmlTable += '<tr>';
      htmlTable += "<td>".concat(key, "</td>");
      htmlTable += "<td>".concat(value, "</td>");
      htmlTable += '</tr>';
    });
    htmlTable += '</table>';
    DebuggerInfo.UpdateContent(htmlTable);
    var green = '<div class="ui green empty circular label" style="width: 1px;height: 1px;"></div>';
    var grey = '<div class="ui grey empty circular label" style="width: 1px;height: 1px;"></div>';
    var yellow = '<div class="ui yellow empty circular label" style="width: 1px;height: 1px;"></div>';
    $('tr.provider-row').each(function (index, obj) {
      var uniqid = $(obj).attr('id');

      if (providersStatusLoopWorker.providerStatuses[uniqid] !== undefined) {
        switch (providersStatusLoopWorker.providerStatuses[uniqid]) {
          case 'REGISTERED':
            $(obj).find('.provider-status').html(green);
            $(obj).find('.failure').text('');
            break;

          case 'OK':
            $(obj).find('.provider-status').html(yellow);
            $(obj).find('.failure').text('');
            break;

          case 'OFF':
            $(obj).find('.provider-status').html(grey);
            $(obj).find('.failure').text('');
            break;

          default:
            $(obj).find('.provider-status').html(grey);
            $(obj).find('.failure').text(providersStatusLoopWorker.providerStatuses[uniqid]);
            break;
        }
      } else {
        $(obj).find('.provider-status').html(grey);
      }
    });
  }
};
$(document).ready(function () {
  providers.initialize();
  providersStatusLoopWorker.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Qcm92aWRlcnMvcHJvdmlkZXJzLWluZGV4LmpzIl0sIm5hbWVzIjpbInByb3ZpZGVycyIsIiRkZWxldGVNb2RhbEZvcm0iLCIkIiwiJHByb3ZpZGVyc1RhYmxlIiwiaW5pdGlhbGl6ZSIsIm1vZGFsIiwiY2hlY2tib3giLCJvbkNoZWNrZWQiLCJ1bmlxaWQiLCJjbG9zZXN0IiwiYXR0ciIsImFwaSIsInVybCIsImdsb2JhbFJvb3RVcmwiLCJvbiIsInVybERhdGEiLCJ0eXBlIiwib25TdWNjZXNzIiwicmVzcG9uc2UiLCJzdWNjZXNzIiwicmVtb3ZlQ2xhc3MiLCJvblVuY2hlY2tlZCIsImFkZENsYXNzIiwiZSIsImlkIiwidGFyZ2V0Iiwid2luZG93IiwibG9jYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsImxpbmtzRXhpc3QiLCJjbG9zYWJsZSIsIm9uRGVueSIsIm9uQXBwcm92ZSIsImluaXRpYWxpemVEYXRhVGFibGUiLCJEYXRhVGFibGUiLCJsZW5ndGhDaGFuZ2UiLCJwYWdpbmciLCJjb2x1bW5zIiwib3JkZXJhYmxlIiwic2VhcmNoYWJsZSIsImF1dG9XaWR0aCIsIm9yZGVyIiwibGFuZ3VhZ2UiLCJTZW1hbnRpY0xvY2FsaXphdGlvbiIsImRhdGFUYWJsZUxvY2FsaXNhdGlvbiIsImFwcGVuZFRvIiwicHJvdmlkZXJzU3RhdHVzTG9vcFdvcmtlciIsInRpbWVPdXQiLCJ0aW1lT3V0SGFuZGxlIiwicHJvdmlkZXJTdGF0dXNlcyIsIkRlYnVnZ2VySW5mbyIsInByZXZpb3VzU3RhdHVzZXMiLCJzZXNzaW9uU3RvcmFnZSIsImdldEl0ZW0iLCJKU09OIiwicGFyc2UiLCJyZXN0YXJ0V29ya2VyIiwiY2xlYXJUaW1lb3V0IiwidGltZW91dEhhbmRsZSIsIndvcmtlciIsIlBieEFwaSIsIkdldFNpcFByb3ZpZGVyc1N0YXR1c2VzIiwiY2JSZWZyZXNoUHJvdmlkZXJzU3RhdHVzIiwiR2V0SWF4UHJvdmlkZXJzU3RhdHVzZXMiLCJzZXRUaW1lb3V0IiwibGVuZ3RoIiwiZWFjaCIsImtleSIsInZhbHVlIiwic3RhdGUiLCJ1bmRlZmluZWQiLCJ0b1VwcGVyQ2FzZSIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJyZWZyZXNoVmlzdWFsaXNhdGlvbiIsImh0bWxUYWJsZSIsIlVwZGF0ZUNvbnRlbnQiLCJncmVlbiIsImdyZXkiLCJ5ZWxsb3ciLCJpbmRleCIsIm9iaiIsImZpbmQiLCJodG1sIiwidGV4dCIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUVBLElBQU1BLFNBQVMsR0FBRztBQUNqQkMsRUFBQUEsZ0JBQWdCLEVBQUVDLENBQUMsQ0FBQyxvQkFBRCxDQURGO0FBRWpCQyxFQUFBQSxlQUFlLEVBQUVELENBQUMsQ0FBQyxrQkFBRCxDQUZEO0FBR2pCRSxFQUFBQSxVQUhpQix3QkFHSjtBQUNaSixJQUFBQSxTQUFTLENBQUNDLGdCQUFWLENBQTJCSSxLQUEzQjtBQUNBSCxJQUFBQSxDQUFDLENBQUMseUJBQUQsQ0FBRCxDQUNFSSxRQURGLENBQ1c7QUFDVEMsTUFBQUEsU0FEUyx1QkFDRztBQUNYLFlBQU1DLE1BQU0sR0FBR04sQ0FBQyxDQUFDLElBQUQsQ0FBRCxDQUFRTyxPQUFSLENBQWdCLElBQWhCLEVBQXNCQyxJQUF0QixDQUEyQixJQUEzQixDQUFmO0FBQ0FSLFFBQUFBLENBQUMsQ0FBQ1MsR0FBRixDQUFNO0FBQ0xDLFVBQUFBLEdBQUcsWUFBS0MsYUFBTCxxQ0FERTtBQUVMQyxVQUFBQSxFQUFFLEVBQUUsS0FGQztBQUdMQyxVQUFBQSxPQUFPLEVBQUU7QUFDUkMsWUFBQUEsSUFBSSxFQUFFZCxDQUFDLENBQUMsSUFBRCxDQUFELENBQVFPLE9BQVIsQ0FBZ0IsSUFBaEIsRUFBc0JDLElBQXRCLENBQTJCLFlBQTNCLENBREU7QUFFUkYsWUFBQUEsTUFBTSxFQUFOQTtBQUZRLFdBSEo7QUFPTFMsVUFBQUEsU0FQSyxxQkFPS0MsUUFQTCxFQU9lO0FBQ25CLGdCQUFJQSxRQUFRLENBQUNDLE9BQWIsRUFBc0I7QUFDckJqQixjQUFBQSxDQUFDLFlBQUtNLE1BQUwsa0JBQUQsQ0FBNEJZLFdBQTVCLENBQXdDLFVBQXhDO0FBQ0E7QUFDRDtBQVhJLFNBQU47QUFjQSxPQWpCUTtBQWtCVEMsTUFBQUEsV0FsQlMseUJBa0JLO0FBQ2IsWUFBTWIsTUFBTSxHQUFHTixDQUFDLENBQUMsSUFBRCxDQUFELENBQVFPLE9BQVIsQ0FBZ0IsSUFBaEIsRUFBc0JDLElBQXRCLENBQTJCLElBQTNCLENBQWY7QUFDQVIsUUFBQUEsQ0FBQyxDQUFDUyxHQUFGLENBQU07QUFDTEMsVUFBQUEsR0FBRyxZQUFLQyxhQUFMLHNDQURFO0FBRUxDLFVBQUFBLEVBQUUsRUFBRSxLQUZDO0FBR0xDLFVBQUFBLE9BQU8sRUFBRTtBQUNSQyxZQUFBQSxJQUFJLEVBQUVkLENBQUMsQ0FBQyxJQUFELENBQUQsQ0FBUU8sT0FBUixDQUFnQixJQUFoQixFQUFzQkMsSUFBdEIsQ0FBMkIsWUFBM0IsQ0FERTtBQUVSRixZQUFBQSxNQUFNLEVBQU5BO0FBRlEsV0FISjtBQU9MUyxVQUFBQSxTQVBLLHFCQU9LQyxRQVBMLEVBT2U7QUFDbkIsZ0JBQUlBLFFBQVEsQ0FBQ0MsT0FBYixFQUFzQjtBQUNyQmpCLGNBQUFBLENBQUMsWUFBS00sTUFBTCxrQkFBRCxDQUE0QmMsUUFBNUIsQ0FBcUMsVUFBckM7QUFDQTtBQUNEO0FBWEksU0FBTjtBQWNBO0FBbENRLEtBRFg7QUFzQ0FwQixJQUFBQSxDQUFDLENBQUMsa0JBQUQsQ0FBRCxDQUFzQlksRUFBdEIsQ0FBeUIsVUFBekIsRUFBcUMsVUFBQ1MsQ0FBRCxFQUFPO0FBQzNDLFVBQU1DLEVBQUUsR0FBR3RCLENBQUMsQ0FBQ3FCLENBQUMsQ0FBQ0UsTUFBSCxDQUFELENBQVloQixPQUFaLENBQW9CLElBQXBCLEVBQTBCQyxJQUExQixDQUErQixJQUEvQixDQUFYO0FBQ0EsVUFBTU0sSUFBSSxHQUFHZCxDQUFDLENBQUNxQixDQUFDLENBQUNFLE1BQUgsQ0FBRCxDQUFZaEIsT0FBWixDQUFvQixJQUFwQixFQUEwQkMsSUFBMUIsQ0FBK0IsWUFBL0IsQ0FBYjtBQUNBZ0IsTUFBQUEsTUFBTSxDQUFDQyxRQUFQLGFBQXFCZCxhQUFyQiw2QkFBcURHLElBQXJELGNBQTZEUSxFQUE3RDtBQUNBLEtBSkQ7QUFNQXRCLElBQUFBLENBQUMsQ0FBQyxNQUFELENBQUQsQ0FBVVksRUFBVixDQUFhLE9BQWIsRUFBc0Isd0JBQXRCLEVBQWdELFVBQUNTLENBQUQsRUFBTztBQUN0REEsTUFBQUEsQ0FBQyxDQUFDSyxjQUFGO0FBQ0EsVUFBTUMsVUFBVSxHQUFHM0IsQ0FBQyxDQUFDcUIsQ0FBQyxDQUFDRSxNQUFILENBQUQsQ0FBWWhCLE9BQVosQ0FBb0IsSUFBcEIsRUFBMEJDLElBQTFCLENBQStCLFlBQS9CLENBQW5COztBQUNBLFVBQUltQixVQUFVLEtBQUssTUFBbkIsRUFBMkI7QUFDMUI3QixRQUFBQSxTQUFTLENBQUNDLGdCQUFWLENBQ0VJLEtBREYsQ0FDUTtBQUNOeUIsVUFBQUEsUUFBUSxFQUFFLEtBREo7QUFFTkMsVUFBQUEsTUFBTSxFQUFFO0FBQUEsbUJBQU0sSUFBTjtBQUFBLFdBRkY7QUFHTkMsVUFBQUEsU0FBUyxFQUFFLHFCQUFNO0FBQ2hCTixZQUFBQSxNQUFNLENBQUNDLFFBQVAsR0FBa0J6QixDQUFDLENBQUNxQixDQUFDLENBQUNFLE1BQUgsQ0FBRCxDQUFZaEIsT0FBWixDQUFvQixHQUFwQixFQUF5QkMsSUFBekIsQ0FBOEIsTUFBOUIsQ0FBbEI7QUFDQSxtQkFBTyxJQUFQO0FBQ0E7QUFOSyxTQURSLEVBU0VMLEtBVEYsQ0FTUSxNQVRSO0FBVUEsT0FYRCxNQVdPO0FBQ05xQixRQUFBQSxNQUFNLENBQUNDLFFBQVAsR0FBa0J6QixDQUFDLENBQUNxQixDQUFDLENBQUNFLE1BQUgsQ0FBRCxDQUFZaEIsT0FBWixDQUFvQixHQUFwQixFQUF5QkMsSUFBekIsQ0FBOEIsTUFBOUIsQ0FBbEI7QUFDQTtBQUNELEtBakJEO0FBa0JBVixJQUFBQSxTQUFTLENBQUNpQyxtQkFBVjtBQUNBLEdBcEVnQjs7QUFxRWpCO0FBQ0Q7QUFDQTtBQUNDQSxFQUFBQSxtQkF4RWlCLGlDQXdFSztBQUNyQmpDLElBQUFBLFNBQVMsQ0FBQ0csZUFBVixDQUEwQitCLFNBQTFCLENBQW9DO0FBQ25DQyxNQUFBQSxZQUFZLEVBQUUsS0FEcUI7QUFFbkNDLE1BQUFBLE1BQU0sRUFBRSxLQUYyQjtBQUduQ0MsTUFBQUEsT0FBTyxFQUFFLENBQ1I7QUFBRSxpQkFBUztBQUFYLE9BRFEsRUFFUjtBQUFFLGlCQUFTO0FBQVgsT0FGUSxFQUdSLElBSFEsRUFJUjtBQUFFLGlCQUFTO0FBQVgsT0FKUSxFQUtSLElBTFEsRUFNUixJQU5RLEVBT1I7QUFBQ0MsUUFBQUEsU0FBUyxFQUFFLEtBQVo7QUFBbUJDLFFBQUFBLFVBQVUsRUFBRTtBQUEvQixPQVBRLENBSDBCO0FBWW5DQyxNQUFBQSxTQUFTLEVBQUUsS0Fad0I7QUFhbkNDLE1BQUFBLEtBQUssRUFBRSxDQUFDLENBQUQsRUFBSSxLQUFKLENBYjRCO0FBY25DQyxNQUFBQSxRQUFRLEVBQUVDLG9CQUFvQixDQUFDQztBQWRJLEtBQXBDO0FBZ0JBMUMsSUFBQUEsQ0FBQyxDQUFDLGlCQUFELENBQUQsQ0FBcUIyQyxRQUFyQixDQUE4QjNDLENBQUMsQ0FBQyx3QkFBRCxDQUEvQjtBQUNBO0FBMUZnQixDQUFsQjtBQTRGQSxJQUFNNEMseUJBQXlCLEdBQUc7QUFDakNDLEVBQUFBLE9BQU8sRUFBRSxJQUR3QjtBQUVqQ0MsRUFBQUEsYUFBYSxFQUFFLEVBRmtCO0FBR2pDQyxFQUFBQSxnQkFBZ0IsRUFBRSxFQUhlO0FBSWpDN0MsRUFBQUEsVUFKaUMsd0JBSXBCO0FBQ1o7QUFDQThDLElBQUFBLFlBQVksQ0FBQzlDLFVBQWI7QUFDQSxRQUFNK0MsZ0JBQWdCLEdBQUdDLGNBQWMsQ0FBQ0MsT0FBZixDQUF1QixrQkFBdkIsQ0FBekI7O0FBQ0EsUUFBSUYsZ0JBQWdCLEtBQUssSUFBekIsRUFBK0I7QUFDOUJMLE1BQUFBLHlCQUF5QixDQUFDRyxnQkFBMUIsR0FBNkNLLElBQUksQ0FBQ0MsS0FBTCxDQUFXSixnQkFBWCxDQUE3QztBQUNBOztBQUNETCxJQUFBQSx5QkFBeUIsQ0FBQ1UsYUFBMUI7QUFDQSxHQVpnQztBQWFqQ0EsRUFBQUEsYUFiaUMsMkJBYWpCO0FBQ2Y5QixJQUFBQSxNQUFNLENBQUMrQixZQUFQLENBQW9CWCx5QkFBeUIsQ0FBQ1ksYUFBOUM7QUFDQVosSUFBQUEseUJBQXlCLENBQUNhLE1BQTFCO0FBQ0EsR0FoQmdDO0FBaUJqQ0EsRUFBQUEsTUFqQmlDLG9CQWlCeEI7QUFDUmpDLElBQUFBLE1BQU0sQ0FBQytCLFlBQVAsQ0FBb0JYLHlCQUF5QixDQUFDWSxhQUE5QztBQUNBRSxJQUFBQSxNQUFNLENBQUNDLHVCQUFQLENBQStCZix5QkFBeUIsQ0FBQ2dCLHdCQUF6RDtBQUNBRixJQUFBQSxNQUFNLENBQUNHLHVCQUFQLENBQStCakIseUJBQXlCLENBQUNnQix3QkFBekQ7QUFDQSxHQXJCZ0M7O0FBc0JqQztBQUNEO0FBQ0E7QUFDQ0EsRUFBQUEsd0JBekJpQyxvQ0F5QlI1QyxRQXpCUSxFQXlCRTtBQUNsQzRCLElBQUFBLHlCQUF5QixDQUFDWSxhQUExQixHQUNDaEMsTUFBTSxDQUFDc0MsVUFBUCxDQUFrQmxCLHlCQUF5QixDQUFDYSxNQUE1QyxFQUFvRGIseUJBQXlCLENBQUNDLE9BQTlFLENBREQ7QUFFQSxRQUFJN0IsUUFBUSxDQUFDK0MsTUFBVCxLQUFvQixDQUFwQixJQUF5Qi9DLFFBQVEsS0FBSyxLQUExQyxFQUFpRDtBQUNqRGhCLElBQUFBLENBQUMsQ0FBQ2dFLElBQUYsQ0FBT2hELFFBQVAsRUFBaUIsVUFBQ2lELEdBQUQsRUFBTUMsS0FBTixFQUFnQjtBQUNoQyxVQUFJQSxLQUFLLENBQUNDLEtBQU4sS0FBZ0JDLFNBQXBCLEVBQStCO0FBQzlCeEIsUUFBQUEseUJBQXlCLENBQUNHLGdCQUExQixDQUEyQ21CLEtBQUssQ0FBQzVDLEVBQWpELElBQXVENEMsS0FBSyxDQUFDQyxLQUFOLENBQVlFLFdBQVosRUFBdkQ7QUFDQTtBQUNELEtBSkQ7QUFLQW5CLElBQUFBLGNBQWMsQ0FBQ29CLE9BQWYsQ0FBdUIsa0JBQXZCLEVBQTJDbEIsSUFBSSxDQUFDbUIsU0FBTCxDQUFlM0IseUJBQXlCLENBQUNHLGdCQUF6QyxDQUEzQztBQUNBSCxJQUFBQSx5QkFBeUIsQ0FBQzRCLG9CQUExQjtBQUNBLEdBcENnQzs7QUFxQ2pDO0FBQ0Q7QUFDQTtBQUNDQSxFQUFBQSxvQkF4Q2lDLGtDQXdDVjtBQUN0QixRQUFJQyxTQUFTLEdBQUcsdUNBQWhCO0FBQ0F6RSxJQUFBQSxDQUFDLENBQUNnRSxJQUFGLENBQU9wQix5QkFBeUIsQ0FBQ0csZ0JBQWpDLEVBQW1ELFVBQUNrQixHQUFELEVBQU1DLEtBQU4sRUFBZ0I7QUFDbEVPLE1BQUFBLFNBQVMsSUFBSSxNQUFiO0FBQ0FBLE1BQUFBLFNBQVMsa0JBQVdSLEdBQVgsVUFBVDtBQUNBUSxNQUFBQSxTQUFTLGtCQUFXUCxLQUFYLFVBQVQ7QUFDQU8sTUFBQUEsU0FBUyxJQUFJLE9BQWI7QUFDQSxLQUxEO0FBTUFBLElBQUFBLFNBQVMsSUFBSSxVQUFiO0FBQ0F6QixJQUFBQSxZQUFZLENBQUMwQixhQUFiLENBQTJCRCxTQUEzQjtBQUNBLFFBQU1FLEtBQUssR0FBRyxtRkFBZDtBQUNBLFFBQU1DLElBQUksR0FBRyxrRkFBYjtBQUNBLFFBQU1DLE1BQU0sR0FBRyxvRkFBZjtBQUNBN0UsSUFBQUEsQ0FBQyxDQUFDLGlCQUFELENBQUQsQ0FBcUJnRSxJQUFyQixDQUEwQixVQUFDYyxLQUFELEVBQVFDLEdBQVIsRUFBZ0I7QUFDekMsVUFBTXpFLE1BQU0sR0FBR04sQ0FBQyxDQUFDK0UsR0FBRCxDQUFELENBQU92RSxJQUFQLENBQVksSUFBWixDQUFmOztBQUNBLFVBQUlvQyx5QkFBeUIsQ0FBQ0csZ0JBQTFCLENBQTJDekMsTUFBM0MsTUFBdUQ4RCxTQUEzRCxFQUFzRTtBQUNyRSxnQkFBUXhCLHlCQUF5QixDQUFDRyxnQkFBMUIsQ0FBMkN6QyxNQUEzQyxDQUFSO0FBQ0MsZUFBSyxZQUFMO0FBQ0NOLFlBQUFBLENBQUMsQ0FBQytFLEdBQUQsQ0FBRCxDQUFPQyxJQUFQLENBQVksa0JBQVosRUFBZ0NDLElBQWhDLENBQXFDTixLQUFyQztBQUNBM0UsWUFBQUEsQ0FBQyxDQUFDK0UsR0FBRCxDQUFELENBQU9DLElBQVAsQ0FBWSxVQUFaLEVBQXdCRSxJQUF4QixDQUE2QixFQUE3QjtBQUNBOztBQUNELGVBQUssSUFBTDtBQUNDbEYsWUFBQUEsQ0FBQyxDQUFDK0UsR0FBRCxDQUFELENBQU9DLElBQVAsQ0FBWSxrQkFBWixFQUFnQ0MsSUFBaEMsQ0FBcUNKLE1BQXJDO0FBQ0E3RSxZQUFBQSxDQUFDLENBQUMrRSxHQUFELENBQUQsQ0FBT0MsSUFBUCxDQUFZLFVBQVosRUFBd0JFLElBQXhCLENBQTZCLEVBQTdCO0FBQ0E7O0FBQ0QsZUFBSyxLQUFMO0FBQ0NsRixZQUFBQSxDQUFDLENBQUMrRSxHQUFELENBQUQsQ0FBT0MsSUFBUCxDQUFZLGtCQUFaLEVBQWdDQyxJQUFoQyxDQUFxQ0wsSUFBckM7QUFDQTVFLFlBQUFBLENBQUMsQ0FBQytFLEdBQUQsQ0FBRCxDQUFPQyxJQUFQLENBQVksVUFBWixFQUF3QkUsSUFBeEIsQ0FBNkIsRUFBN0I7QUFDQTs7QUFDRDtBQUNDbEYsWUFBQUEsQ0FBQyxDQUFDK0UsR0FBRCxDQUFELENBQU9DLElBQVAsQ0FBWSxrQkFBWixFQUFnQ0MsSUFBaEMsQ0FBcUNMLElBQXJDO0FBQ0E1RSxZQUFBQSxDQUFDLENBQUMrRSxHQUFELENBQUQsQ0FBT0MsSUFBUCxDQUFZLFVBQVosRUFBd0JFLElBQXhCLENBQTZCdEMseUJBQXlCLENBQUNHLGdCQUExQixDQUEyQ3pDLE1BQTNDLENBQTdCO0FBQ0E7QUFoQkY7QUFrQkEsT0FuQkQsTUFtQk87QUFDTk4sUUFBQUEsQ0FBQyxDQUFDK0UsR0FBRCxDQUFELENBQU9DLElBQVAsQ0FBWSxrQkFBWixFQUFnQ0MsSUFBaEMsQ0FBcUNMLElBQXJDO0FBQ0E7QUFDRCxLQXhCRDtBQXlCQTtBQTlFZ0MsQ0FBbEM7QUFpRkE1RSxDQUFDLENBQUNtRixRQUFELENBQUQsQ0FBWUMsS0FBWixDQUFrQixZQUFNO0FBQ3ZCdEYsRUFBQUEsU0FBUyxDQUFDSSxVQUFWO0FBQ0EwQyxFQUFBQSx5QkFBeUIsQ0FBQzFDLFVBQTFCO0FBQ0EsQ0FIRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgKEMpIDIwMTctMjAyMCBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgZ2xvYmFsUm9vdFVybCwgUGJ4QXBpLCBEZWJ1Z2dlckluZm8sIFNlbWFudGljTG9jYWxpemF0aW9uLCBzZXNzaW9uU3RvcmFnZSAqL1xuXG5jb25zdCBwcm92aWRlcnMgPSB7XG5cdCRkZWxldGVNb2RhbEZvcm06ICQoJyNkZWxldGUtbW9kYWwtZm9ybScpLFxuXHQkcHJvdmlkZXJzVGFibGU6ICQoJyNwcm92aWRlcnMtdGFibGUnKSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHRwcm92aWRlcnMuJGRlbGV0ZU1vZGFsRm9ybS5tb2RhbCgpO1xuXHRcdCQoJy5wcm92aWRlci1yb3cgLmNoZWNrYm94Jylcblx0XHRcdC5jaGVja2JveCh7XG5cdFx0XHRcdG9uQ2hlY2tlZCgpIHtcblx0XHRcdFx0XHRjb25zdCB1bmlxaWQgPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuYXR0cignaWQnKTtcblx0XHRcdFx0XHQkLmFwaSh7XG5cdFx0XHRcdFx0XHR1cmw6IGAke2dsb2JhbFJvb3RVcmx9cHJvdmlkZXJzL2VuYWJsZS97dHlwZX0ve3VuaXFpZH1gLFxuXHRcdFx0XHRcdFx0b246ICdub3cnLFxuXHRcdFx0XHRcdFx0dXJsRGF0YToge1xuXHRcdFx0XHRcdFx0XHR0eXBlOiAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuYXR0cignZGF0YS12YWx1ZScpLFxuXHRcdFx0XHRcdFx0XHR1bmlxaWQsXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0b25TdWNjZXNzKHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG5cdFx0XHRcdFx0XHRcdFx0JChgIyR7dW5pcWlkfSAuZGlzYWJpbGl0eWApLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9LFxuXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdG9uVW5jaGVja2VkKCkge1xuXHRcdFx0XHRcdGNvbnN0IHVuaXFpZCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5hdHRyKCdpZCcpO1xuXHRcdFx0XHRcdCQuYXBpKHtcblx0XHRcdFx0XHRcdHVybDogYCR7Z2xvYmFsUm9vdFVybH1wcm92aWRlcnMvZGlzYWJsZS97dHlwZX0ve3VuaXFpZH1gLFxuXHRcdFx0XHRcdFx0b246ICdub3cnLFxuXHRcdFx0XHRcdFx0dXJsRGF0YToge1xuXHRcdFx0XHRcdFx0XHR0eXBlOiAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuYXR0cignZGF0YS12YWx1ZScpLFxuXHRcdFx0XHRcdFx0XHR1bmlxaWQsXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0b25TdWNjZXNzKHJlc3BvbnNlKSB7XG5cdFx0XHRcdFx0XHRcdGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG5cdFx0XHRcdFx0XHRcdFx0JChgIyR7dW5pcWlkfSAuZGlzYWJpbGl0eWApLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9LFxuXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0sXG5cdFx0XHR9KTtcblxuXHRcdCQoJy5wcm92aWRlci1yb3cgdGQnKS5vbignZGJsY2xpY2snLCAoZSkgPT4ge1xuXHRcdFx0Y29uc3QgaWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLmF0dHIoJ2lkJyk7XG5cdFx0XHRjb25zdCB0eXBlID0gJChlLnRhcmdldCkuY2xvc2VzdCgndHInKS5hdHRyKCdkYXRhLXZhbHVlJyk7XG5cdFx0XHR3aW5kb3cubG9jYXRpb24gPSBgJHtnbG9iYWxSb290VXJsfXByb3ZpZGVycy9tb2RpZnkke3R5cGV9LyR7aWR9YDtcblx0XHR9KTtcblxuXHRcdCQoJ2JvZHknKS5vbignY2xpY2snLCAnLnByb3ZpZGVyLXJvdyBhLmRlbGV0ZScsIChlKSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRjb25zdCBsaW5rc0V4aXN0ID0gJChlLnRhcmdldCkuY2xvc2VzdCgndHInKS5hdHRyKCdkYXRhLWxpbmtzJyk7XG5cdFx0XHRpZiAobGlua3NFeGlzdCA9PT0gJ3RydWUnKSB7XG5cdFx0XHRcdHByb3ZpZGVycy4kZGVsZXRlTW9kYWxGb3JtXG5cdFx0XHRcdFx0Lm1vZGFsKHtcblx0XHRcdFx0XHRcdGNsb3NhYmxlOiBmYWxzZSxcblx0XHRcdFx0XHRcdG9uRGVueTogKCkgPT4gdHJ1ZSxcblx0XHRcdFx0XHRcdG9uQXBwcm92ZTogKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHR3aW5kb3cubG9jYXRpb24gPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCdhJykuYXR0cignaHJlZicpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQubW9kYWwoJ3Nob3cnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHdpbmRvdy5sb2NhdGlvbiA9ICQoZS50YXJnZXQpLmNsb3Nlc3QoJ2EnKS5hdHRyKCdocmVmJyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0cHJvdmlkZXJzLmluaXRpYWxpemVEYXRhVGFibGUoKTtcblx0fSxcblx0LyoqXG5cdCAqIEluaXRpYWxpemUgZGF0YSB0YWJsZXMgb24gdGFibGVcblx0ICovXG5cdGluaXRpYWxpemVEYXRhVGFibGUoKSB7XG5cdFx0cHJvdmlkZXJzLiRwcm92aWRlcnNUYWJsZS5EYXRhVGFibGUoe1xuXHRcdFx0bGVuZ3RoQ2hhbmdlOiBmYWxzZSxcblx0XHRcdHBhZ2luZzogZmFsc2UsXG5cdFx0XHRjb2x1bW5zOiBbXG5cdFx0XHRcdHsgXCJ3aWR0aFwiOiBcIjBcIn0sXG5cdFx0XHRcdHsgXCJ3aWR0aFwiOiBcIjBcIn0sXG5cdFx0XHRcdG51bGwsXG5cdFx0XHRcdHsgXCJ3aWR0aFwiOiBcIjBcIn0sXG5cdFx0XHRcdG51bGwsXG5cdFx0XHRcdG51bGwsXG5cdFx0XHRcdHtvcmRlcmFibGU6IGZhbHNlLCBzZWFyY2hhYmxlOiBmYWxzZX0sXG5cdFx0XHRdLFxuXHRcdFx0YXV0b1dpZHRoOiBmYWxzZSxcblx0XHRcdG9yZGVyOiBbMSwgJ2FzYyddLFxuXHRcdFx0bGFuZ3VhZ2U6IFNlbWFudGljTG9jYWxpemF0aW9uLmRhdGFUYWJsZUxvY2FsaXNhdGlvbixcblx0XHR9KTtcblx0XHQkKCcuYWRkLW5ldy1idXR0b24nKS5hcHBlbmRUbygkKCdkaXYuZWlnaHQuY29sdW1uOmVxKDApJykpO1xuXHR9LFxufTtcbmNvbnN0IHByb3ZpZGVyc1N0YXR1c0xvb3BXb3JrZXIgPSB7XG5cdHRpbWVPdXQ6IDMwMDAsXG5cdHRpbWVPdXRIYW5kbGU6ICcnLFxuXHRwcm92aWRlclN0YXR1c2VzOiB7fSxcblx0aW5pdGlhbGl6ZSgpIHtcblx0XHQvLyDQl9Cw0L/Rg9GB0YLQuNC8INC+0LHQvdC+0LLQu9C10L3QuNC1INGB0YLQsNGC0YPRgdCwINC/0YDQvtCy0LDQudC00LXRgNCwXG5cdFx0RGVidWdnZXJJbmZvLmluaXRpYWxpemUoKTtcblx0XHRjb25zdCBwcmV2aW91c1N0YXR1c2VzID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnUHJvdmlkZXJTdGF0dXNlcycpO1xuXHRcdGlmIChwcmV2aW91c1N0YXR1c2VzICE9PSBudWxsKSB7XG5cdFx0XHRwcm92aWRlcnNTdGF0dXNMb29wV29ya2VyLnByb3ZpZGVyU3RhdHVzZXMgPSBKU09OLnBhcnNlKHByZXZpb3VzU3RhdHVzZXMpO1xuXHRcdH1cblx0XHRwcm92aWRlcnNTdGF0dXNMb29wV29ya2VyLnJlc3RhcnRXb3JrZXIoKTtcblx0fSxcblx0cmVzdGFydFdvcmtlcigpIHtcblx0XHR3aW5kb3cuY2xlYXJUaW1lb3V0KHByb3ZpZGVyc1N0YXR1c0xvb3BXb3JrZXIudGltZW91dEhhbmRsZSk7XG5cdFx0cHJvdmlkZXJzU3RhdHVzTG9vcFdvcmtlci53b3JrZXIoKTtcblx0fSxcblx0d29ya2VyKCkge1xuXHRcdHdpbmRvdy5jbGVhclRpbWVvdXQocHJvdmlkZXJzU3RhdHVzTG9vcFdvcmtlci50aW1lb3V0SGFuZGxlKTtcblx0XHRQYnhBcGkuR2V0U2lwUHJvdmlkZXJzU3RhdHVzZXMocHJvdmlkZXJzU3RhdHVzTG9vcFdvcmtlci5jYlJlZnJlc2hQcm92aWRlcnNTdGF0dXMpO1xuXHRcdFBieEFwaS5HZXRJYXhQcm92aWRlcnNTdGF0dXNlcyhwcm92aWRlcnNTdGF0dXNMb29wV29ya2VyLmNiUmVmcmVzaFByb3ZpZGVyc1N0YXR1cyk7XG5cdH0sXG5cdC8qKlxuXHQgKiDQndCw0LrQvtC/0LvQtdC90LjQtSDQuNC90YTQvtGA0LzQsNGG0LjQuCDQviDRgdGC0LDRgtGD0YHQsNGFINC/0YDQvtCy0LDQudC00LXRgNC+0LJcblx0ICovXG5cdGNiUmVmcmVzaFByb3ZpZGVyc1N0YXR1cyhyZXNwb25zZSkge1xuXHRcdHByb3ZpZGVyc1N0YXR1c0xvb3BXb3JrZXIudGltZW91dEhhbmRsZSA9XG5cdFx0XHR3aW5kb3cuc2V0VGltZW91dChwcm92aWRlcnNTdGF0dXNMb29wV29ya2VyLndvcmtlciwgcHJvdmlkZXJzU3RhdHVzTG9vcFdvcmtlci50aW1lT3V0KTtcblx0XHRpZiAocmVzcG9uc2UubGVuZ3RoID09PSAwIHx8IHJlc3BvbnNlID09PSBmYWxzZSkgcmV0dXJuO1xuXHRcdCQuZWFjaChyZXNwb25zZSwgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdGlmICh2YWx1ZS5zdGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdHByb3ZpZGVyc1N0YXR1c0xvb3BXb3JrZXIucHJvdmlkZXJTdGF0dXNlc1t2YWx1ZS5pZF0gPSB2YWx1ZS5zdGF0ZS50b1VwcGVyQ2FzZSgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ1Byb3ZpZGVyU3RhdHVzZXMnLCBKU09OLnN0cmluZ2lmeShwcm92aWRlcnNTdGF0dXNMb29wV29ya2VyLnByb3ZpZGVyU3RhdHVzZXMpKTtcblx0XHRwcm92aWRlcnNTdGF0dXNMb29wV29ya2VyLnJlZnJlc2hWaXN1YWxpc2F0aW9uKCk7XG5cdH0sXG5cdC8qKlxuXHQgKiDQntCx0L3QvtCy0LvQtdC90LjQtSDQuNC90YTQvtGA0LzQsNGG0LjQuCDQsiDRgtCw0LHQu9C40YbQtSDQv9GA0L7QstCw0LnQtNC10YDQvtCyXG5cdCAqL1xuXHRyZWZyZXNoVmlzdWFsaXNhdGlvbigpIHtcblx0XHRsZXQgaHRtbFRhYmxlID0gJzx0YWJsZSBjbGFzcz1cInVpIHZlcnkgY29tcGFjdCB0YWJsZVwiPic7XG5cdFx0JC5lYWNoKHByb3ZpZGVyc1N0YXR1c0xvb3BXb3JrZXIucHJvdmlkZXJTdGF0dXNlcywgKGtleSwgdmFsdWUpID0+IHtcblx0XHRcdGh0bWxUYWJsZSArPSAnPHRyPic7XG5cdFx0XHRodG1sVGFibGUgKz0gYDx0ZD4ke2tleX08L3RkPmA7XG5cdFx0XHRodG1sVGFibGUgKz0gYDx0ZD4ke3ZhbHVlfTwvdGQ+YDtcblx0XHRcdGh0bWxUYWJsZSArPSAnPC90cj4nO1xuXHRcdH0pO1xuXHRcdGh0bWxUYWJsZSArPSAnPC90YWJsZT4nO1xuXHRcdERlYnVnZ2VySW5mby5VcGRhdGVDb250ZW50KGh0bWxUYWJsZSk7XG5cdFx0Y29uc3QgZ3JlZW4gPSAnPGRpdiBjbGFzcz1cInVpIGdyZWVuIGVtcHR5IGNpcmN1bGFyIGxhYmVsXCIgc3R5bGU9XCJ3aWR0aDogMXB4O2hlaWdodDogMXB4O1wiPjwvZGl2Pic7XG5cdFx0Y29uc3QgZ3JleSA9ICc8ZGl2IGNsYXNzPVwidWkgZ3JleSBlbXB0eSBjaXJjdWxhciBsYWJlbFwiIHN0eWxlPVwid2lkdGg6IDFweDtoZWlnaHQ6IDFweDtcIj48L2Rpdj4nO1xuXHRcdGNvbnN0IHllbGxvdyA9ICc8ZGl2IGNsYXNzPVwidWkgeWVsbG93IGVtcHR5IGNpcmN1bGFyIGxhYmVsXCIgc3R5bGU9XCJ3aWR0aDogMXB4O2hlaWdodDogMXB4O1wiPjwvZGl2Pic7XG5cdFx0JCgndHIucHJvdmlkZXItcm93JykuZWFjaCgoaW5kZXgsIG9iaikgPT4ge1xuXHRcdFx0Y29uc3QgdW5pcWlkID0gJChvYmopLmF0dHIoJ2lkJyk7XG5cdFx0XHRpZiAocHJvdmlkZXJzU3RhdHVzTG9vcFdvcmtlci5wcm92aWRlclN0YXR1c2VzW3VuaXFpZF0gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRzd2l0Y2ggKHByb3ZpZGVyc1N0YXR1c0xvb3BXb3JrZXIucHJvdmlkZXJTdGF0dXNlc1t1bmlxaWRdKSB7XG5cdFx0XHRcdFx0Y2FzZSAnUkVHSVNURVJFRCc6XG5cdFx0XHRcdFx0XHQkKG9iaikuZmluZCgnLnByb3ZpZGVyLXN0YXR1cycpLmh0bWwoZ3JlZW4pO1xuXHRcdFx0XHRcdFx0JChvYmopLmZpbmQoJy5mYWlsdXJlJykudGV4dCgnJyk7XG5cdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRjYXNlICdPSyc6XG5cdFx0XHRcdFx0XHQkKG9iaikuZmluZCgnLnByb3ZpZGVyLXN0YXR1cycpLmh0bWwoeWVsbG93KTtcblx0XHRcdFx0XHRcdCQob2JqKS5maW5kKCcuZmFpbHVyZScpLnRleHQoJycpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0Y2FzZSAnT0ZGJzpcblx0XHRcdFx0XHRcdCQob2JqKS5maW5kKCcucHJvdmlkZXItc3RhdHVzJykuaHRtbChncmV5KTtcblx0XHRcdFx0XHRcdCQob2JqKS5maW5kKCcuZmFpbHVyZScpLnRleHQoJycpO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRcdCQob2JqKS5maW5kKCcucHJvdmlkZXItc3RhdHVzJykuaHRtbChncmV5KTtcblx0XHRcdFx0XHRcdCQob2JqKS5maW5kKCcuZmFpbHVyZScpLnRleHQocHJvdmlkZXJzU3RhdHVzTG9vcFdvcmtlci5wcm92aWRlclN0YXR1c2VzW3VuaXFpZF0pO1xuXHRcdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCQob2JqKS5maW5kKCcucHJvdmlkZXItc3RhdHVzJykuaHRtbChncmV5KTtcblx0XHRcdH1cblx0XHR9KTtcblx0fSxcbn07XG5cbiQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcblx0cHJvdmlkZXJzLmluaXRpYWxpemUoKTtcblx0cHJvdmlkZXJzU3RhdHVzTG9vcFdvcmtlci5pbml0aWFsaXplKCk7XG59KTtcbiJdfQ==