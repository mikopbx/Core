"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global ace, PbxApi */

/**
 * Object for managing system diagnostic system information view.
 *
 * @module systemDiagnosticSysyinfo
 */
var systemDiagnosticSysyinfo = {
  viewer: '',
  receivedInfo: false,
  $tabMenuItems: $('#system-diagnostic-menu .item'),
  $dimmer: $('#sysinfo-dimmer'),
  $contentFiled: $('#sysinfo-content-readonly'),

  /**
   * Initializes the system diagnostic system information view.
   */
  initialize: function initialize() {
    var aceHeight = window.innerHeight - 300; // Set the minimum height of the system information container

    systemDiagnosticSysyinfo.$dimmer.closest('div').css('min-height', "".concat(aceHeight, "px")); // Hide the content field initially

    systemDiagnosticSysyinfo.$contentFiled.hide(); // Event listener for tab menu items click

    systemDiagnosticSysyinfo.$tabMenuItems.on('click', function (e) {
      if ($(e.target).attr('data-tab') === 'show-sysinfo' && systemDiagnosticSysyinfo.receivedInfo === false) {
        systemDiagnosticSysyinfo.initializeAce();
        PbxApi.SysInfoGetInfo(systemDiagnosticSysyinfo.cbUpdateSysinfoText);
      }
    });
  },

  /**
   * Initializes the ACE editor for system information content.
   */
  initializeAce: function initializeAce() {
    var aceHeight = window.innerHeight - 300;
    var rowsCount = Math.round(aceHeight / 16.3); // Set the minimum height of the ACE editor

    $(window).load(function () {
      $('.log-content-readonly').css('min-height', "".concat(aceHeight, "px"));
    });

    var IniMode = ace.require('ace/mode/julia').Mode;

    systemDiagnosticSysyinfo.viewer = ace.edit('sysinfo-content-readonly');
    systemDiagnosticSysyinfo.viewer.session.setMode(new IniMode());
    systemDiagnosticSysyinfo.viewer.setTheme('ace/theme/monokai');
    systemDiagnosticSysyinfo.viewer.resize();
    systemDiagnosticSysyinfo.viewer.renderer.setShowGutter(false);
    systemDiagnosticSysyinfo.viewer.setOptions({
      showLineNumbers: false,
      showPrintMargin: false,
      readOnly: true,
      maxLines: rowsCount
    });
  },

  /**
   * Callback for updating the system information view.
   * @param data - The system information data.
   */
  cbUpdateSysinfoText: function cbUpdateSysinfoText(data) {
    systemDiagnosticSysyinfo.$dimmer.removeClass('active');
    systemDiagnosticSysyinfo.viewer.getSession().setValue(data.content);
    systemDiagnosticSysyinfo.receivedInfo = true;
    systemDiagnosticSysyinfo.$contentFiled.show();
  }
}; // When the document is ready, initialize the system information view

$(document).ready(function () {
  systemDiagnosticSysyinfo.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TeXN0ZW1EaWFnbm9zdGljL3N5c3RlbS1kaWFnbm9zdGljLWluZGV4LXN5c2luZm8uanMiXSwibmFtZXMiOlsic3lzdGVtRGlhZ25vc3RpY1N5c3lpbmZvIiwidmlld2VyIiwicmVjZWl2ZWRJbmZvIiwiJHRhYk1lbnVJdGVtcyIsIiQiLCIkZGltbWVyIiwiJGNvbnRlbnRGaWxlZCIsImluaXRpYWxpemUiLCJhY2VIZWlnaHQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsImNsb3Nlc3QiLCJjc3MiLCJoaWRlIiwib24iLCJlIiwidGFyZ2V0IiwiYXR0ciIsImluaXRpYWxpemVBY2UiLCJQYnhBcGkiLCJTeXNJbmZvR2V0SW5mbyIsImNiVXBkYXRlU3lzaW5mb1RleHQiLCJyb3dzQ291bnQiLCJNYXRoIiwicm91bmQiLCJsb2FkIiwiSW5pTW9kZSIsImFjZSIsInJlcXVpcmUiLCJNb2RlIiwiZWRpdCIsInNlc3Npb24iLCJzZXRNb2RlIiwic2V0VGhlbWUiLCJyZXNpemUiLCJyZW5kZXJlciIsInNldFNob3dHdXR0ZXIiLCJzZXRPcHRpb25zIiwic2hvd0xpbmVOdW1iZXJzIiwic2hvd1ByaW50TWFyZ2luIiwicmVhZE9ubHkiLCJtYXhMaW5lcyIsImRhdGEiLCJyZW1vdmVDbGFzcyIsImdldFNlc3Npb24iLCJzZXRWYWx1ZSIsImNvbnRlbnQiLCJzaG93IiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFNQSx3QkFBd0IsR0FBRztBQUM3QkMsRUFBQUEsTUFBTSxFQUFFLEVBRHFCO0FBRTdCQyxFQUFBQSxZQUFZLEVBQUUsS0FGZTtBQUc3QkMsRUFBQUEsYUFBYSxFQUFFQyxDQUFDLENBQUMsK0JBQUQs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Q0UsWUFBekIsR0FBd0MsSUFBeEM7QUFDQUYsSUFBQUEsd0JBQXdCLENBQUNNLGFBQXpCLENBQXVDeUMsSUFBdkM7QUFDSDtBQS9ENEIsQ0FBakMsQyxDQW1FQTs7QUFDQTNDLENBQUMsQ0FBQzRDLFFBQUQsQ0FBRCxDQUFZQyxLQUFaLENBQWtCLFlBQU07QUFDcEJqRCxFQUFBQSx3QkFBd0IsQ0FBQ08sVUFBekI7QUFDSCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCDCqSAyMDE3LTIwMjMgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cbi8qIGdsb2JhbCBhY2UsIFBieEFwaSAqL1xuXG4vKipcbiAqIE9iamVjdCBmb3IgbWFuYWdpbmcgc3lzdGVtIGRpYWdub3N0aWMgc3lzdGVtIGluZm9ybWF0aW9uIHZpZXcuXG4gKlxuICogQG1vZHVsZSBzeXN0ZW1EaWFnbm9zdGljU3lzeWluZm9cbiAqL1xuY29uc3Qgc3lzdGVtRGlhZ25vc3RpY1N5c3lpbmZvID0ge1xuICAgIHZpZXdlcjogJycsXG4gICAgcmVjZWl2ZWRJbmZvOiBmYWxzZSxcbiAgICAkdGFiTWVudUl0ZW1zOiAkKCcjc3lzdGVtLWRpYWdub3N0aWMtbWVudSAuaXRlbScpLFxuICAgICRkaW1tZXI6ICQoJyNzeXNpbmZvLWRpbW1lcicpLFxuICAgICRjb250ZW50RmlsZWQ6ICQoJyNzeXNpbmZvLWNvbnRlbnQtcmVhZG9ubHknKSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIHRoZSBzeXN0ZW0gZGlhZ25vc3RpYyBzeXN0ZW0gaW5mb3JtYXRpb24gdmlldy5cbiAgICAgKi9cbiAgICBpbml0aWFsaXplKCkge1xuICAgICAgICBjb25zdCBhY2VIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSAzMDA7XG5cbiAgICAgICAgLy8gU2V0IHRoZSBtaW5pbXVtIGhlaWdodCBvZiB0aGUgc3lzdGVtIGluZm9ybWF0aW9uIGNvbnRhaW5lclxuICAgICAgICBzeXN0ZW1EaWFnbm9zdGljU3lzeWluZm8uJGRpbW1lci5jbG9zZXN0KCdkaXYnKS5jc3MoJ21pbi1oZWlnaHQnLCBgJHthY2VIZWlnaHR9cHhgKTtcblxuICAgICAgICAvLyBIaWRlIHRoZSBjb250ZW50IGZpZWxkIGluaXRpYWxseVxuICAgICAgICBzeXN0ZW1EaWFnbm9zdGljU3lzeWluZm8uJGNvbnRlbnRGaWxlZC5oaWRlKCk7XG5cbiAgICAgICAgLy8gRXZlbnQgbGlzdGVuZXIgZm9yIHRhYiBtZW51IGl0ZW1zIGNsaWNrXG4gICAgICAgIHN5c3RlbURpYWdub3N0aWNTeXN5aW5mby4kdGFiTWVudUl0ZW1zLm9uKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBpZiAoJChlLnRhcmdldCkuYXR0cignZGF0YS10YWInKSA9PT0gJ3Nob3ctc3lzaW5mbydcbiAgICAgICAgICAgICAgICAmJiBzeXN0ZW1EaWFnbm9zdGljU3lzeWluZm8ucmVjZWl2ZWRJbmZvID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHN5c3RlbURpYWdub3N0aWNTeXN5aW5mby5pbml0aWFsaXplQWNlKCk7XG4gICAgICAgICAgICAgICAgUGJ4QXBpLlN5c0luZm9HZXRJbmZvKHN5c3RlbURpYWdub3N0aWNTeXN5aW5mby5jYlVwZGF0ZVN5c2luZm9UZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIHRoZSBBQ0UgZWRpdG9yIGZvciBzeXN0ZW0gaW5mb3JtYXRpb24gY29udGVudC5cbiAgICAgKi9cbiAgICBpbml0aWFsaXplQWNlKCkge1xuICAgICAgICBjb25zdCBhY2VIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSAzMDA7XG4gICAgICAgIGNvbnN0IHJvd3NDb3VudCA9IE1hdGgucm91bmQoYWNlSGVpZ2h0IC8gMTYuMyk7XG5cbiAgICAgICAgLy8gU2V0IHRoZSBtaW5pbXVtIGhlaWdodCBvZiB0aGUgQUNFIGVkaXRvclxuICAgICAgICAkKHdpbmRvdykubG9hZChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCcubG9nLWNvbnRlbnQtcmVhZG9ubHknKS5jc3MoJ21pbi1oZWlnaHQnLCBgJHthY2VIZWlnaHR9cHhgKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IEluaU1vZGUgPSBhY2UucmVxdWlyZSgnYWNlL21vZGUvanVsaWEnKS5Nb2RlO1xuICAgICAgICBzeXN0ZW1EaWFnbm9zdGljU3lzeWluZm8udmlld2VyID0gYWNlLmVkaXQoJ3N5c2luZm8tY29udGVudC1yZWFkb25seScpO1xuICAgICAgICBzeXN0ZW1EaWFnbm9zdGljU3lzeWluZm8udmlld2VyLnNlc3Npb24uc2V0TW9kZShuZXcgSW5pTW9kZSgpKTtcbiAgICAgICAgc3lzdGVtRGlhZ25vc3RpY1N5c3lpbmZvLnZpZXdlci5zZXRUaGVtZSgnYWNlL3RoZW1lL21vbm9rYWknKTtcbiAgICAgICAgc3lzdGVtRGlhZ25vc3RpY1N5c3lpbmZvLnZpZXdlci5yZXNpemUoKTtcbiAgICAgICAgc3lzdGVtRGlhZ25vc3RpY1N5c3lpbmZvLnZpZXdlci5yZW5kZXJlci5zZXRTaG93R3V0dGVyKGZhbHNlKTtcbiAgICAgICAgc3lzdGVtRGlhZ25vc3RpY1N5c3lpbmZvLnZpZXdlci5zZXRPcHRpb25zKHtcbiAgICAgICAgICAgIHNob3dMaW5lTnVtYmVyczogZmFsc2UsXG4gICAgICAgICAgICBzaG93UHJpbnRNYXJnaW46IGZhbHNlLFxuICAgICAgICAgICAgcmVhZE9ubHk6IHRydWUsXG4gICAgICAgICAgICBtYXhMaW5lczogcm93c0NvdW50LFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZm9yIHVwZGF0aW5nIHRoZSBzeXN0ZW0gaW5mb3JtYXRpb24gdmlldy5cbiAgICAgKiBAcGFyYW0gZGF0YSAtIFRoZSBzeXN0ZW0gaW5mb3JtYXRpb24gZGF0YS5cbiAgICAgKi9cbiAgICBjYlVwZGF0ZVN5c2luZm9UZXh0KGRhdGEpIHtcbiAgICAgICAgc3lzdGVtRGlhZ25vc3RpY1N5c3lpbmZvLiRkaW1tZXIucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICBzeXN0ZW1EaWFnbm9zdGljU3lzeWluZm8udmlld2VyLmdldFNlc3Npb24oKS5zZXRWYWx1ZShkYXRhLmNvbnRlbnQpO1xuICAgICAgICBzeXN0ZW1EaWFnbm9zdGljU3lzeWluZm8ucmVjZWl2ZWRJbmZvID0gdHJ1ZTtcbiAgICAgICAgc3lzdGVtRGlhZ25vc3RpY1N5c3lpbmZvLiRjb250ZW50RmlsZWQuc2hvdygpO1xuICAgIH0sXG5cbn07XG5cbi8vIFdoZW4gdGhlIGRvY3VtZW50IGlzIHJlYWR5LCBpbml0aWFsaXplIHRoZSBzeXN0ZW0gaW5mb3JtYXRpb24gdmlld1xuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIHN5c3RlbURpYWdub3N0aWNTeXN5aW5mby5pbml0aWFsaXplKCk7XG59KTtcblxuIl19