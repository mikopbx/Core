"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global sessionStorage, PbxApi, archivePackingCheckWorker */

/**
 * Represents the system diagnostic capture object.
 */
var systemDiagnosticCapture = {
  /**
   * jQuery element for the start button.
   * @type {jQuery}
   */
  $startBtn: $('#start-capture-button'),

  /**
   * jQuery element for the download button.
   * @type {jQuery}
   */
  $downloadBtn: $('#download-logs-button'),

  /**
   * jQuery element for the stop button.
   * @type {jQuery}
   */
  $stopBtn: $('#stop-capture-button'),

  /**
   * jQuery element for the show button.
   * @type {jQuery}
   */
  $showBtn: $('#show-last-log'),

  /**
   * jQuery element for the dimmer.
   * @type {jQuery}
   */
  $dimmer: $('#capture-log-dimmer'),

  /**
   * Initializes the system diagnostic capture.
   */
  initialize: function initialize() {
    var segmentHeight = window.innerHeight - 300;
    $(window).load(function () {
      systemDiagnosticCapture.$dimmer.closest('div').css('min-height', "".concat(segmentHeight, "px"));
    });

    if (sessionStorage.getItem('PCAPCaptureStatus') === 'started') {
      systemDiagnosticCapture.$startBtn.addClass('disabled loading');
      systemDiagnosticCapture.$stopBtn.removeClass('disabled');
    } else {
      systemDiagnosticCapture.$startBtn.removeClass('disabled loading');
      systemDiagnosticCapture.$stopBtn.addClass('disabled');
    }

    systemDiagnosticCapture.$startBtn.on('click', function (e) {
      e.preventDefault();
      systemDiagnosticCapture.$startBtn.addClass('disabled loading');
      systemDiagnosticCapture.$stopBtn.removeClass('disabled');
      PbxApi.SyslogStartLogsCapture(systemDiagnosticCapture.cbAfterStartCapture);
    });
    systemDiagnosticCapture.$stopBtn.on('click', function (e) {
      e.preventDefault();
      systemDiagnosticCapture.$startBtn.removeClass('loading');
      systemDiagnosticCapture.$stopBtn.addClass('loading');
      systemDiagnosticCapture.$dimmer.addClass('active');
      PbxApi.SyslogStopLogsCapture(systemDiagnosticCapture.cbAfterStopCapture);
    });
    systemDiagnosticCapture.$downloadBtn.on('click', function (e) {
      e.preventDefault();
      systemDiagnosticCapture.$downloadBtn.addClass('disabled loading');
      systemDiagnosticCapture.$dimmer.addClass('active');
      PbxApi.SyslogPrepareLog(systemDiagnosticCapture.cbAfterDownloadCapture);
    });
  },

  /**
   * Callback after pushing the start logs collect button.
   * @param {object} response - The response object.
   */
  cbAfterStartCapture: function cbAfterStartCapture(response) {
    if (response !== false) {
      sessionStorage.setItem('PCAPCaptureStatus', 'started');
      setTimeout(function () {
        sessionStorage.setItem('PCAPCaptureStatus', 'stopped');
      }, 300000);
    }
  },

  /**
   * Callback after pushing the start logs collect button.
   * @param {object} response - The response object.
   */
  cbAfterDownloadCapture: function cbAfterDownloadCapture(response) {
    if (response !== false) {
      archivePackingCheckWorker.initialize(response.filename);
    }
  },

  /**
   * Callback after pushing the stop logs collect button.
   * @param {object} response - The response object.
   */
  cbAfterStopCapture: function cbAfterStopCapture(response) {
    if (response !== false) {
      archivePackingCheckWorker.initialize(response.filename);
    }
  }
}; // When the document is ready, initialize the system diagnostic management console

$(document).ready(function () {
  systemDiagnosticCapture.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TeXN0ZW1EaWFnbm9zdGljL3N5c3RlbS1kaWFnbm9zdGljLWluZGV4LWxvZ2NhcHR1cmUuanMiXSwibmFtZXMiOlsic3lzdGVtRGlhZ25vc3RpY0NhcHR1cmUiLCIkc3RhcnRCdG4iLCIkIiwiJGRvd25sb2FkQnRuIiwiJHN0b3BCdG4iLCIkc2hvd0J0biIsIiRkaW1tZXIiLCJpbml0aWFsaXplIiwic2VnbWVudEhlaWdodCIsIndpbmRvdyIsImlubmVySGVpZ2h0IiwibG9hZCIsImNsb3Nlc3QiLCJjc3MiLCJzZXNzaW9uU3RvcmFnZSIsImdldEl0ZW0iLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwib24iLCJlIiwicHJldmVudERlZmF1bHQiLCJQYnhBcGkiLCJTeXNsb2dTdGFydExvZ3NDYXB0dXJlIiwiY2JBZnRlclN0YXJ0Q2FwdHVyZSIsIlN5c2xvZ1N0b3BMb2dzQ2FwdHVyZSIsImNiQWZ0ZXJTdG9wQ2FwdHVyZSIsIlN5c2xvZ1ByZXBhcmVMb2ciLCJjYkFmdGVyRG93bmxvYWRDYXB0dXJlIiwicmVzcG9uc2UiLCJzZXRJdGVtIiwic2V0VGltZW91dCIsImFyY2hpdmVQYWNraW5nQ2hlY2tXb3JrZXIiLCJmaWxlbmFtZSIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFNQSx1QkFBdUIsR0FBRztBQUM1QjtBQUNKO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxTQUFTLEVBQUVDLENBQUMsQ0FBQyx1QkFBRCxDQUxnQjs7QUFPNUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsWUFBWSxFQUFFRCxDQUFDLENBQUMsdUJBQUQsQ0FYYTs7QUFhNUI7QUFDSjtBQUNBO0FBQ0E7QUFDSUUsRUFBQUEsUUFBUSxFQUFF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QixtQkFBdkIsRUFBNEMsU0FBNUM7QUFDQUMsTUFBQUEsVUFBVSxDQUFDLFlBQU07QUFDYmhCLFFBQUFBLGNBQWMsQ0FBQ2UsT0FBZixDQUF1QixtQkFBdkIsRUFBNEMsU0FBNUM7QUFDSCxPQUZTLEVBRVAsTUFGTyxDQUFWO0FBR0g7QUFDSixHQS9FMkI7O0FBa0Y1QjtBQUNKO0FBQ0E7QUFDQTtBQUNJRixFQUFBQSxzQkF0RjRCLGtDQXNGTEMsUUF0RkssRUFzRks7QUFDN0IsUUFBSUEsUUFBUSxLQUFLLEtBQWpCLEVBQXdCO0FBQ3BCRyxNQUFBQSx5QkFBeUIsQ0FBQ3hCLFVBQTFCLENBQXFDcUIsUUFBUSxDQUFDSSxRQUE5QztBQUNIO0FBQ0osR0ExRjJCOztBQTRGNUI7QUFDSjtBQUNBO0FBQ0E7QUFDSVAsRUFBQUEsa0JBaEc0Qiw4QkFnR1RHLFFBaEdTLEVBZ0dDO0FBQ3pCLFFBQUlBLFFBQVEsS0FBSyxLQUFqQixFQUF3QjtBQUNwQkcsTUFBQUEseUJBQXlCLENBQUN4QixVQUExQixDQUFxQ3FCLFFBQVEsQ0FBQ0ksUUFBOUM7QUFDSDtBQUNKO0FBcEcyQixDQUFoQyxDLENBdUdBOztBQUNBOUIsQ0FBQyxDQUFDK0IsUUFBRCxDQUFELENBQVlDLEtBQVosQ0FBa0IsWUFBTTtBQUNwQmxDLEVBQUFBLHVCQUF1QixDQUFDTyxVQUF4QjtBQUNILENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IMKpIDIwMTctMjAyMyBBbGV4ZXkgUG9ydG5vdiBhbmQgTmlrb2xheSBCZWtldG92XG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnlcbiAqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5XG4gKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAzIG9mIHRoZSBMaWNlbnNlLCBvclxuICogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi5cbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCxcbiAqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mXG4gKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlXG4gKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLlxuICogSWYgbm90LCBzZWUgPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvPi5cbiAqL1xuXG4vKiBnbG9iYWwgc2Vzc2lvblN0b3JhZ2UsIFBieEFwaSwgYXJjaGl2ZVBhY2tpbmdDaGVja1dvcmtlciAqL1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIHN5c3RlbSBkaWFnbm9zdGljIGNhcHR1cmUgb2JqZWN0LlxuICovXG5jb25zdCBzeXN0ZW1EaWFnbm9zdGljQ2FwdHVyZSA9IHtcbiAgICAvKipcbiAgICAgKiBqUXVlcnkgZWxlbWVudCBmb3IgdGhlIHN0YXJ0IGJ1dHRvbi5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICRzdGFydEJ0bjogJCgnI3N0YXJ0LWNhcHR1cmUtYnV0dG9uJyksXG5cbiAgICAvKipcbiAgICAgKiBqUXVlcnkgZWxlbWVudCBmb3IgdGhlIGRvd25sb2FkIGJ1dHRvbi5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICRkb3dubG9hZEJ0bjogJCgnI2Rvd25sb2FkLWxvZ3MtYnV0dG9uJyksXG5cbiAgICAvKipcbiAgICAgKiBqUXVlcnkgZWxlbWVudCBmb3IgdGhlIHN0b3AgYnV0dG9uLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJHN0b3BCdG46ICQoJyNzdG9wLWNhcHR1cmUtYnV0dG9uJyksXG5cbiAgICAvKipcbiAgICAgKiBqUXVlcnkgZWxlbWVudCBmb3IgdGhlIHNob3cgYnV0dG9uLlxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJHNob3dCdG46ICQoJyNzaG93LWxhc3QtbG9nJyksXG5cbiAgICAvKipcbiAgICAgKiBqUXVlcnkgZWxlbWVudCBmb3IgdGhlIGRpbW1lci5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICRkaW1tZXI6ICQoJyNjYXB0dXJlLWxvZy1kaW1tZXInKSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIHRoZSBzeXN0ZW0gZGlhZ25vc3RpYyBjYXB0dXJlLlxuICAgICAqL1xuICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIGNvbnN0IHNlZ21lbnRIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLSAzMDA7XG4gICAgICAgICQod2luZG93KS5sb2FkKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHN5c3RlbURpYWdub3N0aWNDYXB0dXJlLiRkaW1tZXIuY2xvc2VzdCgnZGl2JykuY3NzKCdtaW4taGVpZ2h0JywgYCR7c2VnbWVudEhlaWdodH1weGApO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ1BDQVBDYXB0dXJlU3RhdHVzJykgPT09ICdzdGFydGVkJykge1xuICAgICAgICAgICAgc3lzdGVtRGlhZ25vc3RpY0NhcHR1cmUuJHN0YXJ0QnRuLmFkZENsYXNzKCdkaXNhYmxlZCBsb2FkaW5nJyk7XG4gICAgICAgICAgICBzeXN0ZW1EaWFnbm9zdGljQ2FwdHVyZS4kc3RvcEJ0bi5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN5c3RlbURpYWdub3N0aWNDYXB0dXJlLiRzdGFydEJ0bi5yZW1vdmVDbGFzcygnZGlzYWJsZWQgbG9hZGluZycpO1xuICAgICAgICAgICAgc3lzdGVtRGlhZ25vc3RpY0NhcHR1cmUuJHN0b3BCdG4uYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgc3lzdGVtRGlhZ25vc3RpY0NhcHR1cmUuJHN0YXJ0QnRuLm9uKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBzeXN0ZW1EaWFnbm9zdGljQ2FwdHVyZS4kc3RhcnRCdG4uYWRkQ2xhc3MoJ2Rpc2FibGVkIGxvYWRpbmcnKTtcbiAgICAgICAgICAgIHN5c3RlbURpYWdub3N0aWNDYXB0dXJlLiRzdG9wQnRuLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgUGJ4QXBpLlN5c2xvZ1N0YXJ0TG9nc0NhcHR1cmUoc3lzdGVtRGlhZ25vc3RpY0NhcHR1cmUuY2JBZnRlclN0YXJ0Q2FwdHVyZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBzeXN0ZW1EaWFnbm9zdGljQ2FwdHVyZS4kc3RvcEJ0bi5vbignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgc3lzdGVtRGlhZ25vc3RpY0NhcHR1cmUuJHN0YXJ0QnRuLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgICAgICBzeXN0ZW1EaWFnbm9zdGljQ2FwdHVyZS4kc3RvcEJ0bi5hZGRDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgICAgc3lzdGVtRGlhZ25vc3RpY0NhcHR1cmUuJGRpbW1lci5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICBQYnhBcGkuU3lzbG9nU3RvcExvZ3NDYXB0dXJlKHN5c3RlbURpYWdub3N0aWNDYXB0dXJlLmNiQWZ0ZXJTdG9wQ2FwdHVyZSk7XG5cbiAgICAgICAgfSk7XG4gICAgICAgIHN5c3RlbURpYWdub3N0aWNDYXB0dXJlLiRkb3dubG9hZEJ0bi5vbignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgc3lzdGVtRGlhZ25vc3RpY0NhcHR1cmUuJGRvd25sb2FkQnRuLmFkZENsYXNzKCdkaXNhYmxlZCBsb2FkaW5nJyk7XG4gICAgICAgICAgICBzeXN0ZW1EaWFnbm9zdGljQ2FwdHVyZS4kZGltbWVyLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIFBieEFwaS5TeXNsb2dQcmVwYXJlTG9nKHN5c3RlbURpYWdub3N0aWNDYXB0dXJlLmNiQWZ0ZXJEb3dubG9hZENhcHR1cmUpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgYWZ0ZXIgcHVzaGluZyB0aGUgc3RhcnQgbG9ncyBjb2xsZWN0IGJ1dHRvbi5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gcmVzcG9uc2UgLSBUaGUgcmVzcG9uc2Ugb2JqZWN0LlxuICAgICAqL1xuICAgIGNiQWZ0ZXJTdGFydENhcHR1cmUocmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKHJlc3BvbnNlICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnUENBUENhcHR1cmVTdGF0dXMnLCAnc3RhcnRlZCcpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnUENBUENhcHR1cmVTdGF0dXMnLCAnc3RvcHBlZCcpO1xuICAgICAgICAgICAgfSwgMzAwMDAwKTtcbiAgICAgICAgfVxuICAgIH0sXG5cblxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIGFmdGVyIHB1c2hpbmcgdGhlIHN0YXJ0IGxvZ3MgY29sbGVjdCBidXR0b24uXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHJlc3BvbnNlIC0gVGhlIHJlc3BvbnNlIG9iamVjdC5cbiAgICAgKi9cbiAgICBjYkFmdGVyRG93bmxvYWRDYXB0dXJlKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGFyY2hpdmVQYWNraW5nQ2hlY2tXb3JrZXIuaW5pdGlhbGl6ZShyZXNwb25zZS5maWxlbmFtZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgYWZ0ZXIgcHVzaGluZyB0aGUgc3RvcCBsb2dzIGNvbGxlY3QgYnV0dG9uLlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSByZXNwb25zZSAtIFRoZSByZXNwb25zZSBvYmplY3QuXG4gICAgICovXG4gICAgY2JBZnRlclN0b3BDYXB0dXJlKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGFyY2hpdmVQYWNraW5nQ2hlY2tXb3JrZXIuaW5pdGlhbGl6ZShyZXNwb25zZS5maWxlbmFtZSk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4vLyBXaGVuIHRoZSBkb2N1bWVudCBpcyByZWFkeSwgaW5pdGlhbGl6ZSB0aGUgc3lzdGVtIGRpYWdub3N0aWMgbWFuYWdlbWVudCBjb25zb2xlXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgc3lzdGVtRGlhZ25vc3RpY0NhcHR1cmUuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==