"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2020 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl,globalTranslate, ace, Form, PbxApi */
var customFile = {
  $formObj: $('#custom-file-form'),
  $typeSelectDropDown: $('#custom-file-form .type-select'),
  $appCode: $('#application-code'),
  $appCodeFromServer: $('#application-code-readonly'),
  $dirrtyField: $('#dirrty'),
  editor: '',
  viewer: '',
  validateRules: {
    name: {
      identifier: 'filepath',
      rules: [{
        type: 'empty',
        prompt: globalTranslate.cf_ValidateNameIsEmpty
      }]
    }
  },
  initialize: function () {
    function initialize() {
      customFile.$typeSelectDropDown.dropdown({
        onChange: function () {
          function onChange() {
            customFile.hideShowCode();
            customFile.getFileContentFromServer();
          }

          return onChange;
        }()
      });
      customFile.initializeAce();
      customFile.initializeForm();
      customFile.getFileContentFromServer();
    }

    return initialize;
  }(),
  hideShowCode: function () {
    function hideShowCode() {
      var aceHeight = window.innerHeight - 475;
      var rowsCount = Math.round(aceHeight / 16.3);
      $(window).load(function () {
        $('.application-code-readonly').css('min-height', "".concat(aceHeight, "px"));
        $('.application-code').css('min-height', "".concat(aceHeight, "px"));
      });
      var mode = customFile.$formObj.form('get value', 'mode');

      switch (mode) {
        case 'none':
          customFile.viewer.navigateFileStart();
          customFile.$appCodeFromServer.show();
          customFile.$appCode.hide();
          customFile.viewer.setOptions({
            maxLines: rowsCount
          });
          customFile.viewer.resize();
          break;

        case 'append':
          customFile.$appCodeFromServer.show();
          customFile.viewer.navigateFileEnd();
          customFile.editor.setValue(customFile.$formObj.form('get value', 'content'));
          customFile.$appCode.show();
          customFile.editor.getSession().on('change', function () {
            customFile.$dirrtyField.val(Math.random());
            customFile.$dirrtyField.trigger('change');
          });
          break;

        case 'override':
          customFile.editor.navigateFileStart();
          customFile.$appCodeFromServer.hide();
          var changedContent = customFile.$formObj.form('get value', 'content');

          if (changedContent.length > 0) {
            customFile.editor.getSession().setValue(changedContent);
          } else {
            customFile.editor.getSession().setValue(customFile.viewer.getValue());
          }

          customFile.$appCode.show();
          customFile.editor.setOptions({
            maxLines: rowsCount
          });
          customFile.editor.resize();
          customFile.editor.getSession().on('change', function () {
            customFile.$dirrtyField.val(Math.random());
            customFile.$dirrtyField.trigger('change');
          });
          break;

        default:
          break;
      }
    }

    return hideShowCode;
  }(),
  cbGetFileContentFromServer: function () {
    function cbGetFileContentFromServer(response) {
      if (response !== undefined) {
        customFile.viewer.getSession().setValue(response.data.content);
        customFile.hideShowCode();
      }
    }

    return cbGetFileContentFromServer;
  }(),
  getFileContentFromServer: function () {
    function getFileContentFromServer() {
      var filePath = customFile.$formObj.form('get value', 'filepath');
      var mode = customFile.$formObj.form('get value', 'mode') !== 'override';
      var data = {
        filename: filePath,
        needOriginal: mode,
        needLogfile: false
      };
      PbxApi.GetFileContent(data, customFile.cbGetFileContentFromServer);
    }

    return getFileContentFromServer;
  }(),
  initializeAce: function () {
    function initializeAce() {
      var IniMode = ace.require('ace/mode/julia').Mode;

      customFile.viewer = ace.edit('application-code-readonly');
      customFile.viewer.session.setMode(new IniMode());
      customFile.viewer.setTheme('ace/theme/monokai');
      customFile.viewer.setOptions({
        showPrintMargin: false,
        readOnly: true
      });
      customFile.viewer.resize();
      customFile.editor = ace.edit('application-code');
      customFile.editor.setTheme('ace/theme/monokai');
      customFile.editor.session.setMode(new IniMode());
      customFile.editor.setOptions({
        showPrintMargin: false
      });
      customFile.editor.resize();
    }

    return initializeAce;
  }(),
  cbBeforeSendForm: function () {
    function cbBeforeSendForm(settings) {
      var result = settings;
      result.data = customFile.$formObj.form('get values');

      switch (customFile.$formObj.form('get value', 'mode')) {
        case 'append':
        case 'override':
          result.data.content = customFile.editor.getValue();
          break;

        default:
          result.data.content = '';
      }

      return result;
    }

    return cbBeforeSendForm;
  }(),
  cbAfterSendForm: function () {
    function cbAfterSendForm() {}

    return cbAfterSendForm;
  }(),
  initializeForm: function () {
    function initializeForm() {
      Form.$formObj = customFile.$formObj;
      Form.url = "".concat(globalRootUrl, "custom-files/save");
      Form.validateRules = customFile.validateRules;
      Form.cbBeforeSendForm = customFile.cbBeforeSendForm;
      Form.cbAfterSendForm = customFile.cbAfterSendForm;
      Form.initialize();
    }

    return initializeForm;
  }()
};
$(document).ready(function () {
  customFile.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9DdXN0b21GaWxlcy9jdXN0b20tZmlsZXMtbW9kaWZ5LmpzIl0sIm5hbWVzIjpbImN1c3RvbUZpbGUiLCIkZm9ybU9iaiIsIiQiLCIkdHlwZVNlbGVjdERyb3BEb3duIiwiJGFwcENvZGUiLCIkYXBwQ29kZUZyb21TZXJ2ZXIiLCIkZGlycnR5RmllbGQiLCJlZGl0b3IiLCJ2aWV3ZXIiLCJ2YWxpZGF0ZVJ1bGVzIiwibmFtZSIsImlkZW50aWZpZXIiLCJydWxlcyIsInR5cGUiLCJwcm9tcHQiLCJnbG9iYWxUcmFuc2xhdGUiLCJjZl9WYWxpZGF0ZU5hbWVJc0VtcHR5IiwiaW5pdGlhbGl6ZSIsImRyb3Bkb3duIiwib25DaGFuZ2UiLCJoaWRlU2hvd0NvZGUiLCJnZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIiLCJpbml0aWFsaXplQWNlIiwiaW5pdGlhbGl6ZUZvcm0iLCJhY2VIZWlnaHQiLCJ3aW5kb3ciLCJpbm5lckhlaWdodCIsInJvd3NDb3VudCIsIk1hdGgiLCJyb3VuZCIsImxvYWQiLCJjc3MiLCJtb2RlIiwiZm9ybSIsIm5hdmlnYXRlRmlsZVN0YXJ0Iiwic2hvdyIsImhpZGUiLCJzZXRPcHRpb25zIiwibWF4TGluZXMiLCJyZXNpemUiLCJuYXZpZ2F0ZUZpbGVFbmQiLCJzZXRWYWx1ZSIsImdldFNlc3Npb24iLCJvbiIsInZhbCIsInJhbmRvbSIsInRyaWdnZXIiLCJjaGFuZ2VkQ29udGVudCIsImxlbmd0aCIsImdldFZhbHVlIiwiY2JHZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIiLCJyZXNwb25zZSIsInVuZGVmaW5lZCIsImRhdGEiLCJjb250ZW50IiwiZmlsZVBhdGgiLCJmaWxlbmFtZSIsIm5lZWRPcmlnaW5hbCIsIm5lZWRMb2dmaWxlIiwiUGJ4QXBpIiwiR2V0RmlsZUNvbnRlbnQiLCJJbmlNb2RlIiwiYWNlIiwicmVxdWlyZSIsIk1vZGUiLCJlZGl0Iiwic2Vzc2lvbiIsInNldE1vZGUiLCJzZXRUaGVtZSIsInNob3dQcmludE1hcmdpbiIsInJlYWRPbmx5IiwiY2JCZWZvcmVTZW5kRm9ybSIsInNldHRpbmdzIiwicmVzdWx0IiwiY2JBZnRlclNlbmRGb3JtIiwiRm9ybSIsInVybCIsImdsb2JhbFJvb3RVcmwiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQkE7QUFFQSxJQUFNQSxVQUFVLEdBQUc7QUFDbEJDLEVBQUFBLFFBQVEsRUFBRUMsQ0FBQyxDQUFDLG1CQUFELENBRE87QUFFbEJDLEVBQUFBLG1CQUFtQixFQUFFRCxDQUFDLENBQUMsZ0NBQUQsQ0FGSjtBQUdsQkUsRUFBQUEsUUFBUSxFQUFFRixDQUFDLENBQUMsbUJBQUQsQ0FITztBQUlsQkcsRUFBQUEsa0JBQWtCLEVBQUVILENBQUMsQ0FBQyw0QkFBRCxDQUpIO0FBS2xCSSxFQUFBQSxZQUFZLEVBQUVKLENBQUMsQ0FBQyxTQUFELENBTEc7QUFNbEJLLEVBQUFBLE1BQU0sRUFBRSxFQU5VO0FBT2xCQyxFQUFBQSxNQUFNLEVBQUUsRUFQVTtBQVFsQkMsRUFBQUEsYUFBYSxFQUFFO0FBQ2RDLElBQUFBLElBQUksRUFBRTtBQUNMQyxNQUFBQSxVQUFVLEVBQUUsVUFEUDtBQUVMQyxNQUFBQSxLQUFLLEVBQUUsQ0FDTjtBQUNDQyxRQUFBQSxJQUFJLEVBQUUsT0FEUDtBQUVDQyxRQUFBQSxNQUFNLEVBQUVDLGVBQWUsQ0FBQ0M7QUFGekIsT0FETTtBQUZGO0FBRFEsR0FSRztBQW1CbEJDLEVBQUFBLFVBbkJrQjtBQUFBLDBCQW1CTDtBQUNaakIsTUFBQUEsVUFBVSxDQUFDRyxtQkFBWCxDQUErQmUsUUFBL0IsQ0FBd0M7QUFDdkNDLFFBQUFBLFFBRHVDO0FBQUEsOEJBQzVCO0FBQ1ZuQixZQUFBQSxVQUFVLENBQUNvQixZQUFYO0FBQ0FwQixZQUFBQSxVQUFVLENBQUNxQix3QkFBWDtBQUNBOztBQUpzQztBQUFBO0FBQUEsT0FBeEM7QUFPQXJCLE1BQUFBLFVBQVUsQ0FBQ3NCLGFBQVg7QUFDQXRCLE1B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Q3ZCL0UsRUFBQUEsVUFBVSxDQUFDaUIsVUFBWDtBQUNBLENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IChDKSAyMDE3LTIwMjAgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFJvb3RVcmwsZ2xvYmFsVHJhbnNsYXRlLCBhY2UsIEZvcm0sIFBieEFwaSAqL1xuXG5jb25zdCBjdXN0b21GaWxlID0ge1xuXHQkZm9ybU9iajogJCgnI2N1c3RvbS1maWxlLWZvcm0nKSxcblx0JHR5cGVTZWxlY3REcm9wRG93bjogJCgnI2N1c3RvbS1maWxlLWZvcm0gLnR5cGUtc2VsZWN0JyksXG5cdCRhcHBDb2RlOiAkKCcjYXBwbGljYXRpb24tY29kZScpLFxuXHQkYXBwQ29kZUZyb21TZXJ2ZXI6ICQoJyNhcHBsaWNhdGlvbi1jb2RlLXJlYWRvbmx5JyksXG5cdCRkaXJydHlGaWVsZDogJCgnI2RpcnJ0eScpLFxuXHRlZGl0b3I6ICcnLFxuXHR2aWV3ZXI6ICcnLFxuXHR2YWxpZGF0ZVJ1bGVzOiB7XG5cdFx0bmFtZToge1xuXHRcdFx0aWRlbnRpZmllcjogJ2ZpbGVwYXRoJyxcblx0XHRcdHJ1bGVzOiBbXG5cdFx0XHRcdHtcblx0XHRcdFx0XHR0eXBlOiAnZW1wdHknLFxuXHRcdFx0XHRcdHByb21wdDogZ2xvYmFsVHJhbnNsYXRlLmNmX1ZhbGlkYXRlTmFtZUlzRW1wdHksXG5cdFx0XHRcdH0sXG5cdFx0XHRdLFxuXHRcdH0sXG5cdH0sXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0Y3VzdG9tRmlsZS4kdHlwZVNlbGVjdERyb3BEb3duLmRyb3Bkb3duKHtcblx0XHRcdG9uQ2hhbmdlKCkge1xuXHRcdFx0XHRjdXN0b21GaWxlLmhpZGVTaG93Q29kZSgpO1xuXHRcdFx0XHRjdXN0b21GaWxlLmdldEZpbGVDb250ZW50RnJvbVNlcnZlcigpO1xuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdGN1c3RvbUZpbGUuaW5pdGlhbGl6ZUFjZSgpO1xuXHRcdGN1c3RvbUZpbGUuaW5pdGlhbGl6ZUZvcm0oKTtcblx0XHRjdXN0b21GaWxlLmdldEZpbGVDb250ZW50RnJvbVNlcnZlcigpO1xuXHR9LFxuXHRoaWRlU2hvd0NvZGUoKSB7XG5cdFx0Y29uc3QgYWNlSGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0LTQ3NTtcblx0XHRjb25zdCByb3dzQ291bnQgPSBNYXRoLnJvdW5kKGFjZUhlaWdodC8xNi4zKTtcblx0XHQkKHdpbmRvdykubG9hZChmdW5jdGlvbigpIHtcblx0XHRcdCQoJy5hcHBsaWNhdGlvbi1jb2RlLXJlYWRvbmx5JykuY3NzKCdtaW4taGVpZ2h0JywgYCR7YWNlSGVpZ2h0fXB4YCk7XG5cdFx0XHQkKCcuYXBwbGljYXRpb24tY29kZScpLmNzcygnbWluLWhlaWdodCcsIGAke2FjZUhlaWdodH1weGApO1xuXHRcdH0pO1xuXHRcdGNvbnN0IG1vZGUgPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZScsICdtb2RlJyk7XG5cdFx0c3dpdGNoIChtb2RlKSB7XG5cdFx0XHRjYXNlICdub25lJzpcblx0XHRcdFx0Y3VzdG9tRmlsZS52aWV3ZXIubmF2aWdhdGVGaWxlU3RhcnQoKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZUZyb21TZXJ2ZXIuc2hvdygpO1xuXHRcdFx0XHRjdXN0b21GaWxlLiRhcHBDb2RlLmhpZGUoKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS52aWV3ZXIuc2V0T3B0aW9ucyh7XG5cdFx0XHRcdFx0bWF4TGluZXM6IHJvd3NDb3VudCxcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGN1c3RvbUZpbGUudmlld2VyLnJlc2l6ZSgpXG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnYXBwZW5kJzpcblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZUZyb21TZXJ2ZXIuc2hvdygpO1xuXHRcdFx0XHRjdXN0b21GaWxlLnZpZXdlci5uYXZpZ2F0ZUZpbGVFbmQoKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3Iuc2V0VmFsdWUoY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnY29udGVudCcpKTtcblx0XHRcdFx0Y3VzdG9tRmlsZS4kYXBwQ29kZS5zaG93KCk7XG5cdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLmdldFNlc3Npb24oKS5vbignY2hhbmdlJywgKCkgPT4ge1xuXHRcdFx0XHRcdGN1c3RvbUZpbGUuJGRpcnJ0eUZpZWxkLnZhbChNYXRoLnJhbmRvbSgpKTtcblx0XHRcdFx0XHRjdXN0b21GaWxlLiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnb3ZlcnJpZGUnOlxuXHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5uYXZpZ2F0ZUZpbGVTdGFydCgpO1xuXHRcdFx0XHRjdXN0b21GaWxlLiRhcHBDb2RlRnJvbVNlcnZlci5oaWRlKCk7XG5cdFx0XHRcdGNvbnN0IGNoYW5nZWRDb250ZW50ID0gY3VzdG9tRmlsZS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWUnLCAnY29udGVudCcpO1xuXHRcdFx0XHRpZiAoY2hhbmdlZENvbnRlbnQubGVuZ3RoPjApe1xuXHRcdFx0XHRcdGN1c3RvbUZpbGUuZWRpdG9yLmdldFNlc3Npb24oKS5zZXRWYWx1ZShjaGFuZ2VkQ29udGVudCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3IuZ2V0U2Vzc2lvbigpLnNldFZhbHVlKGN1c3RvbUZpbGUudmlld2VyLmdldFZhbHVlKCkpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGN1c3RvbUZpbGUuJGFwcENvZGUuc2hvdygpO1xuXHRcdFx0XHRjdXN0b21GaWxlLmVkaXRvci5zZXRPcHRpb25zKHtcblx0XHRcdFx0XHRtYXhMaW5lczogcm93c0NvdW50LFxuXHRcdFx0XHR9KTtcblx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3IucmVzaXplKClcblx0XHRcdFx0Y3VzdG9tRmlsZS5lZGl0b3IuZ2V0U2Vzc2lvbigpLm9uKCdjaGFuZ2UnLCAoKSA9PiB7XG5cdFx0XHRcdFx0Y3VzdG9tRmlsZS4kZGlycnR5RmllbGQudmFsKE1hdGgucmFuZG9tKCkpO1xuXHRcdFx0XHRcdGN1c3RvbUZpbGUuJGRpcnJ0eUZpZWxkLnRyaWdnZXIoJ2NoYW5nZScpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdH0sXG5cdGNiR2V0RmlsZUNvbnRlbnRGcm9tU2VydmVyKHJlc3BvbnNlKSB7XG5cdFx0aWYgKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdGN1c3RvbUZpbGUudmlld2VyLmdldFNlc3Npb24oKS5zZXRWYWx1ZShyZXNwb25zZS5kYXRhLmNvbnRlbnQpO1xuXHRcdFx0Y3VzdG9tRmlsZS5oaWRlU2hvd0NvZGUoKTtcblx0XHR9XG5cdH0sXG5cdGdldEZpbGVDb250ZW50RnJvbVNlcnZlcigpIHtcblx0XHRjb25zdCBmaWxlUGF0aCA9IGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ2ZpbGVwYXRoJyk7XG5cdFx0Y29uc3QgbW9kZSA9IGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ21vZGUnKSAhPT0gJ292ZXJyaWRlJztcblx0XHRjb25zdCBkYXRhID0geyBmaWxlbmFtZTogZmlsZVBhdGgsIG5lZWRPcmlnaW5hbDogbW9kZSwgbmVlZExvZ2ZpbGU6IGZhbHNlIH07XG5cdFx0UGJ4QXBpLkdldEZpbGVDb250ZW50KGRhdGEsIGN1c3RvbUZpbGUuY2JHZXRGaWxlQ29udGVudEZyb21TZXJ2ZXIpO1xuXHR9LFxuXHRpbml0aWFsaXplQWNlKCkge1xuXHRcdGNvbnN0IEluaU1vZGUgPSBhY2UucmVxdWlyZSgnYWNlL21vZGUvanVsaWEnKS5Nb2RlO1xuXHRcdGN1c3RvbUZpbGUudmlld2VyID0gYWNlLmVkaXQoJ2FwcGxpY2F0aW9uLWNvZGUtcmVhZG9ubHknKTtcblx0XHRjdXN0b21GaWxlLnZpZXdlci5zZXNzaW9uLnNldE1vZGUobmV3IEluaU1vZGUoKSk7XG5cdFx0Y3VzdG9tRmlsZS52aWV3ZXIuc2V0VGhlbWUoJ2FjZS90aGVtZS9tb25va2FpJyk7XG5cdFx0Y3VzdG9tRmlsZS52aWV3ZXIuc2V0T3B0aW9ucyh7XG5cdFx0XHRzaG93UHJpbnRNYXJnaW46IGZhbHNlLFxuXHRcdFx0cmVhZE9ubHk6IHRydWVcblx0XHR9KTtcblx0XHRjdXN0b21GaWxlLnZpZXdlci5yZXNpemUoKTtcblxuXHRcdGN1c3RvbUZpbGUuZWRpdG9yID0gYWNlLmVkaXQoJ2FwcGxpY2F0aW9uLWNvZGUnKTtcblx0XHRjdXN0b21GaWxlLmVkaXRvci5zZXRUaGVtZSgnYWNlL3RoZW1lL21vbm9rYWknKTtcblx0XHRjdXN0b21GaWxlLmVkaXRvci5zZXNzaW9uLnNldE1vZGUobmV3IEluaU1vZGUoKSk7XG5cdFx0Y3VzdG9tRmlsZS5lZGl0b3Iuc2V0T3B0aW9ucyh7XG5cdFx0XHRzaG93UHJpbnRNYXJnaW46IGZhbHNlLFxuXHRcdH0pO1xuXHRcdGN1c3RvbUZpbGUuZWRpdG9yLnJlc2l6ZSgpO1xuXHR9LFxuXHRjYkJlZm9yZVNlbmRGb3JtKHNldHRpbmdzKSB7XG5cdFx0Y29uc3QgcmVzdWx0ID0gc2V0dGluZ3M7XG5cdFx0cmVzdWx0LmRhdGEgPSBjdXN0b21GaWxlLiRmb3JtT2JqLmZvcm0oJ2dldCB2YWx1ZXMnKTtcblx0XHRzd2l0Y2ggKGN1c3RvbUZpbGUuJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlJywgJ21vZGUnKSkge1xuXHRcdFx0Y2FzZSAnYXBwZW5kJzpcblx0XHRcdGNhc2UgJ292ZXJyaWRlJzpcblx0XHRcdFx0cmVzdWx0LmRhdGEuY29udGVudCA9IGN1c3RvbUZpbGUuZWRpdG9yLmdldFZhbHVlKCk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0cmVzdWx0LmRhdGEuY29udGVudCA9ICcnO1xuXHRcdH1cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHRjYkFmdGVyU2VuZEZvcm0oKSB7XG5cblx0fSxcblx0aW5pdGlhbGl6ZUZvcm0oKSB7XG5cdFx0Rm9ybS4kZm9ybU9iaiA9IGN1c3RvbUZpbGUuJGZvcm1PYmo7XG5cdFx0Rm9ybS51cmwgPSBgJHtnbG9iYWxSb290VXJsfWN1c3RvbS1maWxlcy9zYXZlYDtcblx0XHRGb3JtLnZhbGlkYXRlUnVsZXMgPSBjdXN0b21GaWxlLnZhbGlkYXRlUnVsZXM7XG5cdFx0Rm9ybS5jYkJlZm9yZVNlbmRGb3JtID0gY3VzdG9tRmlsZS5jYkJlZm9yZVNlbmRGb3JtO1xuXHRcdEZvcm0uY2JBZnRlclNlbmRGb3JtID0gY3VzdG9tRmlsZS5jYkFmdGVyU2VuZEZvcm07XG5cdFx0Rm9ybS5pbml0aWFsaXplKCk7XG5cdH0sXG59O1xuXG4kKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG5cdGN1c3RvbUZpbGUuaW5pdGlhbGl6ZSgpO1xufSk7XG5cbiJdfQ==