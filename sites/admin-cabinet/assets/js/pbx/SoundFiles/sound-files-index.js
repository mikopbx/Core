"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright (C) 2017-2020 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalTranslate, SemanticLocalization, PbxApi, globalRootUrl, IndexSoundPlayer*/
var soundFiles = {
  $audioFilesList: $('#custom-sound-files-table, #moh-sound-files-table'),
  $contentFrame: $('#content-frame'),
  $tabMenuItems: $('#sound-files-menu .item'),
  initialize: function initialize() {
    soundFiles.$tabMenuItems.tab({
      history: true,
      historyType: 'hash'
    });
    soundFiles.$audioFilesList.DataTable({
      lengthChange: false,
      paging: false,
      columns: [null, {
        orderable: false,
        searchable: false
      }, {
        orderable: false,
        searchable: false
      }],
      order: [0, 'asc'],
      initComplete: function initComplete() {
        $('.file-row').each(function (index, row) {
          var id = $(row).attr('id');
          return new IndexSoundPlayer(id);
        });
      },
      language: SemanticLocalization.dataTableLocalisation
    });
    soundFiles.dataTable = soundFiles.$audioFilesList.DataTable();
    soundFiles.dataTable.on('draw', function () {
      $('.file-row').each(function (index, row) {
        var id = $(row).attr('id');
        return new IndexSoundPlayer(id);
      });
    });
    $('#add-new-custom-button').appendTo($('#custom-sound-files-table_wrapper div.eight.column:eq(0)'));
    $('#add-new-moh-button').appendTo($('#moh-sound-files-table_wrapper div.eight.column:eq(0)'));
    var toArray = Array.prototype.slice;
    toArray.apply(document.getElementsByTagName('audio')).forEach(function (audio) {
      audio.addEventListener('error', soundFiles.handleMediaError);
    });
    $('body').on('click', 'a.delete', function (e) {
      e.preventDefault();
      var fileName = $(e.target).closest('tr').attr('data-value');
      var fileId = $(e.target).closest('tr').attr('id');
      PbxApi.FilesRemoveAudioFile(fileName, fileId, soundFiles.cbAfterDelete);
    });
  },

  /**
   * Callback after success file delete
   * @param id
   * @returns {boolean|boolean}
   */
  cbAfterDelete: function cbAfterDelete(id) {
    $('.message.ajax').remove();
    $.api({
      url: "".concat(globalRootUrl, "sound-files/delete/").concat(id),
      on: 'now',
      successTest: function successTest(response) {
        // test whether a JSON response is valid
        return response !== undefined && Object.keys(response).length > 0;
      },
      onSuccess: function onSuccess(response) {
        if (response.success === true) {
          soundFiles.$audioFilesList.find("tr[id=".concat(id, "]")).remove();
          sessionStorage.removeItem("".concat(globalRootUrl, "sound-files/getSoundFiles/custom"));
          sessionStorage.removeItem("".concat(globalRootUrl, "sound-files/getSoundFiles/moh"));
        } else {
          soundFiles.$contentFrame.before("<div class=\"ui error message ajax\">".concat(response.message.error, "</div>"));
        }
      }
    });
  },
  handleMediaError: function handleMediaError(e) {
    switch (e.target.error.code) {
      case e.target.error.MEDIA_ERR_ABORTED:
        console.log('You aborted the media playback.');
        break;

      case e.target.error.MEDIA_ERR_NETWORK:
        console.log('A network error caused the media download to fail.');
        break;

      case e.target.error.MEDIA_ERR_DECODE:
        console.log('The media playback was aborted due to a corruption problem or because the media used features your browser did not support.');
        break;

      case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:
        console.log('The media could not be loaded, either because the server or network failed or because the format is not supported.');
        break;

      default:
        console.log('An unknown media error occurred.');
    }

    var $row = $(e.target).closest('tr');
    $row.addClass('negative');
    $row.find('td.player').html(globalTranslate.sf_FileNotFound);
  }
};
$(document).ready(function () {
  soundFiles.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Tb3VuZEZpbGVzL3NvdW5kLWZpbGVzLWluZGV4LmpzIl0sIm5hbWVzIjpbInNvdW5kRmlsZXMiLCIkYXVkaW9GaWxlc0xpc3QiLCIkIiwiJGNvbnRlbnRGcmFtZSIsIiR0YWJNZW51SXRlbXMiLCJpbml0aWFsaXplIiwidGFiIiwiaGlzdG9yeSIsImhpc3RvcnlUeXBlIiwiRGF0YVRhYmxlIiwibGVuZ3RoQ2hhbmdlIiwicGFnaW5nIiwiY29sdW1ucyIsIm9yZGVyYWJsZSIsInNlYXJjaGFibGUiLCJvcmRlciIsImluaXRDb21wbGV0ZSIsImVhY2giLCJpbmRleCIsInJvdyIsImlkIiwiYXR0ciIsIkluZGV4U291bmRQbGF5ZXIiLCJsYW5ndWFnZSIsIlNlbWFudGljTG9jYWxpemF0aW9uIiwiZGF0YVRhYmxlTG9jYWxpc2F0aW9uIiwiZGF0YVRhYmxlIiwib24iLCJhcHBlbmRUbyIsInRvQXJyYXkiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiYXBwbHkiLCJkb2N1bWVudCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZm9yRWFjaCIsImF1ZGlvIiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZU1lZGlhRXJyb3IiLCJlIiwicHJldmVudERlZmF1bHQiLCJmaWxlTmFtZSIsInRhcmdldCIsImNsb3Nlc3QiLCJmaWxlSWQiLCJQYnhBcGkiLCJGaWxlc1JlbW92ZUF1ZGlvRmlsZSIsImNiQWZ0ZXJEZWxldGUiLCJyZW1vdmUiLCJhcGkiLCJ1cmwiLCJnbG9iYWxSb290VXJsIiwic3VjY2Vzc1Rlc3QiLCJyZXNwb25zZSIsInVuZGVmaW5lZCIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJvblN1Y2Nlc3MiLCJzdWNjZXNzIiwiZmluZCIsInNlc3Npb25TdG9yYWdlIiwicmVtb3ZlSXRlbSIsImJlZm9yZSIsIm1lc3NhZ2UiLCJlcnJvciIsImNvZGUiLCJNRURJQV9FUlJfQUJPUlRFRCIsImNvbnNvbGUiLCJsb2ciLCJNRURJQV9FUlJfTkVUV09SSyIsIk1FRElBX0VSUl9ERUNPREUiLCJNRURJQV9FUlJfU1JDX05PVF9TVVBQT1JURUQiLCIkcm93IiwiYWRkQ2xhc3MiLCJodG1sIiwiZ2xvYmFsVHJhbnNsYXRlIiwic2ZfRmlsZU5vdEZvdW5kIiwicmVhZHkiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUdBLElBQU1BLFVBQVUsR0FBRztBQUNsQkMsRUFBQUEsZUFBZSxFQUFFQyxDQUFDLENBQUMsbURBQUQsQ0FEQTtBQUVsQkMsRUFBQUEsYUFBYSxFQUFFRCxDQUFDLENBQUMsZ0JBQUQsQ0FGRTtBQUdsQkUsRUFBQUEsYUFBYSxFQUFFRixDQUFDLENBQUMseUJBQUQsQ0FIRTtBQUlsQkcsRUFBQUEsVUFKa0Isd0JBSUw7QUFDWkwsSUFBQUEsVUFBVSxDQUFDSSxhQUFYLENBQXlCRSxHQUF6QixDQUE2QjtBQUM1QkMsTUFBQUEsT0FBTyxFQUFFLElBRG1CO0FBRTVCQyxNQUFBQSxXQUFXLEVBQUU7QUFGZSxLQUE3QjtBQUlBUixJQUFBQSxVQUFVLENBQUNDLGVBQVgsQ0FBMkJRLFNBQTNCLENBQXFDO0FBQ3BDQyxNQUFBQSxZQUFZLEVBQUUsS0FEc0I7QUFFcENDLE1BQUFBLE1BQU0sRUFBRSxLQUY0QjtBQUdwQ0MsTUFBQUEsT0FBTyxFQUFFLENBQ1IsSUFEUSxFQUVSO0FBQUVDLFFBQUFBLFNBQVMsRUFBRSxLQUFiO0FBQW9CQyxRQUFBQSxVQUFVLEVBQUU7QUFBaEMsT0FGUSxFQUdSO0FBQUVELFFBQUFBLFNBQVMsRUFBRSxLQUFiO0FBQW9CQyxRQUFBQSxVQUFVLEVBQUU7QUFBaEMsT0FIUSxDQUgyQjtBQVFwQ0MsTUFBQUEsS0FBSyxFQUFFLENBQUMsQ0FBRCxFQUFJLEtBQUosQ0FSNkI7QUFTcENDLE1BQUFBLFlBVG9DLDBCQVNyQjtBQUNkZCxRQUFBQSxDQUFDLENBQUMs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LEdBQUd4RSxDQUFDLENBQUNzQyxDQUFDLENBQUNHLE1BQUgsQ0FBRCxDQUFZQyxPQUFaLENBQW9CLElBQXBCLENBQWI7QUFDQThCLElBQUFBLElBQUksQ0FBQ0MsUUFBTCxDQUFjLFVBQWQ7QUFDQUQsSUFBQUEsSUFBSSxDQUFDYixJQUFMLENBQVUsV0FBVixFQUF1QmUsSUFBdkIsQ0FBNEJDLGVBQWUsQ0FBQ0MsZUFBNUM7QUFDQTtBQTVGaUIsQ0FBbkI7QUFnR0E1RSxDQUFDLENBQUNnQyxRQUFELENBQUQsQ0FBWTZDLEtBQVosQ0FBa0IsWUFBTTtBQUN2Qi9FLEVBQUFBLFVBQVUsQ0FBQ0ssVUFBWDtBQUNBLENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogTWlrb1BCWCAtIGZyZWUgcGhvbmUgc3lzdGVtIGZvciBzbWFsbCBidXNpbmVzc1xuICogQ29weXJpZ2h0IChDKSAyMDE3LTIwMjAgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuLyogZ2xvYmFsIGdsb2JhbFRyYW5zbGF0ZSwgU2VtYW50aWNMb2NhbGl6YXRpb24sIFBieEFwaSwgZ2xvYmFsUm9vdFVybCwgSW5kZXhTb3VuZFBsYXllciovXG5cblxuY29uc3Qgc291bmRGaWxlcyA9IHtcblx0JGF1ZGlvRmlsZXNMaXN0OiAkKCcjY3VzdG9tLXNvdW5kLWZpbGVzLXRhYmxlLCAjbW9oLXNvdW5kLWZpbGVzLXRhYmxlJyksXG5cdCRjb250ZW50RnJhbWU6ICQoJyNjb250ZW50LWZyYW1lJyksXG5cdCR0YWJNZW51SXRlbXM6ICQoJyNzb3VuZC1maWxlcy1tZW51IC5pdGVtJyksXG5cdGluaXRpYWxpemUoKSB7XG5cdFx0c291bmRGaWxlcy4kdGFiTWVudUl0ZW1zLnRhYih7XG5cdFx0XHRoaXN0b3J5OiB0cnVlLFxuXHRcdFx0aGlzdG9yeVR5cGU6ICdoYXNoJyxcblx0XHR9KTtcblx0XHRzb3VuZEZpbGVzLiRhdWRpb0ZpbGVzTGlzdC5EYXRhVGFibGUoe1xuXHRcdFx0bGVuZ3RoQ2hhbmdlOiBmYWxzZSxcblx0XHRcdHBhZ2luZzogZmFsc2UsXG5cdFx0XHRjb2x1bW5zOiBbXG5cdFx0XHRcdG51bGwsXG5cdFx0XHRcdHsgb3JkZXJhYmxlOiBmYWxzZSwgc2VhcmNoYWJsZTogZmFsc2UgfSxcblx0XHRcdFx0eyBvcmRlcmFibGU6IGZhbHNlLCBzZWFyY2hhYmxlOiBmYWxzZSB9LFxuXHRcdFx0XSxcblx0XHRcdG9yZGVyOiBbMCwgJ2FzYyddLFxuXHRcdFx0aW5pdENvbXBsZXRlKCkge1xuXHRcdFx0XHQkKCcuZmlsZS1yb3cnKS5lYWNoKChpbmRleCwgcm93KSA9PiB7XG5cdFx0XHRcdFx0Y29uc3QgaWQgPSAkKHJvdykuYXR0cignaWQnKTtcblx0XHRcdFx0XHRyZXR1cm4gbmV3IEluZGV4U291bmRQbGF5ZXIoaWQpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0sXG5cdFx0XHRsYW5ndWFnZTogU2VtYW50aWNMb2NhbGl6YXRpb24uZGF0YVRhYmxlTG9jYWxpc2F0aW9uLFxuXHRcdH0pO1xuXHRcdHNvdW5kRmlsZXMuZGF0YVRhYmxlID0gc291bmRGaWxlcy4kYXVkaW9GaWxlc0xpc3QuRGF0YVRhYmxlKCk7XG5cdFx0c291bmRGaWxlcy5kYXRhVGFibGUub24oJ2RyYXcnLCAoKSA9PiB7XG5cdFx0XHQkKCcuZmlsZS1yb3cnKS5lYWNoKChpbmRleCwgcm93KSA9PiB7XG5cdFx0XHRcdGNvbnN0IGlkID0gJChyb3cpLmF0dHIoJ2lkJyk7XG5cdFx0XHRcdHJldHVybiBuZXcgSW5kZXhTb3VuZFBsYXllcihpZCk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0XHQkKCcjYWRkLW5ldy1jdXN0b20tYnV0dG9uJykuYXBwZW5kVG8oJCgnI2N1c3RvbS1zb3VuZC1maWxlcy10YWJsZV93cmFwcGVyIGRpdi5laWdodC5jb2x1bW46ZXEoMCknKSk7XG5cdFx0JCgnI2FkZC1uZXctbW9oLWJ1dHRvbicpLmFwcGVuZFRvKCQoJyNtb2gtc291bmQtZmlsZXMtdGFibGVfd3JhcHBlciBkaXYuZWlnaHQuY29sdW1uOmVxKDApJykpO1xuXHRcdGNvbnN0IHRvQXJyYXkgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG5cdFx0dG9BcnJheS5hcHBseShkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYXVkaW8nKSkuZm9yRWFjaCgoYXVkaW8pID0+IHtcblx0XHRcdGF1ZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgc291bmRGaWxlcy5oYW5kbGVNZWRpYUVycm9yKTtcblx0XHR9KTtcblx0XHQkKCdib2R5Jykub24oJ2NsaWNrJywgJ2EuZGVsZXRlJywgKGUpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdGNvbnN0IGZpbGVOYW1lID0gJChlLnRhcmdldCkuY2xvc2VzdCgndHInKS5hdHRyKCdkYXRhLXZhbHVlJyk7XG5cdFx0XHRjb25zdCBmaWxlSWQgPSAkKGUudGFyZ2V0KS5jbG9zZXN0KCd0cicpLmF0dHIoJ2lkJyk7XG5cdFx0XHRQYnhBcGkuRmlsZXNSZW1vdmVBdWRpb0ZpbGUoZmlsZU5hbWUsIGZpbGVJZCwgc291bmRGaWxlcy5jYkFmdGVyRGVsZXRlKTtcblx0XHR9KTtcblx0fSxcblx0LyoqXG5cdCAqIENhbGxiYWNrIGFmdGVyIHN1Y2Nlc3MgZmlsZSBkZWxldGVcblx0ICogQHBhcmFtIGlkXG5cdCAqIEByZXR1cm5zIHtib29sZWFufGJvb2xlYW59XG5cdCAqL1xuXHRjYkFmdGVyRGVsZXRlKGlkKSB7XG5cdFx0JCgnLm1lc3NhZ2UuYWpheCcpLnJlbW92ZSgpO1xuXHRcdCQuYXBpKHtcblx0XHRcdHVybDogYCR7Z2xvYmFsUm9vdFVybH1zb3VuZC1maWxlcy9kZWxldGUvJHtpZH1gLFxuXHRcdFx0b246ICdub3cnLFxuXHRcdFx0c3VjY2Vzc1Rlc3QocmVzcG9uc2UpIHtcblx0XHRcdFx0Ly8gdGVzdCB3aGV0aGVyIGEgSlNPTiByZXNwb25zZSBpcyB2YWxpZFxuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UgIT09IHVuZGVmaW5lZFxuXHRcdFx0XHRcdCYmIE9iamVjdC5rZXlzKHJlc3BvbnNlKS5sZW5ndGggPiAwO1xuXHRcdFx0fSxcblx0XHRcdG9uU3VjY2VzcyhyZXNwb25zZSkge1xuXHRcdFx0XHRpZiAocmVzcG9uc2Uuc3VjY2VzcyA9PT0gdHJ1ZSkge1xuXHRcdFx0XHRcdHNvdW5kRmlsZXMuJGF1ZGlvRmlsZXNMaXN0LmZpbmQoYHRyW2lkPSR7aWR9XWApLnJlbW92ZSgpO1xuXHRcdFx0XHRcdHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oYCR7Z2xvYmFsUm9vdFVybH1zb3VuZC1maWxlcy9nZXRTb3VuZEZpbGVzL2N1c3RvbWApO1xuXHRcdFx0XHRcdHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oYCR7Z2xvYmFsUm9vdFVybH1zb3VuZC1maWxlcy9nZXRTb3VuZEZpbGVzL21vaGApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHNvdW5kRmlsZXMuJGNvbnRlbnRGcmFtZS5iZWZvcmUoYDxkaXYgY2xhc3M9XCJ1aSBlcnJvciBtZXNzYWdlIGFqYXhcIj4ke3Jlc3BvbnNlLm1lc3NhZ2UuZXJyb3J9PC9kaXY+YCk7XG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0fSk7XG5cdH0sXG5cdGhhbmRsZU1lZGlhRXJyb3IoZSkge1xuXHRcdHN3aXRjaCAoZS50YXJnZXQuZXJyb3IuY29kZSkge1xuXHRcdFx0Y2FzZSBlLnRhcmdldC5lcnJvci5NRURJQV9FUlJfQUJPUlRFRDpcblx0XHRcdFx0Y29uc29sZS5sb2coJ1lvdSBhYm9ydGVkIHRoZSBtZWRpYSBwbGF5YmFjay4nKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIGUudGFyZ2V0LmVycm9yLk1FRElBX0VSUl9ORVRXT1JLOlxuXHRcdFx0XHRjb25zb2xlLmxvZygnQSBuZXR3b3JrIGVycm9yIGNhdXNlZCB0aGUgbWVkaWEgZG93bmxvYWQgdG8gZmFpbC4nKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIGUudGFyZ2V0LmVycm9yLk1FRElBX0VSUl9ERUNPREU6XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdUaGUgbWVkaWEgcGxheWJhY2sgd2FzIGFib3J0ZWQgZHVlIHRvIGEgY29ycnVwdGlvbiBwcm9ibGVtIG9yIGJlY2F1c2UgdGhlIG1lZGlhIHVzZWQgZmVhdHVyZXMgeW91ciBicm93c2VyIGRpZCBub3Qgc3VwcG9ydC4nKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIGUudGFyZ2V0LmVycm9yLk1FRElBX0VSUl9TUkNfTk9UX1NVUFBPUlRFRDpcblx0XHRcdFx0Y29uc29sZS5sb2coJ1RoZSBtZWRpYSBjb3VsZCBub3QgYmUgbG9hZGVkLCBlaXRoZXIgYmVjYXVzZSB0aGUgc2VydmVyIG9yIG5ldHdvcmsgZmFpbGVkIG9yIGJlY2F1c2UgdGhlIGZvcm1hdCBpcyBub3Qgc3VwcG9ydGVkLicpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdBbiB1bmtub3duIG1lZGlhIGVycm9yIG9jY3VycmVkLicpO1xuXHRcdH1cblx0XHRjb25zdCAkcm93ID0gJChlLnRhcmdldCkuY2xvc2VzdCgndHInKTtcblx0XHQkcm93LmFkZENsYXNzKCduZWdhdGl2ZScpO1xuXHRcdCRyb3cuZmluZCgndGQucGxheWVyJykuaHRtbChnbG9iYWxUcmFuc2xhdGUuc2ZfRmlsZU5vdEZvdW5kKTtcblx0fSxcbn07XG5cblxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuXHRzb3VuZEZpbGVzLmluaXRpYWxpemUoKTtcbn0pO1xuXG4iXX0=