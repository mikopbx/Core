"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global MediaStreamRecorder, StereoAudioRecorder, PbxApi, sndPlayer */

/**
 * WebKit sound recorder module.
 * @module webkitRecorder
 */
var webkitRecorder = {
  $recordLabel: $('#record-label'),
  $recordButton: $('#start-record-button'),
  $stopButton: $('#stop-record-button'),
  $selectAudioInput: $('#select-audio-button'),
  $audioPlayer: $('#audio-player'),
  audioInputMenu: document.getElementById('audio-input-select'),
  chunks: [],
  mediaRecorder: '',

  /**
   * Initialize the WebKit sound recorder module.
   */
  initialize: function initialize() {
    webkitRecorder.$stopButton.addClass('disabled'); // Event listener for the record button

    webkitRecorder.$recordButton.on('click', function (e) {
      e.preventDefault();
      webkitRecorder.chunks = [];
      var constraints = {
        audio: true
      };

      if (webkitRecorder.audioInputMenu.getElementsByClassName('selected').length > 0) {
        var audioSource = webkitRecorder.audioInputMenu.getElementsByClassName('selected')[0].id;
        constraints = {
          audio: {
            deviceId: audioSource ? {
              exact: audioSource
            } : undefined
          }
        };
      }

      console.log(constraints);
      webkitRecorder.captureUserMedia(constraints, webkitRecorder.cbOnSuccess, webkitRecorder.gotDevices, webkitRecorder.onError);
    }); // Event listener for the stop button

    webkitRecorder.$stopButton.on('click', function (e) {
      e.preventDefault();
      webkitRecorder.mediaRecorder.stop();
    });
    webkitRecorder.$selectAudioInput.dropdown(); // Disable the field if the protocol is not HTTPS or the hostname is not localhost

    if (window.location.protocol !== 'https:' && window.location.hostname !== 'localhost') {
      $('#only-https-field').addClass('disabled');
    } // Disable the field if the user agent is MSIE


    if (window.navigator.userAgent.indexOf('MSIE ') > 0) {
      $('#only-https-field').addClass('disabled');
    }
  },

  /**
   * Capture user media based on media constraints.
   * @param {MediaStreamConstraints} mediaConstraints - The media constraints for capturing user media.
   * @param {Function} successCallback - The success callback function to handle captured media stream.
   * @param {Function} gotDevicesCallBack - The callback function to handle the list of available devices.
   * @param {Function} errorCallback - The error callback function to handle errors during media capture.
   */
  captureUserMedia: function captureUserMedia(mediaConstraints, successCallback, gotDevicesCallBack, errorCallback) {
    navigator.mediaDevices.getUserMedia(mediaConstraints).then(successCallback).then(gotDevicesCallBack)["catch"](errorCallback);
  },

  /**
   * Callback function called when devices are retrieved.
   * @param {MediaDeviceInfo[]} deviceInfos - The array of retrieved device info.
   */
  gotDevices: function gotDevices(deviceInfos) {
    if (webkitRecorder.audioInputMenu.getElementsByTagName('div').length > 0) return;

    for (var i = 0; i !== deviceInfos.length; i += 1) {
      var deviceInfo = deviceInfos[i];
      var option = document.createElement('div');
      option.className = 'item';
      option.id = deviceInfo.deviceId;

      if (deviceInfo.kind === 'audioinput') {
        option.innerHTML = deviceInfo.label || "microphone ".concat(webkitRecorder.audioInputMenu.length + 1);
        webkitRecorder.audioInputMenu.appendChild(option);
      }
    }

    if (webkitRecorder.audioInputMenu.getElementsByTagName('div').length > 0) {
      webkitRecorder.$selectAudioInput.removeClass('disabled');
    }
  },

  /**
   * Callback function called after successfully capturing user media.
   * @param {MediaStream} stream - The captured media stream.
   * @returns {Promise} - The promise to enumerate devices.
   */
  cbOnSuccess: function cbOnSuccess(stream) {
    try {
      webkitRecorder.mediaRecorder = new MediaStreamRecorder(stream);
      webkitRecorder.mediaRecorder.stream = stream;
      webkitRecorder.mediaRecorder.recorderType = StereoAudioRecorder;
      webkitRecorder.mediaRecorder.mimeType = 'audio/wav';
      webkitRecorder.mediaRecorder.audioChannels = 1; // webkitRecorder.mediaRecorder = new MediaRecorder(stream);

      webkitRecorder.mediaRecorder.onstop = webkitRecorder.cbOnStopMediaRecorder;
      webkitRecorder.mediaRecorder.ondataavailable = webkitRecorder.cbOnDataAvailable;
      webkitRecorder.mediaRecorder.start(300000);
      console.log('recorder started');
      webkitRecorder.$recordLabel.addClass('red');
      webkitRecorder.$stopButton.removeClass('disabled');
      webkitRecorder.$recordButton.addClass('disabled');
      return navigator.mediaDevices.enumerateDevices();
    } catch (e) {
      console.error('MediaStreamRecorder is not supported by this browser.\n\n' + 'Try Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.');
      console.error('Exception while creating MediaRecorder:', e);
      webkitRecorder.$recordButton.addClass('disabled');
    }

    return false;
  },

  /**
   * Callback function called when an error occurs.
   * @param {Error} err - The error object.
   */
  cbOnError: function cbOnError(err) {
    console.log("The following error occured: ".concat(err));
  },

  /**
   * Callback function called when media recorder is stopped.
   */
  cbOnStopMediaRecorder: function cbOnStopMediaRecorder() {
    console.log('data available after MediaStreamRecorder.stop() called.');
    soundFileModify.blob = new Blob(webkitRecorder.chunks);
    console.log('recorder stopped');
    var fileURL = URL.createObjectURL(soundFileModify.blob);
    sndPlayer.UpdateSource(fileURL);
    var blobFile = new File([webkitRecorder.chunks[0]], 'blob' + new Date().getTime() + '.wav');
    PbxApi.FilesUploadFile(blobFile, soundFileModify.cbUploadResumable);
    webkitRecorder.$recordLabel.removeClass('red');
    webkitRecorder.$stopButton.addClass('disabled');
    webkitRecorder.$recordButton.removeClass('disabled');
    soundFileModify.$soundFileInput.val('');
  },

  /**
   * Callback function called when data is available.
   * @param {BlobEvent} e - The blob event.
   */
  cbOnDataAvailable: function cbOnDataAvailable(e) {
    webkitRecorder.chunks.push(e);
  }
}; // When the document is ready, initialize the web kit sound recorder

$(document).ready(function () {
  webkitRecorder.initialize();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Tb3VuZEZpbGVzL3NvdW5kLWZpbGUtbW9kaWZ5LXdlYmtpdC1yZWNvcmRlci5qcyJdLCJuYW1lcyI6WyJ3ZWJraXRSZWNvcmRlciIsIiRyZWNvcmRMYWJlbCIsIiQiLCIkcmVjb3JkQnV0dG9uIiwiJHN0b3BCdXR0b24iLCIkc2VsZWN0QXVkaW9JbnB1dCIsIiRhdWRpb1BsYXllciIsImF1ZGlvSW5wdXRNZW51IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNodW5rcyIsIm1lZGlhUmVjb3JkZXIiLCJpbml0aWFsaXplIiwiYWRkQ2xhc3MiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImNvbnN0cmFpbnRzIiwiYXVkaW8iLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwibGVuZ3RoIiwiYXVkaW9Tb3VyY2UiLCJpZCIsImRldmljZUlkIiwiZXhhY3QiLCJ1bmRlZmluZWQiLCJjb25zb2xlIiwibG9nIiwiY2FwdHVyZVVzZXJNZWRpYSIsImNiT25TdWNjZXNzIiwiZ290RGV2aWNlcyIsIm9uRXJyb3IiLCJzdG9wIiwiZHJvcGRvd24iLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInByb3RvY29sIiwiaG9zdG5hbWUiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJpbmRleE9mIiwibWVkaWFDb25zdHJhaW50cyIsInN1Y2Nlc3NDYWxsYmFjayIsImdvdERldmljZXNDYWxsQmFjayIsImVycm9yQ2FsbGJhY2siLCJtZWRpYURldmljZXMiLCJnZXRVc2VyTWVkaWEiLCJ0aGVuIiwiZGV2aWNlSW5mb3MiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImkiLCJkZXZpY2VJbmZvIiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsImtpbmQiLCJpbm5lckhUTUwiLCJsYWJlbCIsImFwcGVuZENoaWxkIiwicmVtb3ZlQ2xhc3MiLCJzdHJlYW0iLCJNZWRpYVN0cmVhbVJlY29yZGVyIiwicmVjb3JkZXJUeXBlIiwiU3RlcmVvQXVkaW9SZWNvcmRlciIsIm1pbWVUeXBlIiwiYXVkaW9DaGFubmVscyIsIm9uc3RvcCIsImNiT25TdG9wTWVkaWFSZWNvcmRlciIsIm9uZGF0YWF2YWlsYWJsZSIsImNiT25EYXRhQXZhaWxhYmxlIiwic3RhcnQiLCJlbnVtZXJhdGVEZXZpY2VzIiwiZXJyb3IiLCJjYk9uRXJyb3IiLCJlcnIiLCJzb3VuZEZpbGVNb2RpZnkiLCJibG9iIiwiQmxvYiIsImZpbGVVUkwiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJzbmRQbGF5ZXIiLCJVcGRhdGVTb3VyY2UiLCJibG9iRmlsZSIsIkZpbGUiLCJEYXRlIiwiZ2V0VGltZSIsIlBieEFwaSIsIkZpbGVzVXBsb2FkRmlsZSIsImNiVXBsb2FkUmVzdW1hYmxlIiwiJHNvdW5kRmlsZUlucHV0IiwidmFsIiwicHVzaCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFNQSxjQUFjLEdBQUc7QUFDbkJDLEVBQUFBLFlBQVksRUFBRUMsQ0FBQyxDQUFDLGVBQUQsQ0FESTtBQUVuQkMsRUFBQUEsYUFBYSxFQUFFRCxDQUFDLENBQUMsc0JBQUQsQ0FGRztBQUduQkUsRUFBQUEsV0FBVyxFQUFFRixDQUFDLENBQUMscUJBQUQsQ0FISztBQUluQkcsRUFBQUEsaUJBQWlCLEVBQUVILENBQUMsQ0FBQyxzQkFBRCxDQUpEO0FBS25CSSxFQUFBQSxZQUFZLEVBQUVKLENBQUMsQ0FBQyxlQUFELENBTEk7QUFNbkJLLEVBQUFBLGNBQWMsRUFBRUMsUUFBUSxDQUFDQyxjQUFULENBQXdCLG9CQUF4QixDQU5HO0FBT25CQyxFQUFBQSxNQUFNLEVBQUUsRUFQVztBQVFuQkMsRUFBQUEsYUFBYSxFQUFFLEVBUkk7O0FBVW5CO0FBQ0o7QUFDQTtBQUNJQyxFQUFBQSxVQWJtQix3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S0FBWixDQUFrQixZQUFNO0FBQ3BCN0YsRUFBQUEsY0FBYyxDQUFDWSxVQUFmO0FBQ0gsQ0FGRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgwqkgMjAxNy0yMDIzIEFsZXhleSBQb3J0bm92IGFuZCBOaWtvbGF5IEJla2V0b3ZcbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uXG4gKiBJZiBub3QsIHNlZSA8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICovXG5cbi8qIGdsb2JhbCBNZWRpYVN0cmVhbVJlY29yZGVyLCBTdGVyZW9BdWRpb1JlY29yZGVyLCBQYnhBcGksIHNuZFBsYXllciAqL1xuXG4vKipcbiAqIFdlYktpdCBzb3VuZCByZWNvcmRlciBtb2R1bGUuXG4gKiBAbW9kdWxlIHdlYmtpdFJlY29yZGVyXG4gKi9cbmNvbnN0IHdlYmtpdFJlY29yZGVyID0ge1xuICAgICRyZWNvcmRMYWJlbDogJCgnI3JlY29yZC1sYWJlbCcpLFxuICAgICRyZWNvcmRCdXR0b246ICQoJyNzdGFydC1yZWNvcmQtYnV0dG9uJyksXG4gICAgJHN0b3BCdXR0b246ICQoJyNzdG9wLXJlY29yZC1idXR0b24nKSxcbiAgICAkc2VsZWN0QXVkaW9JbnB1dDogJCgnI3NlbGVjdC1hdWRpby1idXR0b24nKSxcbiAgICAkYXVkaW9QbGF5ZXI6ICQoJyNhdWRpby1wbGF5ZXInKSxcbiAgICBhdWRpb0lucHV0TWVudTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1ZGlvLWlucHV0LXNlbGVjdCcpLFxuICAgIGNodW5rczogW10sXG4gICAgbWVkaWFSZWNvcmRlcjogJycsXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBXZWJLaXQgc291bmQgcmVjb3JkZXIgbW9kdWxlLlxuICAgICAqL1xuICAgIGluaXRpYWxpemUoKSB7XG4gICAgICAgIHdlYmtpdFJlY29yZGVyLiRzdG9wQnV0dG9uLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXG4gICAgICAgIC8vIEV2ZW50IGxpc3RlbmVyIGZvciB0aGUgcmVjb3JkIGJ1dHRvblxuICAgICAgICB3ZWJraXRSZWNvcmRlci4kcmVjb3JkQnV0dG9uLm9uKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB3ZWJraXRSZWNvcmRlci5jaHVua3MgPSBbXTtcbiAgICAgICAgICAgIGxldCBjb25zdHJhaW50cyA9IHtcbiAgICAgICAgICAgICAgICBhdWRpbzogdHJ1ZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAod2Via2l0UmVjb3JkZXIuYXVkaW9JbnB1dE1lbnUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc2VsZWN0ZWQnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYXVkaW9Tb3VyY2UgPSB3ZWJraXRSZWNvcmRlci5hdWRpb0lucHV0TWVudS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzZWxlY3RlZCcpWzBdLmlkO1xuICAgICAgICAgICAgICAgIGNvbnN0cmFpbnRzID0ge1xuICAgICAgICAgICAgICAgICAgICBhdWRpbzoge2RldmljZUlkOiBhdWRpb1NvdXJjZSA/IHtleGFjdDogYXVkaW9Tb3VyY2V9IDogdW5kZWZpbmVkfSxcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5sb2coY29uc3RyYWludHMpO1xuICAgICAgICAgICAgd2Via2l0UmVjb3JkZXIuY2FwdHVyZVVzZXJNZWRpYShcbiAgICAgICAgICAgICAgICBjb25zdHJhaW50cyxcbiAgICAgICAgICAgICAgICB3ZWJraXRSZWNvcmRlci5jYk9uU3VjY2VzcyxcbiAgICAgICAgICAgICAgICB3ZWJraXRSZWNvcmRlci5nb3REZXZpY2VzLFxuICAgICAgICAgICAgICAgIHdlYmtpdFJlY29yZGVyLm9uRXJyb3IsXG4gICAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBFdmVudCBsaXN0ZW5lciBmb3IgdGhlIHN0b3AgYnV0dG9uXG4gICAgICAgIHdlYmtpdFJlY29yZGVyLiRzdG9wQnV0dG9uLm9uKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB3ZWJraXRSZWNvcmRlci5tZWRpYVJlY29yZGVyLnN0b3AoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgd2Via2l0UmVjb3JkZXIuJHNlbGVjdEF1ZGlvSW5wdXQuZHJvcGRvd24oKTtcblxuICAgICAgICAvLyBEaXNhYmxlIHRoZSBmaWVsZCBpZiB0aGUgcHJvdG9jb2wgaXMgbm90IEhUVFBTIG9yIHRoZSBob3N0bmFtZSBpcyBub3QgbG9jYWxob3N0XG4gICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgIT09ICdodHRwczonICYmIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSAhPT0gJ2xvY2FsaG9zdCcpIHtcbiAgICAgICAgICAgICQoJyNvbmx5LWh0dHBzLWZpZWxkJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEaXNhYmxlIHRoZSBmaWVsZCBpZiB0aGUgdXNlciBhZ2VudCBpcyBNU0lFXG4gICAgICAgIGlmICh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdNU0lFICcpID4gMCkge1xuICAgICAgICAgICAgJCgnI29ubHktaHR0cHMtZmllbGQnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYXB0dXJlIHVzZXIgbWVkaWEgYmFzZWQgb24gbWVkaWEgY29uc3RyYWludHMuXG4gICAgICogQHBhcmFtIHtNZWRpYVN0cmVhbUNvbnN0cmFpbnRzfSBtZWRpYUNvbnN0cmFpbnRzIC0gVGhlIG1lZGlhIGNvbnN0cmFpbnRzIGZvciBjYXB0dXJpbmcgdXNlciBtZWRpYS5cbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdWNjZXNzQ2FsbGJhY2sgLSBUaGUgc3VjY2VzcyBjYWxsYmFjayBmdW5jdGlvbiB0byBoYW5kbGUgY2FwdHVyZWQgbWVkaWEgc3RyZWFtLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGdvdERldmljZXNDYWxsQmFjayAtIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB0byBoYW5kbGUgdGhlIGxpc3Qgb2YgYXZhaWxhYmxlIGRldmljZXMuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZXJyb3JDYWxsYmFjayAtIFRoZSBlcnJvciBjYWxsYmFjayBmdW5jdGlvbiB0byBoYW5kbGUgZXJyb3JzIGR1cmluZyBtZWRpYSBjYXB0dXJlLlxuICAgICAqL1xuICAgIGNhcHR1cmVVc2VyTWVkaWEobWVkaWFDb25zdHJhaW50cywgc3VjY2Vzc0NhbGxiYWNrLCBnb3REZXZpY2VzQ2FsbEJhY2ssIGVycm9yQ2FsbGJhY2spIHtcbiAgICAgICAgbmF2aWdhdG9yXG4gICAgICAgICAgICAubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShtZWRpYUNvbnN0cmFpbnRzKVxuICAgICAgICAgICAgLnRoZW4oc3VjY2Vzc0NhbGxiYWNrKVxuICAgICAgICAgICAgLnRoZW4oZ290RGV2aWNlc0NhbGxCYWNrKVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yQ2FsbGJhY2spO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiBjYWxsZWQgd2hlbiBkZXZpY2VzIGFyZSByZXRyaWV2ZWQuXG4gICAgICogQHBhcmFtIHtNZWRpYURldmljZUluZm9bXX0gZGV2aWNlSW5mb3MgLSBUaGUgYXJyYXkgb2YgcmV0cmlldmVkIGRldmljZSBpbmZvLlxuICAgICAqL1xuICAgIGdvdERldmljZXMoZGV2aWNlSW5mb3MpIHtcbiAgICAgICAgaWYgKHdlYmtpdFJlY29yZGVyLmF1ZGlvSW5wdXRNZW51LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKS5sZW5ndGggPiAwKSByZXR1cm47XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBkZXZpY2VJbmZvcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgY29uc3QgZGV2aWNlSW5mbyA9IGRldmljZUluZm9zW2ldO1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICBvcHRpb24uY2xhc3NOYW1lID0gJ2l0ZW0nO1xuICAgICAgICAgICAgb3B0aW9uLmlkID0gZGV2aWNlSW5mby5kZXZpY2VJZDtcbiAgICAgICAgICAgIGlmIChkZXZpY2VJbmZvLmtpbmQgPT09ICdhdWRpb2lucHV0Jykge1xuICAgICAgICAgICAgICAgIG9wdGlvbi5pbm5lckhUTUwgPSBkZXZpY2VJbmZvLmxhYmVsIHx8XG4gICAgICAgICAgICAgICAgICAgIGBtaWNyb3Bob25lICR7d2Via2l0UmVjb3JkZXIuYXVkaW9JbnB1dE1lbnUubGVuZ3RoICsgMX1gO1xuICAgICAgICAgICAgICAgIHdlYmtpdFJlY29yZGVyLmF1ZGlvSW5wdXRNZW51LmFwcGVuZENoaWxkKG9wdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdlYmtpdFJlY29yZGVyLmF1ZGlvSW5wdXRNZW51LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdkaXYnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB3ZWJraXRSZWNvcmRlci4kc2VsZWN0QXVkaW9JbnB1dC5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiBjYWxsZWQgYWZ0ZXIgc3VjY2Vzc2Z1bGx5IGNhcHR1cmluZyB1c2VyIG1lZGlhLlxuICAgICAqIEBwYXJhbSB7TWVkaWFTdHJlYW19IHN0cmVhbSAtIFRoZSBjYXB0dXJlZCBtZWRpYSBzdHJlYW0uXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IC0gVGhlIHByb21pc2UgdG8gZW51bWVyYXRlIGRldmljZXMuXG4gICAgICovXG4gICAgY2JPblN1Y2Nlc3Moc3RyZWFtKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB3ZWJraXRSZWNvcmRlci5tZWRpYVJlY29yZGVyID0gbmV3IE1lZGlhU3RyZWFtUmVjb3JkZXIoc3RyZWFtKTtcbiAgICAgICAgICAgIHdlYmtpdFJlY29yZGVyLm1lZGlhUmVjb3JkZXIuc3RyZWFtID0gc3RyZWFtO1xuICAgICAgICAgICAgd2Via2l0UmVjb3JkZXIubWVkaWFSZWNvcmRlci5yZWNvcmRlclR5cGUgPSBTdGVyZW9BdWRpb1JlY29yZGVyO1xuICAgICAgICAgICAgd2Via2l0UmVjb3JkZXIubWVkaWFSZWNvcmRlci5taW1lVHlwZSA9ICdhdWRpby93YXYnO1xuICAgICAgICAgICAgd2Via2l0UmVjb3JkZXIubWVkaWFSZWNvcmRlci5hdWRpb0NoYW5uZWxzID0gMTtcblxuICAgICAgICAgICAgLy8gd2Via2l0UmVjb3JkZXIubWVkaWFSZWNvcmRlciA9IG5ldyBNZWRpYVJlY29yZGVyKHN0cmVhbSk7XG4gICAgICAgICAgICB3ZWJraXRSZWNvcmRlci5tZWRpYVJlY29yZGVyLm9uc3RvcCA9IHdlYmtpdFJlY29yZGVyLmNiT25TdG9wTWVkaWFSZWNvcmRlcjtcbiAgICAgICAgICAgIHdlYmtpdFJlY29yZGVyLm1lZGlhUmVjb3JkZXIub25kYXRhYXZhaWxhYmxlID0gd2Via2l0UmVjb3JkZXIuY2JPbkRhdGFBdmFpbGFibGU7XG4gICAgICAgICAgICB3ZWJraXRSZWNvcmRlci5tZWRpYVJlY29yZGVyLnN0YXJ0KDMwMDAwMCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygncmVjb3JkZXIgc3RhcnRlZCcpO1xuICAgICAgICAgICAgd2Via2l0UmVjb3JkZXIuJHJlY29yZExhYmVsLmFkZENsYXNzKCdyZWQnKTtcbiAgICAgICAgICAgIHdlYmtpdFJlY29yZGVyLiRzdG9wQnV0dG9uLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgd2Via2l0UmVjb3JkZXIuJHJlY29yZEJ1dHRvbi5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMoKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignTWVkaWFTdHJlYW1SZWNvcmRlciBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgYnJvd3Nlci5cXG5cXG4nICtcbiAgICAgICAgICAgICAgICAnVHJ5IEZpcmVmb3ggMjkgb3IgbGF0ZXIsIG9yIENocm9tZSA0NyBvciBsYXRlciwgd2l0aCBFbmFibGUgZXhwZXJpbWVudGFsIFdlYiBQbGF0Zm9ybSBmZWF0dXJlcyBlbmFibGVkIGZyb20gY2hyb21lOi8vZmxhZ3MuJyk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFeGNlcHRpb24gd2hpbGUgY3JlYXRpbmcgTWVkaWFSZWNvcmRlcjonLCBlKTtcbiAgICAgICAgICAgIHdlYmtpdFJlY29yZGVyLiRyZWNvcmRCdXR0b24uYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiBjYWxsZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMuXG4gICAgICogQHBhcmFtIHtFcnJvcn0gZXJyIC0gVGhlIGVycm9yIG9iamVjdC5cbiAgICAgKi9cbiAgICBjYk9uRXJyb3IoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBUaGUgZm9sbG93aW5nIGVycm9yIG9jY3VyZWQ6ICR7ZXJyfWApO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBmdW5jdGlvbiBjYWxsZWQgd2hlbiBtZWRpYSByZWNvcmRlciBpcyBzdG9wcGVkLlxuICAgICAqL1xuICAgIGNiT25TdG9wTWVkaWFSZWNvcmRlcigpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2RhdGEgYXZhaWxhYmxlIGFmdGVyIE1lZGlhU3RyZWFtUmVjb3JkZXIuc3RvcCgpIGNhbGxlZC4nKTtcbiAgICAgICAgc291bmRGaWxlTW9kaWZ5LmJsb2IgPSBuZXcgQmxvYih3ZWJraXRSZWNvcmRlci5jaHVua3MpO1xuICAgICAgICBjb25zb2xlLmxvZygncmVjb3JkZXIgc3RvcHBlZCcpO1xuICAgICAgICBjb25zdCBmaWxlVVJMID0gVVJMLmNyZWF0ZU9iamVjdFVSTChzb3VuZEZpbGVNb2RpZnkuYmxvYik7XG4gICAgICAgIHNuZFBsYXllci5VcGRhdGVTb3VyY2UoZmlsZVVSTCk7XG4gICAgICAgIGNvbnN0IGJsb2JGaWxlID0gbmV3IEZpbGUoW3dlYmtpdFJlY29yZGVyLmNodW5rc1swXV0sICdibG9iJyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgJy53YXYnKTtcbiAgICAgICAgUGJ4QXBpLkZpbGVzVXBsb2FkRmlsZShibG9iRmlsZSwgc291bmRGaWxlTW9kaWZ5LmNiVXBsb2FkUmVzdW1hYmxlKTtcbiAgICAgICAgd2Via2l0UmVjb3JkZXIuJHJlY29yZExhYmVsLnJlbW92ZUNsYXNzKCdyZWQnKTtcbiAgICAgICAgd2Via2l0UmVjb3JkZXIuJHN0b3BCdXR0b24uYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIHdlYmtpdFJlY29yZGVyLiRyZWNvcmRCdXR0b24ucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIHNvdW5kRmlsZU1vZGlmeS4kc291bmRGaWxlSW5wdXQudmFsKCcnKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gY2FsbGVkIHdoZW4gZGF0YSBpcyBhdmFpbGFibGUuXG4gICAgICogQHBhcmFtIHtCbG9iRXZlbnR9IGUgLSBUaGUgYmxvYiBldmVudC5cbiAgICAgKi9cbiAgICBjYk9uRGF0YUF2YWlsYWJsZShlKSB7XG4gICAgICAgIHdlYmtpdFJlY29yZGVyLmNodW5rcy5wdXNoKGUpO1xuICAgIH0sXG59O1xuXG4vLyBXaGVuIHRoZSBkb2N1bWVudCBpcyByZWFkeSwgaW5pdGlhbGl6ZSB0aGUgd2ViIGtpdCBzb3VuZCByZWNvcmRlclxuJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIHdlYmtpdFJlY29yZGVyLmluaXRpYWxpemUoKTtcbn0pO1xuIl19